# 12.3 Audit Logs

## 12.3.1 Business Purpose & Scope

## 12.3.1.1 Business Purpose

Audit Logs management provides a comprehensive framework for capturing, storing, and analyzing all system activities, user actions, and data changes across the HR ecosystem. This enables organizations to maintain complete audit trails, ensure regulatory compliance, detect security incidents, support forensic investigations, and demonstrate accountability while providing real-time monitoring and historical analysis capabilities for all HR system operations.

## 12.3.1.2 Business Scope

Enable complete audit trail management including activity logging, change tracking, access monitoring, security event detection, compliance reporting, and forensic analysis. The system supports automated log collection, real-time monitoring, intelligent log analysis, anomaly detection, alert generation, and integration with security information and event management (SIEM) systems while ensuring data integrity, regulatory compliance, and operational visibility across all HR functions and system components.

## 12.3.2 Audit Log Entry Schema

```
Table: audit_log_entry
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- log_id: VARCHAR(100) (Required, Unique, Indexed)
- timestamp: TIMESTAMP (Required, Indexed)
- event_type: ENUM('User Login', 'User Logout', 'Data Access', 'Data Create', 'Data Update', 'Data Delete', 'Permission Change', 'Role Assignment', 'System Config', 'Security Event', 'Error', 'Warning', 'Info', 'Debug')
- event_category: ENUM('Authentication', 'Authorization', 'Data Management', 'System Administration', 'Security', 'Compliance', 'Performance', 'Integration', 'User Activity')
- event_source: VARCHAR(100) (Required)
- event_source_type: ENUM('Web Application', 'Mobile App', 'API', 'Background Service', 'Database', 'File System', 'External System', 'Scheduled Task')
- user_id: UUID (Foreign Key to user)
- user_session_id: VARCHAR(100)
- user_ip_address: VARCHAR(45)
- user_agent: TEXT
- action: VARCHAR(200) (Required)
- resource_type: ENUM('User', 'Employee', 'Role', 'Permission', 'Policy', 'Report', 'Document', 'System', 'Configuration', 'Data', 'File', 'API Endpoint')
- resource_id: VARCHAR(200)
- resource_name: VARCHAR(500)
- old_values: JSON (Previous values before change)
- new_values: JSON (New values after change)
- field_changes: JSON (Specific field changes)
- business_context: TEXT (Business context and purpose)
- impact_level: ENUM('Low', 'Medium', 'High', 'Critical')
- risk_score: INTEGER (Default: 0)
- compliance_relevance: BOOLEAN (Default: FALSE)
- data_sensitivity: ENUM('Public', 'Internal', 'Confidential', 'Restricted', 'Highly Restricted')
- success: BOOLEAN (Default: TRUE)
- error_code: VARCHAR(50)
- error_message: TEXT
- execution_time_ms: INTEGER (Default: 0)
- additional_metadata: JSON (Additional context and metadata)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_audit_log_entry_company_log (log_id, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_timestamp (timestamp)
- INDEX idx_event_type (event_type)
- INDEX idx_event_category (event_category)
- INDEX idx_event_source (event_source)
- INDEX idx_user_id (user_id)
- INDEX idx_user_session_id (user_session_id)
- INDEX idx_user_ip_address (user_ip_address)
- INDEX idx_action (action)
- INDEX idx_resource_type (resource_type)
- INDEX idx_resource_id (resource_id)
- INDEX idx_impact_level (impact_level)
- INDEX idx_risk_score (risk_score)
- INDEX idx_compliance_relevance (compliance_relevance)
- INDEX idx_data_sensitivity (data_sensitivity)
- INDEX idx_success (success)
- INDEX idx_execution_time_ms (execution_time_ms)

Constraints:
- fk_audit_log_entry_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_entry_user FOREIGN KEY (user_id) REFERENCES user(id)
- chk_risk_score_range CHECK (risk_score BETWEEN 0 AND 100)
- chk_execution_time_positive CHECK (execution_time_ms >= 0)
```

## 12.3.3 Audit Log Retention Schema

```
Table: audit_log_retention_policy
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- policy_name: VARCHAR(200) (Required)
- policy_type: ENUM('Event Type', 'User Role', 'Data Sensitivity', 'Compliance Requirement', 'System Criticality', 'Custom')
- event_category_filter: JSON (Event categories covered by policy)
- user_role_filter: JSON (User roles covered by policy)
- data_sensitivity_filter: JSON (Data sensitivity levels covered)
- retention_period_days: INTEGER (Required)
- archival_trigger: ENUM('Age Based', 'Event Based', 'Manual', 'Scheduled', 'Compliance Required')
- storage_location: ENUM('Active Database', 'Archive Database', 'Cold Storage', 'File System', 'Cloud Archive', 'Compliance Archive')
- compression_enabled: BOOLEAN (Default: TRUE)
- encryption_enabled: BOOLEAN (Default: TRUE)
- anonymization_enabled: BOOLEAN (Default: FALSE)
- access_restriction: ENUM('No Access', 'Read Only', 'Admin Only', 'Compliance Only', 'Audit Only', 'Legal Only')
- auto_delete_after_retention: BOOLEAN (Default: FALSE)
- compliance_requirements: JSON (Regulatory retention requirements)
- is_active: BOOLEAN (Default: TRUE)
- effective_from: DATE (Required)
- effective_to: DATE
- last_run_date: DATE
- next_run_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_policy_type (policy_type)
- idx_retention_period_days (retention_period_days)
- idx_archival_trigger (archival_trigger)
- idx_storage_location (storage_location)
- idx_is_active (is_active)
- INDEX idx_effective_from (effective_from)
- INDEX idx_last_run_date (last_run_date)
- INDEX idx_next_run_date (next_run_date)

Constraints:
- fk_audit_log_retention_policy_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_retention_policy_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_audit_log_retention_policy_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user_id)
- chk_retention_positive CHECK (retention_period_days > 0)
- chk_effective_order CHECK (effective_to IS NULL OR effective_to >= effective_from)
```

## 12.3.4 Audit Log Governance & Access Control Schema

```
Table: audit_log_access_control
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- access_policy_name: VARCHAR(200) (Required)
- policy_type: ENUM('Role Based', 'Data Sensitivity', 'Event Type', 'Time Based', 'IP Based', 'Geographic', 'Custom')
- user_role_filter: JSON (User roles with access permissions)
- event_type_filter: JSON (Event types that can be accessed)
- data_sensitivity_filter: JSON (Data sensitivity levels that can be accessed)
- time_restriction: JSON (Time-based access restrictions)
- ip_whitelist: JSON (IP addresses allowed to access)
- geographic_restriction: JSON (Geographic access restrictions)
- access_level: ENUM('Read Only', 'Full Access', 'Export', 'Delete', 'Admin')
- approval_required: BOOLEAN (Default: FALSE)
- approval_workflow_id: UUID (Foreign Key to approval_workflow)
- max_export_records: INTEGER (Default: 10000)
- export_format_restrictions: JSON (Allowed export formats)
- real_time_access: BOOLEAN (Default: TRUE)
- historical_access_days: INTEGER (Default: 90)
- compliance_monitoring: BOOLEAN (Default: TRUE)
- audit_trail_required: BOOLEAN (Default: TRUE)
- is_active: BOOLEAN (Default: TRUE)
- effective_from: DATE (Required)
- effective_to: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_policy_type (policy_type)
- idx_access_level (access_level)
- idx_approval_required (approval_required)
- idx_real_time_access (real_time_access)
- idx_is_active (is_active)
- INDEX idx_effective_from (effective_from)

Constraints:
- fk_audit_log_access_control_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_access_control_approval_workflow FOREIGN KEY (approval_workflow_id) REFERENCES approval_workflow(id)
- fk_audit_log_access_control_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_audit_log_access_control_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user_id)
- chk_max_export_positive CHECK (max_export_records > 0)
- chk_historical_positive CHECK (historical_access_days >= 0)
- chk_effective_order CHECK (effective_to IS NULL OR effective_to >= effective_from)
```

## 12.3.5 Audit Log Integration & Performance Schema

```
Table: audit_log_integration_config
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- integration_name: VARCHAR(200) (Required)
- integration_type: ENUM('SIEM', 'LOG_MANAGEMENT', 'SECURITY_ORCHESTRATION', 'COMPLIANCE_PLATFORM', 'DATABASE', 'FILE_SYSTEM', 'API_WEBHOOK', 'EMAIL_GATEWAY', 'MONITORING_TOOL')
- external_system: VARCHAR(100) (Required)
- external_system_id: VARCHAR(200) (Required)
- integration_description: TEXT
- endpoint_url: VARCHAR(500)
- authentication_method: ENUM('API Key', 'OAuth 2.0', 'Basic Auth', 'Certificate', 'SAML', 'JWT', 'Syslog', 'LEEF')
- authentication_config: JSON (Encrypted authentication credentials)
- data_mapping: JSON (Field mapping between systems)
- sync_frequency: ENUM('Real-time', 'Near Real-time', 'Hourly', 'Daily', 'Weekly', 'On-demand')
- sync_direction: ENUM('Bidirectional', 'Inbound', 'Outbound')
- data_format: ENUM('JSON', 'XML', 'CSV', 'CEF', 'LEEF', 'Syslog', 'Plain Text')
- compression_enabled: BOOLEAN (Default: TRUE)
- encryption_enabled: BOOLEAN (Default: TRUE)
- batch_size: INTEGER (Default: 1000)
- retry_count: INTEGER (Default: 0)
- max_retries: INTEGER (Default: 3)
- performance_metrics: JSON (Sync performance and statistics)
- error_handling: JSON (Error handling and recovery logic)
- is_active: BOOLEAN (Default: TRUE)
- last_sync_at: TIMESTAMP
- next_sync_at: TIMESTAMP
- sync_status: ENUM('Active', 'Inactive', 'Error', 'Paused', 'Maintenance', 'Testing')
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_integration_type (integration_type)
- INDEX idx_external_system (external_system)
- INDEX idx_sync_status (sync_status)
- INDEX idx_last_sync_at (last_sync_at)
- INDEX idx_is_active (is_active)

Constraints:
- fk_audit_log_integration_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_integration_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_retry_count_valid CHECK (retry_count >= 0 AND retry_count <= max_retries)
- chk_batch_size_positive CHECK (batch_size > 0)
```

```
Table: audit_log_performance_metrics
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- metric_date: DATE (Required)
- metric_period: ENUM('Hourly', 'Daily', 'Weekly', 'Monthly', 'Quarterly')
- total_logs_processed: INTEGER (Default: 0)
- successful_syncs: INTEGER (Default: 0)
- failed_syncs: INTEGER (Default: 0)
- average_processing_time_ms: INTEGER (Default: 0)
- peak_processing_time_ms: INTEGER (Default: 0)
- storage_consumed_mb: DECIMAL(10,2) (Default: 0.00)
- compression_ratio: DECIMAL(5,2) (Default: 0.00)
- database_connections: INTEGER (Default: 0)
- api_calls_made: INTEGER (Default: 0)
- error_rate_percentage: DECIMAL (5,2) (Default: 0.00)
- throughput_logs_per_second: DECIMAL(10,2) (Default: 0.00)
- system_availability: DECIMAL (5,2) (Default: 99.99)
- disk_utilization_percentage: DECIMAL (5,2) (Default: 0.00)
- memory_utilization_percentage: DECIMAL (5,2) (Default: 0.00)
- cpu_utilization_percentage: DECIMAL (5,2) (Default: 0.00)
- network_bandwidth_utilization: BIGINT (Default: 0)
- integration_performance: JSON (Per-integration performance data)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_metric_date (metric_date)
- INDEX idx_metric_period (metric_period)
- INDEX idx_total_logs_processed (total_logs_processed)
- idx_successful_syncs (successful_syncs)
- idx_failed_syncs (failed_syncs)
- idx_average_processing_time_ms (average_processing_time_ms)
- idx_peak_processing_time_ms (peak_processing_time_ms)
- idx_storage_consumed_mb (storage_consumed_mb)
- idx_system_availability (system_availability)
- idx_error_rate_percentage (error_rate_percentage)

Constraints:
- fk_audit_log_performance_company FOREIGN KEY (company_id) REFERENCES company(id)
- chk_positive_counts CHECK (total_logs_processed >= 0 AND successful_syncs >= 0 AND failed_syncs >= 0)
- chk_processing_times_positive CHECK (average_processing_time_ms >= 0 AND peak_processing_time_ms >= 0)
- chk_storage_positive CHECK (storage_consumed_mb >= 0)
- chk_utilization_ranges CHECK (disk_utilization_percentage BETWEEN 0 AND 100 AND memory_utilization_percentage BETWEEN 0 AND 100 AND cpu_utilization_percentage BETWEEN 0 AND 100)
- chk_bandwidth_positive CHECK (network_bandwidth_utilization >= 0)
```

## 12.3.6 Audit Log Compliance & Reporting Schema

```
Table: audit_log_compliance_report
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- report_code: VARCHAR(50) (Required, Unique, Indexed)
- report_name: VARCHAR(200) (Required)
- report_type: ENUM('Access Review', 'Security Audit', 'Compliance Assessment', 'Incident Investigation', 'Regulatory Filing', 'Internal Audit', 'External Audit', 'Forensic Analysis')
- compliance_framework: ENUM('SOX', 'GDPR', 'HIPAA', 'PCI DSS', 'ISO 27001', 'NIST', 'Internal Policy', 'Custom')
- reporting_period_start: DATE (Required)
- reporting_period_end: DATE (Required)
- report_description: TEXT (Required)
- report_objectives: JSON (Specific compliance objectives and requirements)
- data_sources: JSON (Data sources used for reporting)
- methodology: JSON (Reporting methodology and calculations)
- key_findings: JSON (Key compliance findings and insights)
- risk_assessments: JSON (Risk identification and assessment)
- recommendations: JSON (Recommendations for improvement)
- action_items: JSON (Required actions and timelines)
- report_status: ENUM('Draft', 'Under Review', 'Approved', 'Submitted', 'Accepted', 'Rejected', 'Requires Revision')
- priority: ENUM('Low', 'Medium', 'High', 'Critical')
- due_date: DATE
- submission_date: DATE
- approval_date: DATE
- approved_by_user_id: UUID (Foreign Key to user)
- reviewer_comments: TEXT
- external_auditor: VARCHAR(200)
- audit_firm: VARCHAR(200)
- report_file_url: VARCHAR(500)
- supporting_documents: JSON (Links to supporting documents)
- compliance_score: DECIMAL(5,2) (Default: 0.00)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_audit_log_compliance_report_company_code (report_code, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_report_type (report_type)
- INDEX idx_compliance_framework (compliance_framework)
- INDEX idx_reporting_period_start (reporting_period_start)
- INDEX idx_reporting_period_end (report_period_end)
- INDEX idx_report_status (report_status)
- INDEX idx_priority (priority)
- INDEX idx_due_date (due_date)
- INDEX idx_compliance_score (compliance_score)
- INDEX idx_approved_by_user_id (approved_by_user_id)

Constraints:
- fk_audit_log_compliance_report_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_compliance_report_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_audit_log_compliance_report_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_period_order CHECK (reporting_period_end >= reporting_period_start)
- chk_compliance_score_range CHECK (compliance_score BETWEEN 0 AND 100)
```

```
Table: audit_log_regulatory_filing
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- filing_type: ENUM('SOX 404', 'GDPR Article 30', 'HIPAA Security Rule', 'PCI DSS 10.3', 'ISO 27001 A.12.4', 'Custom Requirement')
- regulatory_body: VARCHAR(200) (Required)
- filing_deadline: DATE (Required)
- submission_date: DATE
- acknowledgement_date: DATE
- filing_status: ENUM('Pending', 'Submitted', 'Acknowledged', 'Accepted', 'Rejected', 'Requires Revision', 'Overdue')
- report_reference_number: VARCHAR(100)
- filing_format: ENUM('PDF', 'XML', 'JSON', 'CSV', 'Plain Text')
- encryption_required: BOOLEAN (Default: TRUE)
- digital_signature_required: BOOLEAN (Default: TRUE)
- attachment_count: INTEGER (Default: 0)
- attachment_files: JSON (List of attached files)
- filing_description: TEXT (Required)
- compliance_requirements: JSON (Specific regulatory requirements)
- evidence_documents: JSON (Links to evidence documents)
- auto_filing_enabled: BOOLEAN (Default: FALSE)
- reminder_schedule: JSON (Reminder notifications before deadline)
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_filing_type (filing_type)
- idx_regulatory_body (regulatory_body)
- idx_filing_deadline (filing_deadline)
- idx_filing_status (filing_status)
- idx_is_active (is_active)
- INDEX idx_auto_filing_enabled (auto_filing_enabled)

Constraints:
- fk_audit_log_regulatory_filing_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_regulatory_filing_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_attachment_count_positive CHECK (attachment_count >= 0)
- chk_deadline_future CHECK (filing_deadline >= submission_date)
```

## 12.3.7 Audit Log Analytics & Insights Schema

```
Table: audit_log_analytics
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- department_id: UUID (Foreign Key to department)
- analysis_type: ENUM('User Activity', 'Security Events', 'Compliance Monitoring', 'Performance Analysis', 'Risk Assessment', 'Trend Analysis', 'Anomaly Detection', 'Usage Patterns')
- analysis_period: ENUM('Hourly', 'Daily', 'Weekly', 'Monthly', 'Quarterly', 'Semi-Annual', 'Annual')
- analysis_date: DATE (Required)
- metric_name: VARCHAR(100) (Required)
- metric_value: DECIMAL(15,2) (Required)
- metric_unit: VARCHAR(50)
- benchmark_value: DECIMAL(15,2)
- variance_percentage: DECIMAL (5,2)
- target_value: DECIMAL(15,2)
- achievement_percentage: DECIMAL (5,2)
- total_events: INTEGER (Default: 0)
- successful_events: INTEGER (Default: 0)
- failed_events: INTEGER (Default: 0)
- security_events: INTEGER (Default: 0)
- compliance_violations: INTEGER (Default: 0)
- high_risk_activities: INTEGER (Default: 0)
- data_access_events: INTEGER (Default: 0)
- permission_changes: INTEGER (Default: 0)
- system_config_changes: INTEGER (Default: 0)
- external_api_calls: INTEGER (Default: 0)
- average_response_time_ms: INTEGER (Default: 0)
- peak_concurrent_users: INTEGER (Default: 0)
- unique_users_active: INTEGER (Default: 0)
- failed_login_attempts: INTEGER (Default: 0)
- privileged_access_events: INTEGER (Default: 0)
- data_export_events: INTEGER (Default: 0)
- audit_trail_integrity_score: DECIMAL (3,2) (Default: 5.00)
- security_posture_score: DECIMAL (3,2) (Default: 5.00)
- compliance_adherence_rate: DECIMAL (5,2) (Default: 100.00)
- additional_metrics: JSON (Other KPIs and breakdowns)
- data_quality_score: DECIMAL (3,2) (Default: 5.00)
- calculated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_department_id (department_id)
- INDEX idx_analysis_type (analysis_type)
- INDEX idx_analysis_period (analysis_period)
- INDEX idx_analysis_date (analysis_date)
- INDEX idx_metric_name (metric_name)
- idx_total_events (total_events)
- idx_successful_events (successful_events)
- idx_failed_events (failed_events)
- idx_security_events (security_events)
- idx_compliance_violations (compliance_violations)
- idx_high_risk_activities (high_risk_activities)
- idx_data_access_events (data_access_events)
- idx_permission_changes (permission_changes)
- idx_system_config_changes (system_config_changes)
- idx_external_api_calls (external_api_calls)
- idx_average_response_time_ms (average_response_time_ms)
- idx_unique_users_active (unique_users_active)
- idx_failed_login_attempts (failed_login_attempts)
- idx_privileged_access_events (privileged_access_events)
- idx_data_export_events (data_export_events)
- idx_audit_trail_integrity_score (audit_trail_integrity_score)
- idx_security_posture_score (security_posture_score)
- idx_compliance_adherence_rate (compliance_adherence_rate)

Constraints:
- fk_audit_log_analytics_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_analytics_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_audit_log_analytics_calculated_by FOREIGN KEY (calculated_by_user_id) REFERENCES user(id)
- chk_positive_events CHECK (total_events >= 0 AND successful_events >= 0 AND failed_events >= 0 AND security_events >= 0 AND compliance_violations >= 0 AND high_risk_activities >= 0)
- chk_positive_activities CHECK (data_access_events >= 0 AND permission_changes >= 0 AND system_config_changes >= 0 AND external_api_calls >= 0)
- chk_positive_users CHECK (unique_users_active >= 0 AND failed_login_attempts >= 0 AND privileged_access_events >= 0 AND data_export_events >= 0)
- chk_response_time_positive CHECK (average_response_time_ms >= 0)
- chk_achievement_range CHECK (achievement_percentage BETWEEN 0 AND 100)
- chk_compliance_range CHECK (compliance_adherence_rate BETWEEN 0 AND 100)
- chk_integrity_range CHECK (audit_trail_integrity_score BETWEEN 1 AND 5)
- chk_security_range CHECK (security_posture_score BETWEEN 1 AND 5)
- chk_data_quality_range CHECK (data_quality_score BETWEEN 1 AND 5)
```

```
Table: audit_log_dashboard
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- dashboard_code: VARCHAR(50) (Required, Unique, Indexed)
- dashboard_name: VARCHAR(200) (Required)
- dashboard_type: ENUM('Executive', 'Security', 'Compliance', 'Operations', 'IT Administration', 'Audit', 'Risk Management', 'Legal')
- dashboard_category: ENUM('Real-time Monitoring', 'Security Analysis', 'Compliance Tracking', 'Performance Metrics', 'User Activity', 'System Health', 'Incident Response', 'Trend Analysis')
- dashboard_description: TEXT (Required)
- layout_config: JSON (Dashboard layout and widget configuration)
- data_sources: JSON (Data sources for the dashboard)
- refresh_frequency: ENUM('Real-time', 'Every 5 Minutes', 'Every 15 Minutes', 'Hourly', 'Daily', 'Weekly')
- access_permissions: JSON (User access permissions and restrictions)
- widget_configurations: JSON (Widget configurations and settings)
- filter_options: JSON (Available filters and parameters)
- export_options: JSON (Export formats and options)
- sharing_settings: JSON (Dashboard sharing and collaboration settings)
- alert_configurations: JSON (Alert rules and notifications)
- drill_down_capabilities: JSON (Drill-down options and linked reports)
- is_public: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- last_refreshed_at: TIMESTAMP
- refresh_status: ENUM('Success', 'Error', 'In Progress', 'Disabled', 'Scheduled')
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_audit_log_dashboard_company_code (dashboard_code, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_dashboard_type (dashboard_type)
- INDEX idx_dashboard_category (dashboard_category)
- idx_is_public (is_public)
- idx_is_active (is_active)
- INDEX idx_last_refreshed_at (last_refreshed_at)
- INDEX idx_refresh_status (refresh_status)

Constraints:
- fk_audit_log_dashboard_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_dashboard_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
```

## 12.3.8 Audit Log Communication & Notification Schema

```
Table: audit_log_notification_template
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- template_code: VARCHAR(50) (Required, Unique, Indexed)
- template_name: VARCHAR(200) (Required)
- template_type: ENUM('Security Alert', 'Compliance Violation', 'System Error', 'Performance Issue', 'Access Denied', 'Data Breach', 'Policy Violation', 'Audit Finding')
- template_category: ENUM('Critical', 'High Priority', 'Medium Priority', 'Low Priority', 'Informational', 'Warning', 'Error', 'Success')
- template_subject: VARCHAR(500) (Required)
- template_body: TEXT (Required)
- template_format: ENUM('Plain Text', 'HTML', 'Markdown', 'JSON')
- language_code: VARCHAR(10) (Default: 'en')
- personalization_variables: JSON (Available personalization variables)
- default_sender: VARCHAR(200) (Required)
- default_recipients: JSON (Default recipient list)
- cc_recipients: JSON (CC recipient list)
- bcc_recipients: JSON (BCC recipient list)
- attachment_support: BOOLEAN (Default: FALSE)
- template_status: ENUM('Draft', 'Active', 'Inactive', 'Archived')
- approval_required: BOOLEAN (Default: FALSE)
- approved_by_user_id: UUID (Foreign Key to user)
- approved_at: TIMESTAMP
- usage_count: INTEGER (Default: 0)
- last_used_at: TIMESTAMP
- compliance_framework: ENUM('SOX', 'GDPR', 'HIPAA', 'PCI DSS', 'ISO 27001', 'NIST', 'All')
- legal_review_required: BOOLEAN (Default: TRUE)
- legal_review_status: ENUM('Pending', 'Approved', 'Rejected', 'Requires Revision')
- legal_reviewer_id: UUID (Foreign Key to user)
- legal_review_date: TIMESTAMP
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_audit_log_notification_template_company_code (template_code, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_template_type (template_type)
- INDEX idx_template_category (template_category)
- INDEX idx_template_status (template_status)
- INDEX idx_language_code (language_code)
- INDEX idx_usage_count (usage_count)
- INDEX idx_last_used_at (last_used_at)
- INDEX idx_compliance_framework (compliance_framework)
- INDEX idx_legal_review_status (legal_review_status)

Constraints:
- fk_audit_log_notification_template_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_notification_template_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_audit_log_notification_template_legal_reviewer FOREIGN KEY (legal_reviewer_id) REFERENCES user(id)
- fk_audit_log_notification_template_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_usage_count_positive CHECK (usage_count >= 0)
```

```
Table: audit_log_notification_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- template_id: UUID (Foreign Key to audit_log_notification_template)
- notification_type: ENUM('Security Alert', 'Compliance Violation', 'System Error', 'Performance Issue', 'Access Denied', 'Data Breach', 'Policy Violation', 'Audit Finding')
- notification_category: ENUM('Critical', 'High Priority', 'Medium Priority', 'Low Priority', 'Informational', 'Warning', 'Error', 'Success')
- trigger_event_id: UUID (Foreign Key to audit_log_entry)
- recipient_type: ENUM('User', 'Role', 'Department', 'Security Team', 'Compliance Officer', 'IT Administrator', 'Management', 'External Auditor')
- recipient_id: UUID (Foreign Key to user)
- recipient_email: VARCHAR(200)
- recipient_name: VARCHAR(200)
- subject: VARCHAR(500) (Required)
- message_body: TEXT (Required)
- message_format: ENUM('Plain Text', 'HTML', 'Markdown', 'JSON')
- personalization_data: JSON (Personalization data used)
- attachment_count: INTEGER (Default: 0)
- attachment_files: JSON (List of attached files)
- delivery_status: ENUM('Pending', 'Sent', 'Delivered', 'Failed', 'Bounced', 'Complained', 'Blocked')
- delivery_attempts: INTEGER (Default: 0)
- sent_at: TIMESTAMP
- delivered_at: TIMESTAMP
- opened_at: TIMESTAMP
- clicked_at: TIMESTAMP
- response_required: BOOLEAN (Default: FALSE)
- response_deadline: TIMESTAMP
- response_received_at: TIMESTAMP
- priority: ENUM('Low', 'Normal', 'High', 'Critical', 'Emergency')
- error_message: TEXT
- compliance_reference: VARCHAR(100) (Reference to compliance requirement)
- escalation_required: BOOLEAN (Default: FALSE)
- escalation_level: INTEGER (Default: 0)
- max_escalation_level: INTEGER (Default: 3)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_template_id (template_id)
- INDEX idx_notification_type (notification_type)
- INDEX idx_notification_category (notification_category)
- INDEX idx_trigger_event_id (trigger_event_id)
- INDEX idx_recipient_type (recipient_type)
- INDEX idx_recipient_id (recipient_id)
- INDEX idx_delivery_status (delivery_status)
- INDEX idx_sent_at (sent_at)
- INDEX idx_priority (priority)
- INDEX idx_response_required (response_required)
- INDEX idx_escalation_required (escalation_required)
- INDEX idx_escalation_level (escalation_level)

Constraints:
- fk_audit_log_notification_log_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_notification_log_template FOREIGN KEY (template_id) REFERENCES audit_log_notification_template(id)
- fk_audit_log_notification_log_trigger_event FOREIGN KEY (trigger_event_id) REFERENCES audit_log_entry(id)
- fk_audit_log_notification_log_recipient FOREIGN KEY (recipient_id) REFERENCES user(id)
- fk_audit_log_notification_log_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_delivery_attempts_positive CHECK (delivery_attempts >= 0)
- chk_attachment_count_positive CHECK (attachment_count >= 0)
- chk_escalation_level_valid CHECK (escalation_level >= 0 AND escalation_level <= max_escalation_level)
```

## 12.3.9 Audit Log User Preferences & Personalization Schema

```
Table: audit_log_user_preference
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- user_id: UUID (Foreign Key to user)
- preference_category: ENUM('Dashboard Settings', 'Notification Preferences', 'Report Settings', 'Search Filters', 'Display Options', 'Alert Configuration', 'Export Settings', 'Security Settings')
- preference_key: VARCHAR(100) (Required)
- preference_value: JSON (Preference value and configuration)
- preference_type: ENUM('Boolean', 'String', 'Number', 'Array', 'Object', 'Date', 'Time')
- is_system_default: BOOLEAN (Default: FALSE)
- is_user_editable: BOOLEAN (Default: TRUE)
- validation_rules: JSON (Validation rules for the preference)
- default_value: JSON (Default system value)
- description: TEXT (Description of the preference)
- help_text: TEXT (Help text for the preference)
- display_order: INTEGER (Default: 0)
- is_active: BOOLEAN (Default: TRUE)
- security_impact: ENUM('Low', 'Medium', 'High', 'Critical')
- compliance_relevance: BOOLEAN (Default: FALSE)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_user_id (user_id)
- INDEX idx_preference_category (preference_category)
- INDEX idx_preference_key (preference_key)
- INDEX idx_is_system_default (is_system_default)
- INDEX idx_is_user_editable (is_user_editable)
- INDEX idx_display_order (display_order)
- INDEX idx_is_active (is_active)
- INDEX idx_security_impact (security_impact)
- INDEX idx_compliance_relevance (compliance_relevance)

Constraints:
- fk_audit_log_user_preference_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_user_preference_user FOREIGN KEY (user_id) REFERENCES user(id)
- fk_audit_log_user_preference_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_display_order_positive CHECK (display_order >= 0)
```

```
Table: audit_log_user_profile
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- user_id: UUID (Foreign Key to user)
- default_dashboard_view: ENUM('Executive Summary', 'Security Overview', 'Compliance Status', 'Performance Metrics', 'Recent Activity', 'Alert Center', 'Custom')
- preferred_time_range: ENUM('Last Hour', 'Last 24 Hours', 'Last 7 Days', 'Last 30 Days', 'Last Quarter', 'Custom Range')
- default_event_types: JSON (Default event types to display)
- default_severity_filter: ENUM('All', 'Critical Only', 'High and Critical', 'Medium and Above', 'Low and Above')
- auto_refresh_enabled: BOOLEAN (Default: TRUE)
- auto_refresh_interval: INTEGER (Default: 300) (Seconds)
- notification_preferences: JSON (User notification settings)
- alert_preferences: JSON (User alert configuration)
- export_preferences: JSON (Default export settings)
- search_preferences: JSON (Default search filters and options)
- display_preferences: JSON (UI display and layout preferences)
- language_preference: VARCHAR(10) (Default: 'en')
- timezone_preference: VARCHAR(50) (Default: 'UTC')
- date_format_preference: VARCHAR(20) (Default: 'YYYY-MM-DD')
- time_format_preference: ENUM('12-hour', '24-hour') (Default: '24-hour')
- accessibility_settings: JSON (Accessibility and display accommodations)
- privacy_settings: JSON (User privacy and data sharing preferences)
- security_settings: JSON (User security and authentication preferences)
- last_login_at: TIMESTAMP
- last_activity_at: TIMESTAMP
- session_timeout_minutes: INTEGER (Default: 30)
- concurrent_sessions_allowed: INTEGER (Default: 3)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_user_id (user_id)
- INDEX idx_default_dashboard_view (default_dashboard_view)
- INDEX idx_preferred_time_range (preferred_time_range)
- INDEX idx_auto_refresh_enabled (auto_refresh_enabled)
- INDEX idx_language_preference (language_preference)
- INDEX idx_timezone_preference (timezone_preference)
- INDEX idx_last_login_at (last_login_at)
- INDEX idx_last_activity_at (last_activity_at)

Constraints:
- fk_audit_log_user_profile_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_user_profile_user FOREIGN KEY (user_id) REFERENCES user(id)
- chk_refresh_interval_positive CHECK (auto_refresh_interval > 0)
- chk_session_timeout_positive CHECK (session_timeout_minutes > 0)
- chk_concurrent_sessions_positive CHECK (concurrent_sessions_allowed > 0)
```

## 12.3.10 Audit Log Mobile & API Access Schema

```
Table: audit_log_mobile_app
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- app_version: VARCHAR(20) (Required)
- platform: ENUM('iOS', 'Android', 'Web', 'Hybrid')
- build_number: VARCHAR(20) (Required)
- release_date: DATE (Required)
- is_current: BOOLEAN (Default: FALSE)
- is_mandatory: BOOLEAN (Default: FALSE)
- min_supported_version: VARCHAR(20)
- features_enabled: JSON (Feature flags and capabilities)
- api_endpoints: JSON (Mobile-specific API endpoints)
- offline_capabilities: JSON (Offline functionality support)
- security_config: JSON (Mobile security settings)
- audit_features: JSON (Audit-specific mobile features)
- real_time_monitoring: BOOLEAN (Default: TRUE)
- alert_notifications: BOOLEAN (Default: TRUE)
- log_search: BOOLEAN (Default: TRUE)
- report_generation: BOOLEAN (Default: TRUE)
- dashboard_access: BOOLEAN (Default: TRUE)
- biometric_auth_enabled: BOOLEAN (Default: TRUE)
- offline_data_retention_days: INTEGER (Default: 7)
- encryption_at_rest: BOOLEAN (Default: TRUE)
- encryption_in_transit: BOOLEAN (Default: TRUE)
- remote_wipe_capability: BOOLEAN (Default: TRUE)
- jailbreak_detection: BOOLEAN (Default: TRUE)
- certificate_pinning: BOOLEAN (Default: TRUE)
- api_rate_limit_per_minute: INTEGER (Default: 100)
- max_concurrent_requests: INTEGER (Default: 10)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_app_version (app_version)
- INDEX idx_platform (platform)
- INDEX idx_is_current (is_current)
- INDEX idx_is_mandatory (is_mandatory)
- INDEX idx_release_date (release_date)

Constraints:
- fk_audit_log_mobile_app_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_mobile_app_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_retention_positive CHECK (offline_data_retention_days >= 0)
- chk_rate_limit_positive CHECK (api_rate_limit_per_minute > 0)
- chk_concurrent_requests_positive CHECK (max_concurrent_requests > 0)
```

```
Table: audit_log_api_access
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- api_key: VARCHAR(200) (Required, Unique, Indexed)
- api_name: VARCHAR(200) (Required)
- api_description: TEXT
- api_version: VARCHAR(20) (Default: 'v1')
- endpoint_url: VARCHAR(500) (Required)
- authentication_type: ENUM('API Key', 'OAuth 2.0', 'JWT', 'Basic Auth', 'mTLS', 'SAML')
- rate_limit_per_minute: INTEGER (Default: 1000)
- rate_limit_per_hour: INTEGER (Default: 10000)
- allowed_methods: JSON (HTTP methods allowed)
- allowed_ips: JSON (IP whitelist)
- webhook_url: VARCHAR(500)
- webhook_events: JSON (Events that trigger webhooks)
- data_access_level: ENUM('ALL', 'AGGREGATED_ONLY', 'SUMMARY_ONLY', 'METADATA_ONLY', 'ANONYMIZED_ONLY')
- audit_controls: JSON (Audit-specific access controls)
- log_access_required: BOOLEAN (Default: TRUE)
- data_masking: BOOLEAN (Default: TRUE)
- audit_logging: BOOLEAN (Default: TRUE)
- export_formats: JSON (Allowed export formats)
- compliance_frameworks: JSON (Compliance frameworks supported)
- sox_compliant: BOOLEAN (Default: TRUE)
- gdpr_compliant: BOOLEAN (Default: TRUE)
- hipaa_compliant: BOOLEAN (Default: FALSE)
- pci_dss_compliant: BOOLEAN (Default: FALSE)
- data_retention_policy: JSON (API data retention policy)
- is_internal: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- last_used_at: TIMESTAMP
- usage_count: INTEGER (Default: 0)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_api_key (api_key)
- INDEX idx_api_version (api_version)
- INDEX idx_is_active (is_active)
- INDEX idx_is_internal (is_internal)
- INDEX idx_last_used_at (last_used_at)
- INDEX idx_usage_count (usage_count)
- INDEX idx_data_access_level (data_access_level)
- INDEX idx_sox_compliant (sox_compliant)
- INDEX idx_gdpr_compliant (gdpr_compliant)
- INDEX idx_hipaa_compliant (hipaa_compliant)
- INDEX idx_pci_dss_compliant (pci_dss_compliant)

Constraints:
- fk_audit_log_api_access_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_api_access_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_rate_limits_positive CHECK (rate_limit_per_minute > 0 AND rate_limit_per_hour > 0)
- chk_usage_positive CHECK (usage_count >= 0)
```

## 12.3.11 Audit Log Security & Compliance Schema

```
Table: audit_log_security_config
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- security_policy_name: VARCHAR(200) (Required)
- policy_type: ENUM('Data Encryption', 'Access Control', 'Audit Logging', 'Session Management', 'Password Policy', 'Two-Factor Auth', 'Data Masking', 'Network Security', 'Audit Integrity')
- security_level: ENUM('Basic', 'Standard', 'Enhanced', 'High', 'Maximum')
- configuration: JSON (Security configuration parameters)
- encryption_algorithm: VARCHAR(50)
- key_rotation_days: INTEGER (Default: 90)
- session_timeout_minutes: INTEGER (Default: 30)
- max_login_attempts: INTEGER (Default: 5)
- lockout_duration_minutes: INTEGER (Default: 15)
- password_min_length: INTEGER (Default: 8)
- password_complexity: JSON (Password complexity requirements)
- mfa_required: BOOLEAN (Default: FALSE)
- mfa_methods: JSON (Allowed MFA methods)
- data_masking_rules: JSON (Data masking and anonymization rules)
- network_access_rules: JSON (IP whitelisting and restrictions)
- audit_integrity_controls: JSON (Audit trail integrity and tamper protection)
- log_checksum_validation: BOOLEAN (Default: TRUE)
- digital_signatures: BOOLEAN (Default: TRUE)
- blockchain_storage: BOOLEAN (Default: FALSE)
- write_once_storage: BOOLEAN (Default: TRUE)
- tamper_detection: BOOLEAN (Default: TRUE)
- compliance_monitoring: BOOLEAN (Default: TRUE)
- is_active: BOOLEAN (Default: TRUE)
- effective_from: DATE (Required)
- effective_to: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_policy_type (policy_type)
- INDEX idx_security_level (security_level)
- INDEX idx_is_active (is_active)
- INDEX idx_effective_from (effective_from)

Constraints:
- fk_audit_log_security_config_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_security_config_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_audit_log_security_config_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_positive_values CHECK (key_rotation_days > 0 AND session_timeout_minutes > 0 AND max_login_attempts > 0 AND lockout_duration_minutes > 0 AND password_min_length > 0)
- chk_effective_order CHECK (effective_to IS NULL OR effective_to >= effective_from)
```

```
Table: audit_log_compliance_audit
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- audit_type: ENUM('SOX', 'GDPR', 'HIPAA', 'PCI DSS', 'ISO 27001', 'NIST', 'Internal', 'External', 'Data Privacy', 'Security')
- audit_scope: ENUM('Full System', 'Audit Trail', 'Access Control', 'Data Protection', 'Security Controls', 'Compliance Monitoring', 'Log Management', 'Retention Policy')
- audit_period_start: DATE (Required)
- audit_period_end: DATE (Required)
- auditor_name: VARCHAR(200)
- auditor_organization: VARCHAR(200)
- audit_status: ENUM('Planned', 'In Progress', 'Completed', 'Passed', 'Failed', 'Remediation Required', 'Under Review')
- findings_count: INTEGER (Default: 0)
- critical_findings: INTEGER (Default: 0)
- high_findings: INTEGER (Default: 0)
- medium_findings: INTEGER (Default: 0)
- low_findings: INTEGER (Default: 0)
- compliance_score: DECIMAL(5,2) (Default: 0.00)
- audit_integrity_score: DECIMAL(3,2) (Default: 0.00)
- security_posture_score: DECIMAL(3,2) (Default: 0.00)
- log_completeness_score: DECIMAL(3,2) (Default: 0.00)
- data_protection_score: DECIMAL(3,2) (Default: 0.00)
- remediation_plan: TEXT
- remediation_due_date: DATE
- audit_report_url: VARCHAR(500)
- evidence_documents: JSON (Links to evidence documents)
- audit_trail_analysis: JSON (Audit trail integrity analysis results)
- security_assessment: JSON (Security assessment results)
- regulatory_requirements: JSON (Applicable regulatory requirements)
- gap_analysis: JSON (Compliance gap analysis)
- recommendations: JSON (Recommendations for improvement)
- action_items: JSON (Required actions and timelines)
- follow_up_required: BOOLEAN (Default: TRUE)
- follow_up_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_audit_type (audit_type)
- INDEX idx_audit_scope (audit_scope)
- INDEX idx_audit_status (audit_status)
- INDEX idx_audit_period_start (audit_period_start)
- INDEX idx_audit_period_end (audit_period_end)
- INDEX idx_compliance_score (compliance_score)
- INDEX idx_audit_integrity_score (audit_integrity_score)
- INDEX idx_security_posture_score (security_posture_score)
- INDEX idx_log_completeness_score (log_completeness_score)
- INDEX idx_data_protection_score (data_protection_score)
- INDEX idx_follow_up_required (follow_up_required)
- INDEX idx_follow_up_date (follow_up_date)

Constraints:
- fk_audit_log_compliance_audit_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_compliance_audit_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_period_order CHECK (audit_period_end >= audit_period_start)
- chk_positive_findings CHECK (findings_count >= 0 AND critical_findings >= 0 AND high_findings >= 0 AND medium_findings >= 0 AND low_findings >= 0)
- chk_compliance_score_range CHECK (compliance_score BETWEEN 0 AND 100)
- chk_integrity_score_range CHECK (audit_integrity_score BETWEEN 0 AND 5)
- chk_security_posture_range CHECK (security_posture_score BETWEEN 0 AND 5)
- chk_completeness_score_range CHECK (log_completeness_score BETWEEN 0 AND 5)
- chk_protection_score_range CHECK (data_protection_score BETWEEN 0 AND 5)
- chk_follow_up_future CHECK (follow_up_date IS NULL OR follow_up_date >= audit_period_end)
```

## 12.3.12 Audit Log Workflow & Process Automation Schema

```
Table: audit_log_workflow_definition
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- workflow_name: VARCHAR(200) (Required)
- workflow_type: ENUM('Log Review', 'Security Incident', 'Compliance Check', 'Audit Investigation', 'Data Retention', 'Access Request', 'Report Generation', 'Alert Response')
- workflow_category: ENUM('Standard', 'Emergency', 'High Value', 'Executive', 'Bulk Processing', 'Scheduled', 'Manual Trigger', 'Automated')
- trigger_event: ENUM('Security Event', 'Compliance Violation', 'System Error', 'Access Request', 'Schedule Triggered', 'Manual Start', 'System Event', 'Audit Deadline')
- workflow_steps: JSON (Ordered workflow steps and configurations)
- approval_levels: JSON (Multi-level approval requirements)
- escalation_rules: JSON (Escalation conditions and paths)
- timeout_settings: JSON (Step timeout and reminder settings)
- notification_rules: JSON (Notification triggers and recipients)
- retry_configuration: JSON (Retry logic and limits)
- performance_metrics: JSON (Workflow performance tracking)
- compliance_requirements: JSON (Regulatory compliance requirements)
- security_controls: JSON (Security-specific controls and validations)
- audit_requirements: JSON (Audit trail and documentation requirements)
- is_active: BOOLEAN (Default: TRUE)
- version: INTEGER (Default: 1)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_workflow_type (workflow_type)
- INDEX idx_workflow_category (workflow_category)
- INDEX idx_trigger_event (trigger_event)
- INDEX idx_is_active (is_active)
- INDEX idx_version (version)

Constraints:
- fk_audit_log_workflow_definition_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_workflow_definition_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_audit_log_workflow_definition_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_version_positive CHECK (version > 0)
```

```
Table: audit_log_workflow_instance
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- workflow_definition_id: UUID (Foreign Key to audit_log_workflow_definition)
- user_id: UUID (Foreign Key to user)
- employee_id: UUID (Foreign Key to employee)
- instance_name: VARCHAR(200) (Required)
- current_step: INTEGER (Default: 1)
- workflow_status: ENUM('Initiated', 'In Progress', 'Pending Approval', 'Approved', 'Rejected', 'Completed', 'Cancelled', 'Escalated', 'Failed', 'On Hold')
- priority_level: ENUM('Low', 'Normal', 'High', 'Critical', 'Emergency')
- initiated_by_user_id: UUID (Foreign Key to user)
- current_assignee_id: UUID (Foreign Key to user)
- started_at: TIMESTAMP (Auto)
- due_date: TIMESTAMP
- completion_date: TIMESTAMP
- workflow_data: JSON (Workflow-specific data and context)
- step_history: JSON (History of completed steps)
- error_log: TEXT
- retry_count: INTEGER (Default: 0)
- performance_metrics: JSON (Instance performance data)
- compliance_tracking: JSON (Compliance requirement tracking)
- security_assessment: JSON (Security assessment data)
- audit_evidence: JSON (Audit evidence and documentation)
- comments: TEXT
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_workflow_definition_id (workflow_definition_id)
- INDEX idx_user_id (user_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_workflow_status (workflow_status)
- INDEX idx_priority_level (priority_level)
- INDEX idx_initiated_by_user_id (initiated_by_user_id)
- INDEX idx_current_assignee_id (current_assignee_id)
- INDEX idx_started_at (started_at)
- INDEX idx_due_date (due_date)

Constraints:
- fk_audit_log_workflow_instance_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_workflow_instance_definition FOREIGN KEY (workflow_definition_id) REFERENCES audit_log_workflow_definition(id)
- fk_audit_log_workflow_instance_user FOREIGN KEY (user_id) REFERENCES user(id)
- fk_audit_log_workflow_instance_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_audit_log_workflow_instance_initiated_by FOREIGN KEY (initiated_by_user_id) REFERENCES user(id)
- fk_audit_log_workflow_instance_current_assignee FOREIGN KEY (current_assignee_id) REFERENCES user(id)
- chk_step_positive CHECK (current_step > 0)
- chk_retry_positive CHECK (retry_count >= 0)
```

## 12.3.13 Audit Log Data Archival & Retention Schema

```
Table: audit_log_archival_policy
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- policy_name: VARCHAR(200) (Required)
- entity_type: ENUM('Audit Logs', 'Security Events', 'Access Records', 'Compliance Data', 'Performance Metrics', 'User Activity', 'System Events', 'Integration Logs')
- retention_period_years: INTEGER (Required)
- archival_trigger: ENUM('Age Based', 'Event Based', 'Manual', 'Scheduled', 'Compliance Required', 'Legal Requirement')
- archival_condition: JSON (Conditions for archival)
- storage_location: ENUM('Cold Storage', 'Archive Database', 'File System', 'Cloud Archive', 'Compliance Archive', 'Secure Vault', 'Write-Once Storage')
- compression_enabled: BOOLEAN (Default: TRUE)
- encryption_enabled: BOOLEAN (Default: TRUE)
- anonymization_enabled: BOOLEAN (Default: FALSE)
- access_restriction: ENUM('No Access', 'Read Only', 'Admin Only', 'Compliance Only', 'Audit Only', 'Legal Only', 'Court Order Required')
- retention_after_archive_years: INTEGER (Default: 7)
- auto_delete_after_retention: BOOLEAN (Default: FALSE)
- compliance_requirements: JSON (Regulatory retention requirements)
- data_classification: ENUM('Public', 'Internal', 'Confidential', 'Restricted', 'Highly Restricted')
- security_level: ENUM('Low', 'Medium', 'High', 'Critical')
- legal_hold_applicable: BOOLEAN (Default: FALSE)
- gdpr_right_to_erasure_applicable: BOOLEAN (Default: TRUE)
- sox_retention_required: BOOLEAN (Default: TRUE)
- hipaa_retention_required: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- last_run_date: DATE
- next_run_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_entity_type (entity_type)
- INDEX idx_archival_trigger (archival_trigger)
- INDEX idx_storage_location (storage_location)
- INDEX idx_access_restriction (access_restriction)
- INDEX idx_data_classification (data_classification)
- INDEX idx_security_level (security_level)
- INDEX idx_is_active (is_active)
- INDEX idx_last_run_date (last_run_date)
- INDEX idx_next_run_date (next_run_date)

Constraints:
- fk_audit_log_archival_policy_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_archival_policy_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_audit_log_archival_policy_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_retention_positive CHECK (retention_period_years > 0 AND retention_after_archive_years >= 0)
```

```
Table: audit_log_archived_data
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- archival_policy_id: UUID (Foreign Key to audit_log_archival_policy)
- original_table_name: VARCHAR(100) (Required)
- original_record_id: UUID (Required)
- entity_type: ENUM('Audit Logs', 'Security Events', 'Access Records', 'Compliance Data', 'Performance Metrics', 'User Activity', 'System Events', 'Integration Logs')
- archived_data: JSON (Complete archived record data)
- archive_date: DATE (Required)
- archive_reason: VARCHAR(200)
- storage_path: VARCHAR(500)
- file_size_bytes: BIGINT
- checksum_hash: VARCHAR(256)
- compression_ratio: DECIMAL(5,2)
- encryption_method: VARCHAR(100)
- data_sensitivity_level: ENUM('Public', 'Internal', 'Confidential', 'Restricted', 'Highly Restricted')
- security_assessment: JSON (Security assessment at time of archival)
- compliance_impact: JSON (Compliance impact assessment)
- legal_hold_status: ENUM('Not Applicable', 'Active', 'Released', 'Extended')
- gdpr_erasure_status: ENUM('Not Applicable', 'Eligible', 'Restricted', 'Permanently Deleted')
- sox_retention_status: ENUM('Not Applicable', 'Required', 'Expired', 'Extended')
- access_count: INTEGER (Default: 0)
- last_accessed_at: TIMESTAMP
- last_accessed_by_user_id: UUID (Foreign Key to user)
- access_reason: TEXT
- access_approval_required: BOOLEAN (Default: TRUE)
- access_approval_workflow_id: UUID (Foreign Key to approval_workflow)
- scheduled_deletion_date: DATE
- is_deleted: BOOLEAN (Default: FALSE)
- deleted_at: TIMESTAMP
- deleted_by_user_id: UUID (Foreign Key to user)
- deletion_method: VARCHAR(100)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_archival_policy_id (archival_policy_id)
- INDEX idx_original_table_name (original_table_name)
- INDEX idx_original_record_id (original_record_id)
- INDEX idx_entity_type (entity_type)
- INDEX idx_archive_date (archive_date)
- INDEX idx_data_sensitivity_level (data_sensitivity_level)
- INDEX idx_legal_hold_status (legal_hold_status)
- INDEX idx_gdpr_erasure_status (gdpr_erasure_status)
- INDEX idx_sox_retention_status (sox_retention_status)
- INDEX idx_scheduled_deletion_date (scheduled_deletion_date)
- INDEX idx_is_deleted (is_deleted)
- INDEX idx_last_accessed_at (last_accessed_at)
- INDEX idx_access_approval_required (access_approval_required)

Constraints:
- fk_audit_log_archived_data_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_audit_log_archived_data_policy FOREIGN KEY (archival_policy_id) REFERENCES audit_log_archival_policy(id)
- fk_audit_log_archived_data_last_accessed_by FOREIGN KEY (last_accessed_by_user_id) REFERENCES user(id)
- fk_audit_log_archived_data_access_approval_workflow FOREIGN KEY (access_approval_workflow_id) REFERENCES approval_workflow(id)
- fk_audit_log_archived_data_deleted_by FOREIGN KEY (deleted_by_user_id) REFERENCES user(id)
- fk_audit_log_archived_data_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_file_size_positive CHECK (file_size_bytes >= 0)
- chk_access_positive CHECK (access_count >= 0)
- chk_compression_range CHECK (compression_ratio BETWEEN 0 AND 1)
```

--- END OF SECTION 12.3.13 ---
