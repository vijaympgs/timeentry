<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olivine ERP - Toolbar Inspector</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .l4 {
            font-size: 11px;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Glassmorphism Inspector */
        .inspector-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 40px;
            width: 100%;
            max-width: 800px;
        }

        /* Tooltip refinement */
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transform: translateX(-50%) translateY(8px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .group:hover .tooltip {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .btn-hover-effect:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
        }

        .mode-toggle {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>

<body>

    <!-- INSPECTOR CONTROL PANEL -->
    <div class="inspector-panel">
        <div class="flex items-center gap-3 mb-6">
            <div class="p-2 bg-indigo-600 rounded-lg">
                <i data-lucide="settings-2" class="w-5 h-5 text-white"></i>
            </div>
            <h2 class="text-xl font-bold text-slate-800">Toolbar Configuration Inspector</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="flex flex-col gap-2">
                <label class="l4">Select Menu Item</label>
                <select id="menu-select"
                    class="w-full bg-white border border-slate-200 rounded-lg px-4 py-2.5 text-sm font-medium focus:ring-2 focus:ring-indigo-500/20 outline-none transition-all">
                    <!-- Populated by JS -->
                </select>
            </div>

            <div class="flex flex-col gap-2">
                <label class="l4">UI Mode</label>
                <div class="flex p-1 bg-slate-100 rounded-lg">
                    <button onclick="setMode('VIEW')" id="mode-view"
                        class="flex-1 py-1.5 text-xs font-bold rounded-md transition-all">VIEW</button>
                    <button onclick="setMode('EDIT')" id="mode-edit"
                        class="flex-1 py-1.5 text-xs font-bold rounded-md transition-all">EDIT</button>
                    <button onclick="setMode('NEW')" id="mode-new"
                        class="flex-1 py-1.5 text-xs font-bold rounded-md transition-all">NEW</button>
                </div>
            </div>
        </div>

        <div class="mt-8 pt-6 border-t border-slate-100 flex items-center justify-between">
            <div class="flex flex-col">
                <span class="l4 mb-1">Active Registry String</span>
                <code id="active-string" class="font-mono text-indigo-600 font-bold tracking-widest text-lg">---</code>
            </div>
            <div class="text-right">
                <span class="l4 mb-1">View Type</span>
                <div id="view-type-badge"
                    class="px-3 py-1 bg-slate-100 text-slate-600 text-[10px] font-bold rounded-full border border-slate-200 uppercase">
                    ---</div>
            </div>
        </div>
    </div>

    <!-- LIVE TOOLBAR PREVIEW -->
    <div class="l4 mb-4 text-center">Toolbar Preview</div>
    <div id="toolbar-container"
        class="bg-white border border-slate-200 rounded-xl shadow-xl px-6 py-2 flex items-center gap-1.5 min-h-[64px] transition-all">
        <div id="toolbar-root" class="flex items-center h-full"></div>
    </div>

    <div class="mt-20 max-w-2xl text-center">
        <p class="text-xs text-slate-400 leading-relaxed font-medium">
            This inspector validates the <span class="text-slate-600 font-bold">Character-Based Registry
                Governance</span>.<br>
            It dynamically filters the <span class="text-slate-600 font-bold">NESCKZTJAVPMRDHOXIYL1234QFBGW?</span>
            super-string based on the screen's applicable config and current interaction mode.
        </p>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        const MENU_ITEMS = [
            { id: 'item_master', label: 'Item Master', type: 'MASTER', config: 'NESCKVDXRQ!@#' },
            { id: 'purchase_order', label: 'Purchase Order', type: 'TRANSACTION', config: 'NESCKZTJAVPMRDXQ!@#' },
            { id: 'sales_order', label: 'Sales Order', type: 'TRANSACTION', config: 'NESCKZTJAVPMRDXQ!@#' },
            { id: 'customer_master', label: 'Customer Master', type: 'MASTER', config: 'NESCKVDXRQ!@#' },
            { id: 'user_management', label: 'User and Permission', type: 'MASTER', config: 'NESCKVDXRQ' },
            { id: 'layout_settings', label: 'Layout Settings', type: 'MASTER', config: 'NESCKVDXR' },
            { id: 'business_rules', label: 'Business Rules', type: 'MASTER', config: 'NESCKVDXR' },
            { id: 'company_settings', label: 'Company Settings', type: 'MASTER', config: 'ESXR' },
            { id: 'location_setup', label: 'Location Setup', type: 'MASTER', config: 'NESCKVDXR' },
            { id: 'fiscal_periods', label: 'Fiscal Periods', type: 'MASTER', config: 'NESCKVDXR' },
            { id: 'tax_config', label: 'Tax Configuration', type: 'MASTER', config: 'NESCKVDXR' }
        ];

        const ACTION_MAP = {
            'N': { id: 'new', icon: 'plus', label: 'New', shortcut: 'F2', color: 'text-indigo-600', group: 1 },
            'E': { id: 'edit', icon: 'edit', label: 'Edit', shortcut: 'F3', color: 'text-indigo-600', group: 1 },
            'S': { id: 'save', icon: 'save', label: 'Save', shortcut: 'F8', color: 'text-emerald-600', group: 1 },
            'C': { id: 'cancel', icon: 'x', label: 'Cancel', shortcut: 'Esc', color: 'text-slate-500', group: 1 },
            'K': { id: 'clear', icon: 'rotate-ccw', label: 'Clear', shortcut: 'F5', color: 'text-amber-500', group: 1 },
            'L': { id: 'clone', icon: 'copy', label: 'Clone', shortcut: 'Alt+C', color: 'text-indigo-500', group: 1 },

            'Z': { id: 'authorize', icon: 'check-circle', label: 'Authorize', shortcut: 'F10', color: 'text-emerald-700', group: 2 },
            'T': { id: 'submit', icon: 'send', label: 'Submit', shortcut: 'Alt+S', color: 'text-indigo-600', group: 2 },
            'J': { id: 'reject', icon: 'ban', label: 'Reject', shortcut: 'Alt+R', color: 'text-rose-500', group: 2 },
            'A': { id: 'amend', icon: 'file-edit', label: 'Amend', shortcut: 'Alt+A', color: 'text-amber-600', group: 2 },
            'H': { id: 'hold', icon: 'pause-circle', label: 'Hold', shortcut: 'Alt+H', color: 'text-amber-500', group: 2 },
            'O': { id: 'void', icon: 'x-octagon', label: 'Void', shortcut: 'Alt+V', color: 'text-rose-700', group: 2 },

            'V': { id: 'view', icon: 'eye', label: 'View', shortcut: 'F7', color: 'text-slate-600', group: 3 },
            'P': { id: 'print', icon: 'printer', label: 'Print', shortcut: 'Ctrl+P', color: 'text-slate-600', group: 3 },
            'M': { id: 'email', icon: 'mail', label: 'Email', shortcut: 'Ctrl+E', color: 'text-slate-600', group: 3 },

            '1': { id: 'first', icon: 'chevron-first', label: 'First', shortcut: 'Home', color: 'text-slate-400', group: 4 },
            '2': { id: 'prev', icon: 'chevron-left', label: 'Prev', shortcut: 'PgUp', color: 'text-slate-400', group: 4 },
            '3': { id: 'next', icon: 'chevron-right', label: 'Next', shortcut: 'PgDn', color: 'text-slate-400', group: 4 },
            '4': { id: 'last', icon: 'chevron-last', label: 'Last', shortcut: 'End', color: 'text-slate-400', group: 4 },

            'R': { id: 'refresh', icon: 'refresh-cw', label: 'Refresh', shortcut: 'F9', color: 'text-cyan-600', group: 5 },
            'D': { id: 'delete', icon: 'trash-2', label: 'Delete', shortcut: 'F4', color: 'text-rose-600', group: 5 },
            'I': { id: 'import', icon: 'upload', label: 'Import', shortcut: 'Ctrl+I', color: 'text-slate-500', group: 5 },
            'Y': { id: 'export', icon: 'download', label: 'Export', shortcut: 'Ctrl+E', color: 'text-slate-500', group: 5 },

            'Q': { id: 'search', icon: 'search', label: 'Search', shortcut: 'Ctrl+F', color: 'text-slate-600', group: 6 },
            'F': { id: 'filter', icon: 'filter', label: 'Filter', shortcut: 'Alt+F', color: 'text-slate-600', group: 6 },

            '!': { id: 'customer_lookup', icon: 'users', label: 'Customer', shortcut: 'F11', color: 'text-blue-600', group: 7 },
            '@': { id: 'supplier_lookup', icon: 'truck', label: 'Supplier', shortcut: 'F12', color: 'text-blue-700', group: 7 },
            '#': { id: 'item_lookup', icon: 'package', label: 'Item', shortcut: 'Alt+I', color: 'text-sky-600', group: 7 },

            'B': { id: 'notes', icon: 'sticky-note', label: 'Notes', shortcut: 'Alt+N', color: 'text-amber-400', group: 8 },
            'G': { id: 'attach', icon: 'paperclip', label: 'Attach', shortcut: 'Alt+U', color: 'text-slate-400', group: 8 },
            'W': { id: 'settings', icon: 'wrench', label: 'Settings', shortcut: 'Alt+O', color: 'text-slate-400', group: 8 },
            '?': { id: 'help', icon: 'help-circle', label: 'Help', shortcut: 'F1', color: 'text-blue-500', group: 8 },
            'X': { id: 'exit', icon: 'log-out', label: 'Exit', shortcut: 'Esc', color: 'text-slate-400', group: 9 }
        };

        // Mode Visibility Rules
        const MODE_VISIBILITY = {
            'VIEW': 'NEVZPM1234RDQIYQFBGW?X',
            'EDIT': 'SCKX?Q!@#',
            'NEW': 'SCKX?Q!@#'
        };

        let currentMode = 'VIEW';
        let currentItem = MENU_ITEMS[0];

        function init() {
            const select = document.getElementById('menu-select');
            MENU_ITEMS.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.innerText = item.label;
                select.appendChild(opt);
            });

            select.onchange = (e) => {
                currentItem = MENU_ITEMS.find(i => i.id === e.target.value);
                render();
            };

            setMode('VIEW');
            render();
        }

        function setMode(mode) {
            currentMode = mode;
            ['VIEW', 'EDIT', 'NEW'].forEach(m => {
                const btn = document.getElementById(`mode-${m.toLowerCase()}`);
                if (m === mode) {
                    btn.className = 'flex-1 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm text-indigo-600';
                } else {
                    btn.className = 'flex-1 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-slate-600 transition-colors';
                }
            });
            render();
        }

        function render() {
            const root = document.getElementById('toolbar-root');
            root.innerHTML = '';

            document.getElementById('active-string').innerText = currentItem.config;
            document.getElementById('view-type-badge').innerText = currentItem.type;

            // Step 1: Filter characters by Applicable Config
            const applicableChars = currentItem.config.split('');

            // Step 2: Filter by Mode Visibility
            const modeAllowed = MODE_VISIBILITY[currentMode];
            const visibleChars = applicableChars.filter(char => modeAllowed.includes(char));

            let currentGroup = 0;

            visibleChars.forEach(char => {
                const action = ACTION_MAP[char];
                if (!action) return;

                if (action.group !== currentGroup && currentGroup !== 0) {
                    const sep = document.createElement('div');
                    sep.className = 'h-6 w-px bg-slate-200 mx-2 self-center';
                    root.appendChild(sep);
                }
                currentGroup = action.group;

                const btnContainer = document.createElement('div');
                btnContainer.className = "relative group";

                const tooltip = document.createElement('div');
                tooltip.className = "tooltip absolute top-full left-1/2 mt-2 px-3 py-2 bg-slate-900 text-white rounded-lg shadow-2xl z-[100] pointer-events-none whitespace-nowrap";
                tooltip.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-[11px] font-bold text-slate-300 uppercase leading-none">${action.label}</span>
                        <span class="font-mono text-[10px] bg-slate-800 text-cyan-400 px-1.5 py-0.5 rounded border border-slate-700 leading-none">${action.shortcut}</span>
                    </div>
                `;

                const btn = document.createElement('button');
                btn.className = `
                    flex flex-col items-center justify-center gap-1 min-w-[56px] h-[48px] rounded-lg
                    transition-all duration-200 bg-transparent btn-hover-effect
                    hover:bg-slate-100/80 active:bg-slate-200 cursor-pointer
                    outline-none border-0
                `;

                const iconEl = document.createElement('i');
                iconEl.setAttribute('data-lucide', action.icon);
                iconEl.className = `w-[18px] h-[18px] ${action.color}`;

                const labelEl = document.createElement('span');
                labelEl.className = 'text-[10px] font-bold text-slate-600';
                labelEl.innerText = action.label;

                btn.appendChild(iconEl);
                btn.appendChild(labelEl);

                btnContainer.appendChild(btn);
                btnContainer.appendChild(tooltip);
                root.appendChild(btnContainer);
            });

            lucide.createIcons();
        }

        init();
    </script>
</body>

</html>