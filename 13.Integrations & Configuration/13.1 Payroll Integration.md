# 13.1 Payroll Integration

## 13.1.1 Business Purpose & Scope

## 13.1.1.1 Business Purpose

Payroll Integration provides a robust framework for seamless data synchronization between the HR system and external payroll providers, ensuring accurate, timely, and compliant payroll processing. This integration eliminates manual data entry, reduces errors, ensures regulatory compliance, and enables real-time payroll visibility while maintaining data integrity across HR and payroll systems through automated workflows, validation rules, and comprehensive audit trails.

## 13.1.1.2 Business Scope

Enable comprehensive payroll integration management including multi-provider support, bi-directional data synchronization, automated payroll calculations, tax compliance, benefits deductions, time-off integration, error handling and reconciliation, reporting and analytics, and audit trail maintenance. The system supports various payroll providers, custom integration configurations, validation rules, approval workflows, compliance monitoring, and provides seamless integration with HR modules including employee management, time & attendance, benefits administration, and compensation management while ensuring data security, privacy, and regulatory compliance.

--- END OF SECTION 13.1.1 ---

## 13.1.2 Payroll Provider Configuration Schema

```
Table: payroll_provider_config
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_name: VARCHAR(200) (Required)
- provider_type: ENUM('ADP', 'Paychex', 'Gusto', 'QuickBooks', 'Workday', 'Ceridian', 'UKG', 'Custom API', 'SFTP', 'File Import')
- provider_code: VARCHAR(50) (Required, Unique, Indexed)
- integration_method: ENUM('API', 'SFTP', 'File Upload', 'Webhook', 'Database Link')
- api_endpoint_url: VARCHAR(500)
- api_version: VARCHAR(20) (Default: 'v1')
- authentication_type: ENUM('API Key', 'OAuth 2.0', 'Basic Auth', 'Certificate', 'SSH Key')
- authentication_config: JSON (Encrypted authentication credentials)
- data_format: ENUM('JSON', 'XML', 'CSV', 'Fixed Width', 'Excel')
- encoding_format: VARCHAR(20) (Default: 'UTF-8')
- sync_frequency: ENUM('Real-time', 'Every 15 mins', 'Hourly', 'Daily', 'Weekly', 'On-demand')
- sync_direction: ENUM('Bidirectional', 'Inbound Only', 'Outbound Only')
- is_primary_provider: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- connection_status: ENUM('Connected', 'Disconnected', 'Error', 'Testing', 'Maintenance')
- last_sync_at: TIMESTAMP
- last_successful_sync_at: TIMESTAMP
- error_count: INTEGER (Default: 0)
- max_retry_attempts: INTEGER (Default: 3)
- timeout_seconds: INTEGER (Default: 30)
- rate_limit_per_hour: INTEGER (Default: 1000)
- supported_entities: JSON (Employee, Payroll, Taxes, Benefits, Time-off)
- field_mappings: JSON (Field mapping between HR and payroll systems)
- validation_rules: JSON (Data validation rules)
- transformation_rules: JSON (Data transformation logic)
- compliance_settings: JSON (Compliance and regulatory settings)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_payroll_provider_company_code (provider_code, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_type (provider_type)
- INDEX idx_integration_method (integration_method)
- INDEX idx_is_primary_provider (is_primary_provider)
- INDEX idx_is_active (is_active)
- INDEX idx_connection_status (connection_status)
- INDEX idx_last_sync_at (last_sync_at)
- INDEX idx_last_successful_sync_at (last_successful_sync_at)

Constraints:
- fk_payroll_provider_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_provider_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_payroll_provider_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_error_count_valid CHECK (error_count >= 0 AND error_count <= max_retry_attempts)
- chk_positive_values CHECK (timeout_seconds > 0 AND rate_limit_per_hour > 0 AND max_retry_attempts >= 0)
```

--- END OF SECTION 13.1.2 ---

## 13.1.3 Payroll Data Synchronization Schema

```
Table: payroll_sync_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- sync_batch_id: VARCHAR(100) (Required, Indexed)
- sync_type: ENUM('Full Sync', 'Incremental Sync', 'Employee Sync', 'Payroll Run', 'Tax Update', 'Benefits Sync')
- sync_direction: ENUM('Outbound', 'Inbound', 'Bidirectional')
- sync_status: ENUM('Initiated', 'In Progress', 'Completed', 'Failed', 'Partial Success', 'Cancelled')
- priority_level: ENUM('Low', 'Normal', 'High', 'Critical', 'Emergency')
- initiated_by_user_id: UUID (Foreign Key to user)
- initiated_at: TIMESTAMP (Auto)
- started_at: TIMESTAMP
- completed_at: TIMESTAMP
- duration_seconds: INTEGER
- total_records_processed: INTEGER (Default: 0)
- successful_records: INTEGER (Default: 0)
- failed_records: INTEGER (Default: 0)
- skipped_records: INTEGER (Default: 0)
- error_details: JSON (Detailed error information)
- warning_messages: JSON (Warning messages and issues)
- data_source: ENUM('HR System', 'Payroll Provider', 'Manual Upload', 'Scheduled Job')
- entity_types: JSON (Types of entities synchronized)
- sync_criteria: JSON (Selection criteria for records)
- validation_results: JSON (Data validation outcomes)
- transformation_applied: BOOLEAN (Default: FALSE)
- rollback_available: BOOLEAN (Default: TRUE)
- rollback_deadline: TIMESTAMP
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_sync_batch_id (sync_batch_id)
- INDEX idx_sync_type (sync_type)
- INDEX idx_sync_direction (sync_direction)
- INDEX idx_sync_status (sync_status)
- INDEX idx_priority_level (priority_level)
- INDEX idx_initiated_by_user_id (initiated_by_user_id)
- INDEX idx_initiated_at (initiated_at)
- INDEX idx_started_at (started_at)
- INDEX idx_completed_at (completed_at)

Constraints:
- fk_payroll_sync_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_sync_provider_config FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_sync_initiated_by FOREIGN KEY (initiated_by_user_id) REFERENCES user(id)
- chk_positive_records CHECK (total_records_processed >= 0 AND successful_records >= 0 AND failed_records >= 0 AND skipped_records >= 0)
- chk_record_totals CHECK (total_records_processed = successful_records + failed_records + skipped_records)
- chk_duration_positive CHECK (duration_seconds >= 0)
```

```
Table: payroll_sync_detail
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- sync_log_id: UUID (Foreign Key to payroll_sync_log)
- employee_id: UUID (Foreign Key to employee)
- entity_type: ENUM('Employee', 'Compensation', 'Tax', 'Benefits', 'Time-off', 'Deduction', 'Pay Period')
- entity_id: UUID
- operation_type: ENUM('Create', 'Update', 'Delete', 'Read', 'Validate')
- sync_status: ENUM('Pending', 'In Progress', 'Completed', 'Failed', 'Skipped', 'Rolled Back')
- source_data: JSON (Original data from source system)
- target_data: JSON (Data sent to target system)
- response_data: JSON (Response from target system)
- field_changes: JSON (Specific fields that were changed)
- validation_errors: JSON (Data validation errors)
- business_rule_violations: JSON (Business rule violations)
- retry_count: INTEGER (Default: 0)
- max_retries: INTEGER (Default: 3)
- next_retry_at: TIMESTAMP
- error_message: TEXT
- processing_time_ms: INTEGER
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_sync_log_id (sync_log_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_entity_type (entity_type)
- INDEX idx_entity_id (entity_id)
- INDEX idx_operation_type (operation_type)
- INDEX idx_sync_status (sync_status)
- INDEX idx_retry_count (retry_count)
- INDEX idx_next_retry_at (next_retry_at)

Constraints:
- fk_payroll_sync_detail_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_sync_detail_log FOREIGN KEY (sync_log_id) REFERENCES payroll_sync_log(id)
- fk_payroll_sync_detail_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- chk_retry_valid CHECK (retry_count >= 0 AND retry_count <= max_retries)
- chk_processing_time_positive CHECK (processing_time_ms >= 0)
```

--- END OF SECTION 13.1.3 ---

## 13.1.4 Payroll Governance & Access Control Schema

```
Table: payroll_role_permission
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- role_name: VARCHAR(100) (Required, Unique, Indexed)
- role_description: TEXT
- role_type: ENUM('PAYROLL_ADMIN', 'PAYROLL_MANAGER', 'PAYROLL_SPECIALIST', 'HR_ADMIN', 'FINANCE_MANAGER', 'COMPLIANCE_OFFICER', 'AUDITOR', 'VIEWER')
- can_configure_providers: BOOLEAN (Default: FALSE)
- can_manage_sync: BOOLEAN (Default: FALSE)
- can_initiate_payroll: BOOLEAN (Default: FALSE)
- can_approve_payroll: BOOLEAN (Default: FALSE)
- can_view_sensitive_data: BOOLEAN (Default: FALSE)
- can_edit_compensation: BOOLEAN (Default: FALSE)
- can_manage_taxes: BOOLEAN (Default: FALSE)
- can_view_reports: BOOLEAN (Default: FALSE)
- can_export_data: BOOLEAN (Default: FALSE)
- can_manage_integrations: BOOLEAN (Default: FALSE)
- can_view_audit_logs: BOOLEAN (Default: FALSE)
- can_handle_exceptions: BOOLEAN (Default: FALSE)
- can_approve_overrides: BOOLEAN (Default: FALSE)
- data_access_level: ENUM('ALL', 'DEPARTMENT', 'REGION', 'OWN', 'NONE')
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_payroll_role_name_company (role_name, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_role_type (role_type)
- INDEX idx_is_active (is_active)
- INDEX idx_data_access_level (data_access_level)

Constraints:
- fk_payroll_role_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_role_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
```

```
Table: payroll_user_role_assignment
Fields:
- id: UUID (Primary Key)
- user_id: UUID (Foreign Key to user)
- role_id: UUID (Foreign Key to payroll_role_permission)
- company_id: UUID (Foreign Key to company)
- department_id: UUID (Foreign Key to department)
- region_id: UUID (Foreign Key to region)
- assigned_by_user_id: UUID (Foreign Key to user)
- assigned_date: TIMESTAMP (Auto)
- expiry_date: DATE
- is_active: BOOLEAN (Default: TRUE)
- assignment_notes: TEXT
- security_clearance_level: ENUM('Basic', 'Standard', 'Enhanced', 'Top Secret')
- background_check_required: BOOLEAN (Default: FALSE)
- background_check_status: ENUM('Not Required', 'Pending', 'Passed', 'Failed', 'Expired')
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_payroll_user_role_company (user_id, role_id, company_id)
- INDEX idx_user_id (user_id)
- INDEX idx_role_id (role_id)
- INDEX idx_company_id (company_id)
- INDEX idx_department_id (department_id)
- INDEX idx_region_id (region_id)
- INDEX idx_is_active (is_active)
- INDEX idx_expiry_date (expiry_date)
- INDEX idx_security_clearance_level (security_clearance_level)

Constraints:
- fk_payroll_user_role_user FOREIGN KEY (user_id) REFERENCES user(id)
- fk_payroll_user_role_role FOREIGN KEY (role_id) REFERENCES payroll_role_permission(id)
- fk_payroll_user_role_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_user_role_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_payroll_user_role_region FOREIGN KEY (region_id) REFERENCES region(id)
- fk_payroll_user_role_assigned_by FOREIGN KEY (assigned_by_user_id) REFERENCES user(id)
```

--- END OF SECTION 13.1.4 ---

## 13.1.5 Payroll Integration & Audit Performance Schema

```
Table: payroll_integration_monitoring
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- monitoring_date: DATE (Required)
- api_response_time_ms: INTEGER
- sync_success_rate: DECIMAL(5,2) (Percentage)
- data_accuracy_score: DECIMAL(5,2) (Percentage)
- error_rate: DECIMAL(5,2) (Percentage)
- throughput_records_per_hour: INTEGER
- availability_percentage: DECIMAL(5,2)
- data_latency_minutes: INTEGER
- connection_drops: INTEGER (Default: 0)
- timeout_incidents: INTEGER (Default: 0)
- validation_failures: INTEGER (Default: 0)
- business_rule_violations: INTEGER (Default: 0)
- manual_interventions: INTEGER (Default: 0)
- rollback_incidents: INTEGER (Default: 0)
- performance_score: DECIMAL(5,2) (Overall performance rating)
- sla_compliance: BOOLEAN (Default: TRUE)
- critical_incidents: INTEGER (Default: 0)
- warning_incidents: INTEGER (Default: 0)
- system_load_percentage: DECIMAL(5,2)
- memory_usage_mb: INTEGER
- cpu_usage_percentage: DECIMAL(5,2)
- network_latency_ms: INTEGER
- disk_io_wait_ms: INTEGER
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_monitoring_date (monitoring_date)
- INDEX idx_sync_success_rate (sync_success_rate)
- INDEX idx_data_accuracy_score (data_accuracy_score)
- INDEX idx_error_rate (error_rate)
- INDEX idx_performance_score (performance_score)
- INDEX idx_sla_compliance (sla_compliance)

Constraints:
- fk_payroll_monitoring_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_monitoring_provider_config FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- chk_positive_integers CHECK (api_response_time_ms >= 0 AND throughput_records_per_hour >= 0 AND connection_drops >= 0)
- chk_score_ranges CHECK (sync_success_rate BETWEEN 0 AND 100 AND data_accuracy_score BETWEEN 0 AND 100 AND error_rate BETWEEN 0 AND 100)
- chk_performance_range CHECK (performance_score BETWEEN 0 AND 100)
```

```
Table: payroll_audit_trail
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- sync_log_id: UUID (Foreign Key to payroll_sync_log)
- audit_type: ENUM('Data Sync', 'Configuration Change', 'Access Control', 'Security Incident', 'Compliance Check', 'Performance Issue')
- action: ENUM('Create', 'Update', 'Delete', 'Activate', 'Deactivate', 'Sync', 'Export', 'Import', 'Approve', 'Reject')
- entity_type: ENUM('Provider Config', 'Sync Log', 'User Role', 'Employee Data', 'Payroll Run', 'Tax Setting')
- entity_id: UUID
- old_values: JSON (Previous values before change)
- new_values: JSON (New values after change)
- field_changes: JSON (Specific field changes)
- action_reason: TEXT
- business_justification: TEXT
- impact_assessment: TEXT
- risk_level: ENUM('Low', 'Medium', 'High', 'Critical')
- compliance_impact: TEXT
- affected_employees: INTEGER (Default: 0)
- data_sensitivity_level: ENUM('Public', 'Internal', 'Confidential', 'Restricted', 'PII')
- regulatory_impact: ENUM('None', 'SOX', 'GDPR', 'CCPA', 'HIPAA', 'FLSA', 'IRS')
- performed_by_user_id: UUID (Foreign Key to user)
- ip_address: VARCHAR(45)
- user_agent: TEXT
- session_id: VARCHAR(100)
- timestamp: TIMESTAMP (Auto)
- additional_context: JSON (Extra context information)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_sync_log_id (sync_log_id)
- INDEX idx_audit_type (audit_type)
- INDEX idx_action (action)
- INDEX idx_entity_type (entity_type)
- INDEX idx_risk_level (risk_level)
- INDEX idx_performed_by_user_id (performed_by_user_id)
- INDEX idx_timestamp (timestamp)
- INDEX idx_data_sensitivity_level (data_sensitivity_level)

Constraints:
- fk_payroll_audit_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_audit_provider_config FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_audit_sync_log FOREIGN KEY (sync_log_id) REFERENCES payroll_sync_log(id)
- fk_payroll_audit_performed_by FOREIGN KEY (performed_by_user_id) REFERENCES user(id)
- chk_affected_employees_positive CHECK (affected_employees >= 0)
```

--- END OF SECTION 13.1.5 ---

## 13.1.6 Payroll Tax Compliance & Reporting Schema

```
Table: payroll_tax_configuration
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- tax_type: ENUM('Federal Income Tax', 'State Income Tax', 'Local Tax', 'FICA', 'FUTA', 'SUTA', 'Medicare', 'Social Security')
- tax_jurisdiction: VARCHAR(100) (Required)
- tax_code: VARCHAR(50) (Required, Indexed)
- tax_rate_type: ENUM('Percentage', 'Fixed Amount', 'Tiered', 'Progressive')
- tax_rate: DECIMAL(10,6)
- tax_rate_effective_date: DATE (Required)
- tax_rate_expiry_date: DATE
- wage_base_limit: DECIMAL(15,2)
- annual_wage_base: DECIMAL(15,2)
- employer_rate: DECIMAL(10,6)
- employee_rate: DECIMAL(10,6)
- additional_rate: DECIMAL(10,6)
- exemption_types: JSON (Types of exemptions available)
- deduction_types: JSON (Types of deductions available)
- filing_requirements: JSON (Filing requirements and deadlines)
- payment_schedule: ENUM('Monthly', 'Quarterly', 'Semi-Annual', 'Annual')
- form_requirements: JSON (Required tax forms)
- compliance_rules: JSON (Compliance validation rules)
- is_active: BOOLEAN (Default: TRUE)
- last_updated_by_tax_authority: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_tax_type (tax_type)
- INDEX idx_tax_jurisdiction (tax_jurisdiction)
- INDEX idx_tax_code (tax_code)
- INDEX idx_tax_rate_effective_date (tax_rate_effective_date)
- INDEX idx_is_active (is_active)

Constraints:
- fk_payroll_tax_config_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_tax_config_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_tax_config_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_payroll_tax_config_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_positive_rates CHECK (tax_rate >= 0 AND employer_rate >= 0 AND employee_rate >= 0 AND additional_rate >= 0)
- chk_positive_amounts CHECK (wage_base_limit >= 0 AND annual_wage_base >= 0)
- chk_effective_order CHECK (tax_rate_expiry_date IS NULL OR tax_rate_expiry_date >= tax_rate_effective_date)
```

```
Table: payroll_tax_filing
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- filing_period: ENUM('Monthly', 'Quarterly', 'Semi-Annual', 'Annual')
- tax_year: INTEGER (Required)
- tax_quarter: INTEGER
- tax_month: INTEGER
- filing_type: ENUM('Form 941', 'Form 940', 'State Quarterly', 'State Annual', 'W-2', 'W-3', '1099', 'Local Tax')
- filing_status: ENUM('Pending', 'Prepared', 'Submitted', 'Accepted', 'Rejected', 'Amended', 'Completed')
- due_date: DATE (Required)
- filed_date: DATE
- accepted_date: DATE
- total_employees: INTEGER (Default: 0)
- total_wages: DECIMAL(15,2) (Default: 0.00)
- total_tax_withheld: DECIMAL(15,2) (Default: 0.00)
- total_employer_tax: DECIMAL(15,2) (Default: 0.00)
- total_tax_deposited: DECIMAL(15,2) (Default: 0.00)
- tax_balance_due: DECIMAL(15,2) (Default: 0.00)
- penalty_amount: DECIMAL(15,2) (Default: 0.00)
- interest_amount: DECIMAL(15,2) (Default: 0.00)
- filing_confirmation_number: VARCHAR(100)
- electronic_filing_id: VARCHAR(100)
- submission_method: ENUM('Electronic', 'Paper', 'Third Party')
- prepared_by_user_id: UUID (Foreign Key to user)
- approved_by_user_id: UUID (Foreign Key to user)
- filed_by_user_id: UUID (Foreign Key to user)
- attachment_urls: JSON (Links to supporting documents)
- notes: TEXT
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_filing_period (filing_period)
- INDEX idx_tax_year (tax_year)
- INDEX idx_filing_type (filing_type)
- INDEX idx_filing_status (filing_status)
- INDEX idx_due_date (due_date)
- INDEX idx_filed_date (filed_date)

Constraints:
- fk_payroll_tax_filing_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_tax_filing_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_tax_filing_prepared_by FOREIGN KEY (prepared_by_user_id) REFERENCES user(id)
- fk_payroll_tax_filing_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_payroll_tax_filing_filed_by FOREIGN KEY (filed_by_user_id) REFERENCES user(id)
- chk_positive_values CHECK (total_employees >= 0 AND total_wages >= 0 AND total_tax_withheld >= 0)
- chk_quarter_range CHECK (tax_quarter IS NULL OR (tax_quarter >= 1 AND tax_quarter <= 4))
- chk_month_range CHECK (tax_month IS NULL OR (tax_month >= 1 AND tax_month <= 12))
```

--- END OF SECTION 13.1.6 ---

## 13.1.7 Payroll Analytics & Insights Schema

```
Table: payroll_analytics_dashboard
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- dashboard_name: VARCHAR(200) (Required)
- dashboard_type: ENUM('Executive', 'Manager', 'Payroll Admin', 'Compliance', 'Financial', 'Operational')
- analysis_period: ENUM('Daily', 'Weekly', 'Monthly', 'Quarterly', 'Yearly', 'YTD', 'Custom')
- report_date: DATE (Required)
- total_payroll_cost: DECIMAL(15,2) (Default: 0.00)
- gross_payroll: DECIMAL(15,2) (Default: 0.00)
- net_payroll: DECIMAL(15,2) (Default: 0.00)
- total_deductions: DECIMAL(15,2) (Default: 0.00)
- total_taxes: DECIMAL(15,2) (Default: 0.00)
- total_benefits: DECIMAL(15,2) (Default: 0.00)
- overtime_cost: DECIMAL(15,2) (Default: 0.00)
- bonus_cost: DECIMAL(15,2) (Default: 0.00)
- commission_cost: DECIMAL(15,2) (Default: 0.00)
- average_salary: DECIMAL(15,2) (Default: 0.00)
- median_salary: DECIMAL(15,2) (Default: 0.00)
- payroll_variance_percentage: DECIMAL(5,2) (Default: 0.00)
- budget_variance_percentage: DECIMAL(5,2) (Default: 0.00)
- headcount: INTEGER (Default: 0)
- active_employees: INTEGER (Default: 0)
- new_hires: INTEGER (Default: 0)
- terminated_employees: INTEGER (Default: 0)
- cost_per_employee: DECIMAL(15,2) (Default: 0.00)
- labor_cost_percentage: DECIMAL(5,2) (Default: 0.00)
- overtime_percentage: DECIMAL(5,2) (Default: 0.00)
- error_rate: DECIMAL(5,2) (Default: 0.00)
- compliance_score: DECIMAL(5,2) (Default: 100.00)
- additional_metrics: JSON (Other KPIs and breakdowns)
- trend_data: JSON (Historical trend information)
- department_breakdown: JSON (Department-wise payroll data)
- location_breakdown: JSON (Location-wise payroll data)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_dashboard_type (dashboard_type)
- INDEX idx_analysis_period (analysis_period)
- INDEX idx_report_date (report_date)
- INDEX idx_total_payroll_cost (total_payroll_cost)
- INDEX idx_headcount (headcount)
- INDEX idx_compliance_score (compliance_score)

Constraints:
- fk_payroll_analytics_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_analytics_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_analytics_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_positive_amounts CHECK (total_payroll_cost >= 0 AND gross_payroll >= 0 AND net_payroll >= 0)
- chk_positive_counts CHECK (headcount >= 0 AND active_employees >= 0 AND new_hires >= 0)
- chk_percentage_ranges CHECK (payroll_variance_percentage BETWEEN -100 AND 100 AND compliance_score BETWEEN 0 AND 100)
```

```
Table: payroll_cost_analysis
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- analysis_date: DATE (Required)
- cost_category: ENUM('Salary', 'Wages', 'Overtime', 'Bonuses', 'Commissions', 'Benefits', 'Taxes', 'Deductions', 'Administrative')
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- job_category_id: UUID (Foreign Key to job_category)
- cost_amount: DECIMAL(15,2) (Required)
- cost_percentage: DECIMAL(5,2) (Percentage of total payroll)
- budget_amount: DECIMAL(15,2)
- variance_amount: DECIMAL(15,2)
- variance_percentage: DECIMAL(5,2)
- employee_count: INTEGER (Default: 0)
- average_cost_per_employee: DECIMAL(15,2)
- period_over_period_change: DECIMAL(5,2)
- year_over_year_change: DECIMAL(5,2)
- cost_driver: VARCHAR(200)
- cost_trend: ENUM('Increasing', 'Decreasing', 'Stable', 'Volatile')
- efficiency_score: DECIMAL(5,2)
- benchmark_comparison: DECIMAL(5,2)
- cost_optimization_opportunities: JSON
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_analysis_date (analysis_date)
- INDEX idx_cost_category (cost_category)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_cost_amount (cost_amount)
- INDEX idx_cost_percentage (cost_percentage)
- INDEX idx_variance_percentage (variance_percentage)

Constraints:
- fk_payroll_cost_analysis_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_cost_analysis_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_cost_analysis_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_payroll_cost_analysis_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_payroll_cost_analysis_job_category FOREIGN KEY (job_category_id) REFERENCES job_category(id)
- fk_payroll_cost_analysis_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_positive_amounts CHECK (cost_amount >= 0 AND average_cost_per_employee >= 0)
- chk_positive_counts CHECK (employee_count >= 0)
- chk_percentage_ranges CHECK (cost_percentage BETWEEN 0 AND 100 AND efficiency_score BETWEEN 0 AND 100)
```

--- END OF SECTION 13.1.7 ---

## 13.1.8 Payroll Communication & Notification Schema

```
Table: payroll_notification_template
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- template_name: VARCHAR(200) (Required, Unique, Indexed)
- template_type: ENUM('Payroll Processing', 'Sync Status', 'Error Alert', 'Compliance Reminder', 'Tax Filing', 'System Maintenance', 'Approval Required')
- notification_category: ENUM('Information', 'Warning', 'Error', 'Success', 'Reminder', 'Alert')
- subject_template: VARCHAR(500) (Required)
- body_template: TEXT (Required)
- template_variables: JSON (Variables that can be substituted)
- delivery_channels: JSON (Email, SMS, In-App, Push, Webhook)
- priority_level: ENUM('Low', 'Normal', 'High', 'Critical', 'Emergency')
- is_active: BOOLEAN (Default: TRUE)
- is_default: BOOLEAN (Default: FALSE)
- language_code: VARCHAR(10) (Default: 'en')
- html_enabled: BOOLEAN (Default: TRUE)
- attachment_templates: JSON (Template for attachments)
- approval_required: BOOLEAN (Default: FALSE)
- approval_workflow_id: UUID (Foreign Key to approval_workflow)
- approved_by_user_id: UUID (Foreign Key to user)
- approved_at: TIMESTAMP
- version: INTEGER (Default: 1)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_payroll_template_company_name (template_name, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_template_type (template_type)
- INDEX idx_notification_category (notification_category)
- INDEX idx_priority_level (priority_level)
- INDEX idx_is_active (is_active)
- INDEX idx_is_default (is_default)
- INDEX idx_language_code (language_code)
- INDEX idx_approval_workflow_id (approval_workflow_id)

Constraints:
- fk_payroll_template_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_template_approval_workflow FOREIGN KEY (approval_workflow_id) REFERENCES approval_workflow(id)
- fk_payroll_template_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_payroll_template_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_payroll_template_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_version_positive CHECK (version > 0)
```

```
Table: payroll_notification_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- template_id: UUID (Foreign Key to payroll_notification_template)
- notification_type: ENUM('Payroll Sync Started', 'Payroll Sync Completed', 'Sync Failed', 'Tax Filing Due', 'Compliance Alert', 'System Error', 'Maintenance Notice')
- recipient_type: ENUM('User', 'Role', 'Department', 'All Admins', 'External System')
- recipient_id: UUID
- recipient_email: VARCHAR(200)
- recipient_phone: VARCHAR(50)
- delivery_channel: ENUM('Email', 'SMS', 'In-App', 'Push Notification', 'Webhook')
- priority_level: ENUM('Low', 'Normal', 'High', 'Critical', 'Emergency')
- status: ENUM('Pending', 'Sent', 'Delivered', 'Failed', 'Bounced', 'Opened', 'Clicked')
- subject: VARCHAR(500)
- message_body: TEXT
- template_variables_used: JSON (Actual values substituted)
- attachment_urls: JSON (Links to attachments)
- sent_at: TIMESTAMP
- delivered_at: TIMESTAMP
- opened_at: TIMESTAMP
- clicked_at: TIMESTAMP
- failed_at: TIMESTAMP
- failure_reason: TEXT
- retry_count: INTEGER (Default: 0)
- max_retries: INTEGER (Default: 3)
- next_retry_at: TIMESTAMP
- external_message_id: VARCHAR(200) (ID from external service)
- response_data: JSON (Response from notification service)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_template_id (template_id)
- INDEX idx_notification_type (notification_type)
- INDEX idx_recipient_type (recipient_type)
- INDEX idx_recipient_id (recipient_id)
- INDEX idx_delivery_channel (delivery_channel)
- INDEX idx_priority_level (priority_level)
- INDEX idx_status (status)
- INDEX idx_sent_at (sent_at)
- INDEX idx_retry_count (retry_count)

Constraints:
- fk_payroll_notification_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_notification_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_notification_template FOREIGN KEY (template_id) REFERENCES payroll_notification_template(id)
- fk_payroll_notification_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_retry_valid CHECK (retry_count >= 0 AND retry_count <= max_retries)
```

--- END OF SECTION 13.1.8 ---

## 13.1.9 Payroll User Preferences & Personalization Schema

```
Table: payroll_user_preferences
Fields:
- id: UUID (Primary Key)
- user_id: UUID (Foreign Key to user)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- dashboard_layout: JSON (Preferred dashboard widget arrangement)
- default_dashboard_view: ENUM('Executive', 'Manager', 'Payroll Admin', 'Compliance', 'Financial')
- notification_preferences: JSON (Email, SMS, In-App notification settings)
- report_preferences: JSON (Default report formats and filters)
- data_export_format: ENUM('PDF', 'Excel', 'CSV', 'JSON')
- timezone: VARCHAR(50) (Default: 'UTC')
- date_format: VARCHAR(20) (Default: 'YYYY-MM-DD')
- time_format: ENUM('12-hour', '24-hour') (Default: '24-hour')
- language_preference: VARCHAR(10) (Default: 'en')
- currency_display: VARCHAR(10) (Default: 'USD')
- decimal_places: INTEGER (Default: 2)
- auto_refresh_interval: INTEGER (Default: 300) (Seconds)
- default_date_range: ENUM('Today', 'This Week', 'This Month', 'This Quarter', 'This Year')
- favorite_reports: JSON (Quick access to frequently used reports)
- quick_filters: JSON (Saved filter configurations)
- alert_thresholds: JSON (Personal alert thresholds)
- email_digest_frequency: ENUM('Never', 'Daily', 'Weekly', 'Monthly')
- mobile_app_preferences: JSON (Mobile-specific settings)
- accessibility_settings: JSON (Screen reader, high contrast, etc.)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_payroll_user_preferences_company_user (user_id, company_id)
- INDEX idx_user_id (user_id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_default_dashboard_view (default_dashboard_view)
- INDEX idx_language_preference (language_preference)
- INDEX idx_timezone (timezone)

Constraints:
- fk_payroll_user_preferences_user FOREIGN KEY (user_id) REFERENCES user(id)
- fk_payroll_user_preferences_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_user_preferences_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- chk_positive_intervals CHECK (auto_refresh_interval > 0 AND decimal_places >= 0)
```

```
Table: payroll_personalized_dashboard
Fields:
- id: UUID (Primary Key)
- user_id: UUID (Foreign Key to user)
- company_id: UUID (Foreign Key to company)
- dashboard_name: VARCHAR(200) (Required)
- dashboard_type: ENUM('Custom', 'Executive', 'Manager', 'Payroll Admin', 'Compliance', 'Financial')
- is_default: BOOLEAN (Default: FALSE)
- is_public: BOOLEAN (Default: FALSE)
- widget_configuration: JSON (Layout and widget settings)
- data_filters: JSON (Default data filters applied)
- refresh_interval: INTEGER (Default: 300) (Seconds)
- auto_refresh_enabled: BOOLEAN (Default: TRUE)
- drill_down_permissions: JSON (Allowed drill-down levels)
- export_permissions: JSON (Allowed export formats)
- sharing_permissions: JSON (Who can view this dashboard)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_user_id (user_id)
- INDEX idx_company_id (company_id)
- INDEX idx_dashboard_type (dashboard_type)
- INDEX idx_is_default (is_default)
- INDEX idx_is_public (is_public)
- INDEX idx_created_by_user_id (created_by_user_id)

Constraints:
- fk_payroll_dashboard_user FOREIGN KEY (user_id) REFERENCES user(id)
- fk_payroll_dashboard_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_dashboard_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_payroll_dashboard_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_refresh_interval_positive CHECK (refresh_interval > 0)
```

--- END OF SECTION 13.1.9 ---

## 13.1.10 Payroll Mobile & API Access Schema

```
Table: payroll_mobile_app_config
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- app_version: VARCHAR(20) (Required)
- platform: ENUM('iOS', 'Android', 'Web', 'Hybrid')
- build_number: VARCHAR(20) (Required)
- release_date: DATE (Required)
- is_current: BOOLEAN (Default: FALSE)
- is_mandatory: BOOLEAN (Default: FALSE)
- min_supported_version: VARCHAR(20)
- features_enabled: JSON (Mobile-specific payroll features)
- api_endpoints: JSON (Mobile-specific API endpoints)
- offline_capabilities: JSON (Offline functionality support)
- security_config: JSON (Mobile security settings)
- push_notification_enabled: BOOLEAN (Default: TRUE)
- biometric_auth_enabled: BOOLEAN (Default: TRUE)
- offline_data_retention_days: INTEGER (Default: 30)
- mobile_dashboard_config: JSON (Mobile dashboard layout)
- quick_actions: JSON (Mobile quick action buttons)
- data_sync_settings: JSON (Mobile data sync preferences)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_app_version (app_version)
- INDEX idx_platform (platform)
- INDEX idx_is_current (is_current)
- INDEX idx_is_mandatory (is_mandatory)
- INDEX idx_release_date (release_date)

Constraints:
- fk_payroll_mobile_app_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_mobile_app_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_mobile_app_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_retention_positive CHECK (offline_data_retention_days >= 0)
```

```
Table: payroll_api_access
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- api_key: VARCHAR(200) (Required, Unique, Indexed)
- api_name: VARCHAR(200) (Required)
- api_description: TEXT
- api_version: VARCHAR(20) (Default: 'v1')
- endpoint_url: VARCHAR(500) (Required)
- authentication_type: ENUM('API Key', 'OAuth 2.0', 'JWT', 'Basic Auth')
- rate_limit_per_hour: INTEGER (Default: 1000)
- rate_limit_per_day: INTEGER (Default: 10000)
- allowed_methods: JSON (HTTP methods allowed)
- allowed_ips: JSON (IP whitelist)
- webhook_url: VARCHAR(500)
- webhook_events: JSON (Events that trigger webhooks)
- is_active: BOOLEAN (Default: TRUE)
- is_internal: BOOLEAN (Default: FALSE)
- access_level: ENUM('Read Only', 'Read Write', 'Admin', 'Full Access')
- data_access_scope: JSON (What data can be accessed)
- created_by_user_id: UUID (Foreign Key to user)
- last_used_at: TIMESTAMP
- usage_count: INTEGER (Default: 0)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_api_key (api_key)
- INDEX idx_api_version (api_version)
- INDEX idx_is_active (is_active)
- INDEX idx_is_internal (is_internal)
- INDEX idx_access_level (access_level)
- INDEX idx_last_used_at (last_used_at)
- INDEX idx_usage_count (usage_count)

Constraints:
- fk_payroll_api_access_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_api_access_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_api_access_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_rate_limits_positive CHECK (rate_limit_per_hour > 0 AND rate_limit_per_day > 0)
- chk_usage_positive CHECK (usage_count >= 0)
```

--- END OF SECTION 13.1.10 ---

## 13.1.11 Payroll Security & Compliance Schema

```
Table: payroll_security_config
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- security_policy_name: VARCHAR(200) (Required)
- policy_type: ENUM('Data Encryption', 'Access Control', 'Audit Logging', 'Session Management', 'Password Policy', 'Two-Factor Auth', 'API Security')
- security_level: ENUM('Basic', 'Standard', 'Enhanced', 'High', 'Maximum')
- configuration: JSON (Security configuration parameters)
- encryption_algorithm: VARCHAR(50)
- key_rotation_days: INTEGER (Default: 90)
- session_timeout_minutes: INTEGER (Default: 30)
- max_login_attempts: INTEGER (Default: 5)
- lockout_duration_minutes: INTEGER (Default: 15)
- password_min_length: INTEGER (Default: 8)
- password_complexity: JSON (Password complexity requirements)
- mfa_required: BOOLEAN (Default: FALSE)
- mfa_methods: JSON (Allowed MFA methods)
- ip_whitelist_enabled: BOOLEAN (Default: FALSE)
- allowed_ip_ranges: JSON (Whitelisted IP addresses)
- data_masking_enabled: BOOLEAN (Default: FALSE)
- masking_rules: JSON (Data masking configuration)
- is_active: BOOLEAN (Default: TRUE)
- effective_from: DATE (Required)
- effective_to: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_policy_type (policy_type)
- INDEX idx_security_level (security_level)
- INDEX idx_is_active (is_active)
- INDEX idx_effective_from (effective_from)

Constraints:
- fk_payroll_security_config_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_security_config_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_security_config_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_payroll_security_config_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_positive_values CHECK (key_rotation_days > 0 AND session_timeout_minutes > 0 AND max_login_attempts > 0 AND lockout_duration_minutes > 0 AND password_min_length > 0)
- chk_effective_order CHECK (effective_to IS NULL OR effective_to >= effective_from)
```

```
Table: payroll_compliance_audit
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- audit_type: ENUM('SOX', 'GDPR', 'CCPA', 'HIPAA', 'ISO 27001', 'PCI DSS', 'FLSA', 'IRS', 'State Labor Laws')
- audit_scope: ENUM('Full System', 'Data Privacy', 'Security', 'Financial', 'Operational', 'Integration')
- audit_period_start: DATE (Required)
- audit_period_end: DATE (Required)
- auditor_name: VARCHAR(200)
- auditor_organization: VARCHAR(200)
- audit_status: ENUM('Planned', 'In Progress', 'Completed', 'Passed', 'Failed', 'Remediation Required')
- findings_count: INTEGER (Default: 0)
- critical_findings: INTEGER (Default: 0)
- high_findings: INTEGER (Default: 0)
- medium_findings: INTEGER (Default: 0)
- low_findings: INTEGER (Default: 0)
- compliance_score: DECIMAL(5,2) (Default: 0.00)
- remediation_plan: TEXT
- remediation_due_date: DATE
- audit_report_url: VARCHAR(500)
- evidence_documents: JSON (Links to evidence documents)
- compliance_gaps: JSON (Identified compliance gaps)
- risk_assessment: JSON (Risk level and impact)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_audit_type (audit_type)
- INDEX idx_audit_scope (audit_scope)
- INDEX idx_audit_status (audit_status)
- INDEX idx_audit_period_start (audit_period_start)
- INDEX idx_audit_period_end (audit_period_end)
- INDEX idx_compliance_score (compliance_score)

Constraints:
- fk_payroll_compliance_audit_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_compliance_audit_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_compliance_audit_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_period_order CHECK (audit_period_end >= audit_period_start)
- chk_positive_findings CHECK (findings_count >= 0 AND critical_findings >= 0 AND high_findings >= 0 AND medium_findings >= 0 AND low_findings >= 0)
- chk_score_range CHECK (compliance_score BETWEEN 0 AND 100)
```

--- END OF SECTION 13.1.11 ---

## 13.1.12 Payroll Workflow & Process Automation Schema

```
Table: payroll_workflow_definition
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- workflow_name: VARCHAR(200) (Required)
- workflow_type: ENUM('Payroll Approval', 'Sync Validation', 'Tax Filing', 'Exception Handling', 'Data Review', 'Compliance Check')
- workflow_category: ENUM('Standard', 'Emergency', 'High Value', 'Executive', 'Bulk Processing')
- trigger_event: ENUM('Payroll Run Initiated', 'Sync Completed', 'Error Detected', 'Schedule Triggered', 'Manual Trigger')
- workflow_steps: JSON (Ordered workflow steps and configurations)
- approval_levels: JSON (Multi-level approval requirements)
- escalation_rules: JSON (Escalation conditions and paths)
- timeout_settings: JSON (Step timeout and reminder settings)
- notification_rules: JSON (Notification triggers and recipients)
- rollback_conditions: JSON (Conditions for workflow rollback)
- is_active: BOOLEAN (Default: TRUE)
- version: INTEGER (Default: 1)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_workflow_type (workflow_type)
- INDEX idx_workflow_category (workflow_category)
- INDEX idx_trigger_event (trigger_event)
- INDEX idx_is_active (is_active)
- INDEX idx_version (version)

Constraints:
- fk_payroll_workflow_definition_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_workflow_definition_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_workflow_definition_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_payroll_workflow_definition_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_version_positive CHECK (version > 0)
```

```
Table: payroll_workflow_instance
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- workflow_definition_id: UUID (Foreign Key to payroll_workflow_definition)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- sync_log_id: UUID (Foreign Key to payroll_sync_log)
- instance_name: VARCHAR(200) (Required)
- current_step: INTEGER (Default: 1)
- workflow_status: ENUM('Initiated', 'In Progress', 'Pending Approval', 'Approved', 'Rejected', 'Completed', 'Cancelled', 'Escalated')
- priority_level: ENUM('Low', 'Normal', 'High', 'Critical', 'Emergency')
- initiated_by_user_id: UUID (Foreign Key to user)
- current_assignee_id: UUID (Foreign Key to user)
- started_at: TIMESTAMP (Auto)
- due_date: TIMESTAMP
- completed_at: TIMESTAMP
- workflow_data: JSON (Workflow-specific data and context)
- step_history: JSON (History of completed steps)
- approval_comments: TEXT
- rejection_reason: TEXT
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_workflow_definition_id (workflow_definition_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_sync_log_id (sync_log_id)
- INDEX idx_workflow_status (workflow_status)
- INDEX idx_priority_level (priority_level)
- INDEX idx_initiated_by_user_id (initiated_by_user_id)
- INDEX idx_current_assignee_id (current_assignee_id)
- INDEX idx_started_at (started_at)
- INDEX idx_due_date (due_date)

Constraints:
- fk_payroll_workflow_instance_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_workflow_instance_definition FOREIGN KEY (workflow_definition_id) REFERENCES payroll_workflow_definition(id)
- fk_payroll_workflow_instance_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_workflow_instance_sync_log FOREIGN KEY (sync_log_id) REFERENCES payroll_sync_log(id)
- fk_payroll_workflow_instance_initiated_by FOREIGN KEY (initiated_by_user_id) REFERENCES user(id)
- fk_payroll_workflow_instance_current_assignee FOREIGN KEY (current_assignee_id) REFERENCES user(id)
- chk_step_positive CHECK (current_step > 0)
```

--- END OF SECTION 13.1.12 ---

## 13.1.13 Payroll Data Archival & Retention Schema

```
Table: payroll_archival_policy
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- provider_config_id: UUID (Foreign Key to payroll_provider_config)
- policy_name: VARCHAR(200) (Required)
- entity_type: ENUM('Sync Log', 'Audit Trail', 'Tax Filing', 'Notification Log', 'Workflow Instance', 'Analytics Data', 'Configuration History')
- retention_period_years: INTEGER (Required)
- archival_trigger: ENUM('Age Based', 'Event Based', 'Manual', 'Scheduled')
- archival_condition: JSON (Conditions for archival)
- storage_location: ENUM('Cold Storage', 'Archive Database', 'File System', 'Cloud Archive')
- compression_enabled: BOOLEAN (Default: TRUE)
- encryption_enabled: BOOLEAN (Default: TRUE)
- access_restriction: ENUM('No Access', 'Read Only', 'Admin Only', 'Compliance Only')
- retention_after_archive_years: INTEGER (Default: 7)
- auto_delete_after_retention: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- last_run_date: DATE
- next_run_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_provider_config_id (provider_config_id)
- INDEX idx_entity_type (entity_type)
- INDEX idx_archival_trigger (archival_trigger)
- INDEX idx_storage_location (storage_location)
- INDEX idx_is_active (is_active)
- INDEX idx_last_run_date (last_run_date)
- INDEX idx_next_run_date (next_run_date)

Constraints:
- fk_payroll_archival_policy_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_archival_policy_provider FOREIGN KEY (provider_config_id) REFERENCES payroll_provider_config(id)
- fk_payroll_archival_policy_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_payroll_archival_policy_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_retention_positive CHECK (retention_period_years > 0 AND retention_after_archive_years >= 0)
```

```
Table: payroll_archived_data
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- archival_policy_id: UUID (Foreign Key to payroll_archival_policy)
- original_table_name: VARCHAR(100) (Required)
- original_record_id: UUID (Required)
- entity_type: ENUM('Sync Log', 'Audit Trail', 'Tax Filing', 'Notification Log', 'Workflow Instance', 'Analytics Data', 'Configuration History')
- archived_data: JSON (Complete archived record data)
- archive_date: DATE (Required)
- archive_reason: VARCHAR(200)
- storage_path: VARCHAR(500)
- file_size_bytes: BIGINT
- checksum_hash: VARCHAR(256)
- compression_ratio: DECIMAL(5,2)
- access_count: INTEGER (Default: 0)
- last_accessed_at: TIMESTAMP
- scheduled_deletion_date: DATE
- is_deleted: BOOLEAN (Default: FALSE)
- deleted_at: TIMESTAMP
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_archival_policy_id (archival_policy_id)
- INDEX idx_original_table_name (original_table_name)
- INDEX idx_original_record_id (original_record_id)
- INDEX idx_entity_type (entity_type)
- INDEX idx_archive_date (archive_date)
- INDEX idx_scheduled_deletion_date (scheduled_deletion_date)
- INDEX idx_is_deleted (is_deleted)

Constraints:
- fk_payroll_archived_data_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payroll_archived_data_policy FOREIGN KEY (archival_policy_id) REFERENCES payroll_archival_policy(id)
- fk_payroll_archived_data_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_file_size_positive CHECK (file_size_bytes >= 0)
- chk_access_positive CHECK (access_count >= 0)
- chk_compression_range CHECK (compression_ratio BETWEEN 0 AND 1)
```

--- END OF SECTION 13.1.13 ---
