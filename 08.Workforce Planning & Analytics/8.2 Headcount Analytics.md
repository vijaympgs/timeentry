## 8.2 Headcount Analytics

## 8.2.1 Headcount Snapshot Schema

```sql
Table: headcount_snapshot
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- snapshot_date: DATE (Required)
- snapshot_code: VARCHAR(50) (Required, Unique, Indexed)
- snapshot_name: VARCHAR(200) (Required)
- snapshot_type: ENUM('Daily', 'Weekly', 'Monthly', 'Quarterly', 'Annual', 'Custom')
- snapshot_category: ENUM('Operational', 'Strategic', 'Compliance', 'Forecast', 'Actual')
- total_headcount: INTEGER (Required)
- active_headcount: INTEGER (Required)
- on_leave_headcount: INTEGER (Required)
- terminated_headcount: INTEGER (Required)
- new_hires: INTEGER (Default: 0)
- voluntary_terminations: INTEGER (Default: 0)
- involuntary_terminations: INTEGER (Default: 0)
- internal_transfers_in: INTEGER (Default: 0)
- internal_transfers_out: INTEGER (Default: 0)
- budget_variance: DECIMAL(10,2) (Default: 0.00)
- forecast_accuracy: DECIMAL(5,2) (Default: 0.00)
- data_quality_score: DECIMAL(3,2) (Check: 0.00 TO 5.00)
- source_systems: JSON (List of source systems)
- extraction_status: ENUM('Pending', 'In Progress', 'Completed', 'Failed', 'Partial')
- approved_by_user_id: UUID (Foreign Key to user)
- approved_at: TIMESTAMP
- is_published: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_headcount_snapshot_company_code (company_id, snapshot_code)
- INDEX idx_company_id (company_id)
- INDEX idx_snapshot_date (snapshot_date)
- INDEX idx_snapshot_type (snapshot_type)
- INDEX idx_snapshot_category (snapshot_category)
- INDEX idx_total_headcount (total_headcount)
- INDEX idx_active_headcount (active_headcount)
- INDEX idx_extraction_status (extraction_status)
- INDEX idx_is_published (is_published)
- INDEX idx_is_active (is_active)

Constraints:
- fk_headcount_snapshot_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_snapshot_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_headcount_snapshot_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_snapshot_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_headcount_positive CHECK (total_headcount >= 0 AND active_headcount >= 0 AND on_leave_headcount >= 0 AND terminated_headcount >= 0)
- chk_quality_range CHECK (data_quality_score BETWEEN 0 AND 5)
```

## 8.2.2 Headcount Detail Schema

```sql
Table: headcount_detail
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- snapshot_id: UUID (Foreign Key to headcount_snapshot)
- business_unit: VARCHAR(100) (Required)
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- cost_center_id: UUID (Foreign Key to cost_center)
- job_id: UUID (Foreign Key to job)
- role_id: UUID (Foreign Key to position)
- employment_type: ENUM('Permanent', 'Contract', 'Intern', 'Consultant', 'Temporary', 'Freelance')
- employment_status: ENUM('Active', 'On Leave', 'Terminated', 'Pending', 'Suspended')
- work_schedule: ENUM('Full-time', 'Part-time', 'Flexible', 'Remote', 'Hybrid')
- experience_level: ENUM('Entry', 'Junior', 'Mid', 'Senior', 'Lead', 'Manager', 'Director', 'Executive')
- salary_grade: VARCHAR(50)
- headcount: INTEGER (Required)
- budget_headcount: INTEGER (Default: 0)
- vacancy_count: INTEGER (Default: 0)
- average_salary: DECIMAL(12,2)
- total_salary_cost: DECIMAL(15,2)
- average_tenure_months: DECIMAL(5,2)
- diversity_metrics: JSON (Diversity breakdown data)
- skill_inventory: JSON (Skills and competencies)
- performance_distribution: JSON (Performance rating distribution)
- compliance_flags: JSON (Compliance and regulatory flags)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_snapshot_id (snapshot_id)
- INDEX idx_business_unit (business_unit)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_cost_center_id (cost_center_id)
- INDEX idx_job_id (job_id)
- INDEX idx_role_id (role_id)
- INDEX idx_employment_type (employment_type)
- INDEX idx_employment_status (employment_status)
- INDEX idx_work_schedule (work_schedule)
- INDEX idx_experience_level (experience_level)
- INDEX idx_headcount (headcount)
- INDEX idx_vacancy_count (vacancy_count)

Constraints:
- fk_headcount_detail_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_detail_snapshot FOREIGN KEY (snapshot_id) REFERENCES headcount_snapshot(id)
- fk_headcount_detail_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_headcount_detail_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_headcount_detail_cost_center FOREIGN KEY (cost_center_id) REFERENCES cost_center(id)
- fk_headcount_detail_job FOREIGN KEY (job_id) REFERENCES job(id)
- fk_headcount_detail_role FOREIGN KEY (role_id) REFERENCES position(id)
- fk_headcount_detail_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_detail_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_headcount_positive CHECK (headcount >= 0 AND budget_headcount >= 0 AND vacancy_count >= 0)
```

## 8.2.3 Historical Trend Schema

```sql
Table: headcount_trend
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- period_start: DATE (Required)
- period_end: DATE (Required)
- period_type: ENUM('Daily', 'Weekly', 'Monthly', 'Quarterly', 'Annual')
- business_unit: VARCHAR(100) (Required)
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- opening_headcount: INTEGER (Required)
- closing_headcount: INTEGER (Required)
- net_change: INTEGER (Required)
- hires: INTEGER (Required)
- terminations: INTEGER (Required)
- voluntary_terminations: INTEGER (Default: 0)
- involuntary_terminations: INTEGER (Default: 0)
- transfers_in: INTEGER (Required)
- transfers_out: INTEGER (Required)
- promotions: INTEGER (Default: 0)
- demotions: INTEGER (Default: 0)
- attrition_rate: DECIMAL(5,2) (Default: 0.00)
- turnover_rate: DECIMAL(5,2) (Default: 0.00)
- growth_rate: DECIMAL(5,2) (Default: 0.00)
- average_tenure_change: DECIMAL(5,2) (Default: 0.00)
- cost_per_hire: DECIMAL(10,2) (Default: 0.00)
- time_to_fill_days: DECIMAL(5,2) (Default: 0.00)
- trend_indicators: JSON (Trend analysis indicators)
- forecast_accuracy: DECIMAL(5,2) (Default: 0.00)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_period_start (period_start)
- INDEX idx_period_end (period_end)
- INDEX idx_period_type (period_type)
- INDEX idx_business_unit (business_unit)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_opening_headcount (opening_headcount)
- INDEX idx_closing_headcount (closing_headcount)
- INDEX idx_net_change (net_change)
- INDEX idx_attrition_rate (attrition_rate)
- INDEX idx_turnover_rate (turnover_rate)
- INDEX idx_growth_rate (growth_rate)

Constraints:
- fk_headcount_trend_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_trend_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_headcount_trend_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_headcount_trend_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_trend_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_period_order CHECK (period_end >= period_start)
- chk_headcount_positive CHECK (opening_headcount >= 0 AND closing_headcount >= 0)
- chk_rate_range CHECK (attrition_rate BETWEEN 0 AND 100 AND turnover_rate BETWEEN 0 AND 100)
```

## 8.2.4 Headcount Forecast Schema

```sql
Table: headcount_forecast
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- forecast_code: VARCHAR(50) (Required, Unique, Indexed)
- forecast_name: VARCHAR(200) (Required)
- forecast_type: ENUM('Budget', 'Strategic', 'Operational', 'Contingency', 'Scenario')
- forecast_category: ENUM('Growth', 'Steady State', 'Downsizing', 'Restructuring', 'Expansion')
- forecast_period_start: DATE (Required)
- forecast_period_end: DATE (Required)
- business_unit: VARCHAR(100) (Required)
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- scenario_assumptions: JSON (Key assumptions and variables)
- projected_opening_headcount: INTEGER (Required)
- projected_closing_headcount: INTEGER (Required)
- projected_hires: INTEGER (Required)
- projected_terminations: INTEGER (Required)
- projected_transfers_in: INTEGER (Default: 0)
- projected_transfers_out: INTEGER (Default: 0)
- budget_impact: DECIMAL(15,2)
- confidence_level: DECIMAL(3,2) (Check: 0.00 TO 1.00)
- probability_weight: DECIMAL(3,2) (Default: 0.00)
- risk_factors: JSON (Identified risks and mitigations)
- model_version: VARCHAR(20) (Default: 'v1.0')
- forecast_status: ENUM('Draft', 'Under Review', 'Approved', 'Active', 'Archived')
- approved_by_user_id: UUID (Foreign Key to user)
- approved_at: TIMESTAMP
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_headcount_forecast_company_code (company_id, forecast_code)
- INDEX idx_company_id (company_id)
- INDEX idx_forecast_type (forecast_type)
- INDEX idx_forecast_category (forecast_category)
- INDEX idx_forecast_period_start (forecast_period_start)
- INDEX idx_forecast_period_end (forecast_period_end)
- INDEX idx_business_unit (business_unit)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_confidence_level (confidence_level)
- INDEX idx_forecast_status (forecast_status)
- INDEX idx_is_active (is_active)

Constraints:
- fk_headcount_forecast_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_forecast_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_headcount_forecast_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_headcount_forecast_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_headcount_forecast_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_forecast_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_period_order CHECK (forecast_period_end >= forecast_period_start)
- chk_confidence_range CHECK (confidence_level BETWEEN 0 AND 1)
- chk_probability_range CHECK (probability_weight BETWEEN 0 AND 1)
```

## 8.2.5 Headcount Budget Schema

```sql
Table: headcount_budget
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- budget_code: VARCHAR(50) (Required, Unique, Indexed)
- budget_name: VARCHAR(200) (Required)
- budget_type: ENUM('Annual', 'Quarterly', 'Project', 'Department', 'Role')
- budget_category: ENUM('Operating', 'Capital', 'Contingency', 'Growth', 'Replacement')
- fiscal_year: INTEGER (Required)
- fiscal_quarter: ENUM('Q1', 'Q2', 'Q3', 'Q4', 'Annual')
- business_unit: VARCHAR(100) (Required)
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- approved_headcount: INTEGER (Required)
- budgeted_salary_cost: DECIMAL(15,2) (Required)
- budgeted_benefits_cost: DECIMAL(15,2) (Default: 0.00)
- budgeted_recruitment_cost: DECIMAL(15,2) (Default: 0.00)
- budgeted_training_cost: DECIMAL(15,2) (Default: 0.00)
- total_budget_cost: DECIMAL(15,2) (Required)
- actual_headcount: INTEGER (Default: 0)
- actual_salary_cost: DECIMAL(15,2) (Default: 0.00)
- actual_benefits_cost: DECIMAL(15,2) (Default: 0.00)
- actual_recruitment_cost: DECIMAL(15,2) (Default: 0.00)
- actual_training_cost: DECIMAL(15,2) (Default: 0.00)
- total_actual_cost: DECIMAL(15,2) (Default: 0.00)
- variance_headcount: INTEGER (Default: 0)
- variance_cost: DECIMAL(15,2) (Default: 0.00)
- variance_percentage: DECIMAL(5,2) (Default: 0.00)
- currency: VARCHAR(3) (Default: 'USD')
- approval_status: ENUM('Draft', 'Submitted', 'Approved', 'Rejected', 'Modified')
- approved_by_user_id: UUID (Foreign Key to user)
- approved_at: TIMESTAMP
- budget_owner_id: UUID (Foreign Key to employee)
- status: ENUM('Active', 'Frozen', 'Closed', 'Cancelled')
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_headcount_budget_company_code (company_id, budget_code)
- INDEX idx_company_id (company_id)
- INDEX idx_budget_type (budget_type)
- INDEX idx_budget_category (budget_category)
- INDEX idx_fiscal_year (fiscal_year)
- INDEX idx_fiscal_quarter (fiscal_quarter)
- INDEX idx_business_unit (business_unit)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_approved_headcount (approved_headcount)
- INDEX idx_total_budget_cost (total_budget_cost)
- INDEX idx_approval_status (approval_status)
- INDEX idx_budget_owner_id (budget_owner_id)
- INDEX idx_status (status)

Constraints:
- fk_headcount_budget_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_budget_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_headcount_budget_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_headcount_budget_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_headcount_budget_owner FOREIGN KEY (budget_owner_id) REFERENCES employee(id)
- fk_headcount_budget_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_budget_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_fiscal_positive CHECK (fiscal_year > 0)
- chk_headcount_positive CHECK (approved_headcount >= 0 AND actual_headcount >= 0)
```

## 8.2.6 Integration & Workflow Schema

```sql
Table: headcount_integration
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- integration_name: VARCHAR(200) (Required)
- integration_type: ENUM('HRIS Integration', 'Payroll System', 'ATS Integration', 'Time Tracking', 'Finance System')
- integration_category: ENUM('Data Sync', 'API Integration', 'File Transfer', 'Webhook', 'Real-time Sync', 'Batch Processing')
- source_system: VARCHAR(200) (Required)
- target_system: VARCHAR(200) (Required)
- integration_description: TEXT (Required)
- data_flow_direction: ENUM('Inbound', 'Outbound', 'Bidirectional')
- sync_frequency: ENUM('Real-time', 'Every 5 minutes', 'Every 15 minutes', 'Every 30 minutes', 'Hourly', 'Daily')
- data_mapping: JSON (Field mapping between systems)
- transformation_rules: JSON (Data transformation logic)
- error_handling: JSON (Error handling and retry logic)
- authentication_method: ENUM('API Key', 'OAuth 2.0', 'Basic Auth', 'Certificate', 'Custom')
- connection_status: ENUM('Active', 'Inactive', 'Error', 'Testing', 'Maintenance')
- last_sync_at: TIMESTAMP
- next_sync_at: TIMESTAMP
- error_count: INTEGER (Default: 0)
- data_quality_score: DECIMAL(3,2) (Default: 0.00)
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_integration_type (integration_type)
- INDEX idx_integration_category (integration_category)
- INDEX idx_source_system (source_system)
- INDEX idx_target_system (target_system)
- INDEX idx_sync_frequency (sync_frequency)
- INDEX idx_connection_status (connection_status)
- INDEX idx_last_sync_at (last_sync_at)
- INDEX idx_is_active (is_active)

Constraints:
- fk_headcount_integration_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_integration_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_integration_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_error_count_positive CHECK (error_count >= 0)
- chk_data_quality_range CHECK (data_quality_score BETWEEN 0 AND 5)
```

```sql
Table: headcount_workflow
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- workflow_name: VARCHAR(200) (Required)
- workflow_type: ENUM('Snapshot Approval', 'Budget Review', 'Forecast Validation', 'Data Quality Check', 'Report Generation')
- workflow_category: ENUM('Standard', 'Emergency', 'High Priority', 'Executive', 'Automated', 'Scheduled')
- trigger_event: ENUM('Schedule Trigger', 'Data Change', 'Threshold Breach', 'Manual Trigger', 'API Call', 'System Event')
- workflow_description: TEXT (Required)
- workflow_steps: JSON (Ordered workflow steps and configurations)
- approval_levels: JSON (Multi-level approval requirements)
- escalation_rules: JSON (Escalation conditions and paths)
- timeout_settings: JSON (Step timeout and reminder settings)
- notification_rules: JSON (Notification triggers and recipients)
- retry_configuration: JSON (Retry logic and limits)
- is_active: BOOLEAN (Default: TRUE)
- version: INTEGER (Default: 1)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_workflow_type (workflow_type)
- INDEX idx_workflow_category (workflow_category)
- INDEX idx_trigger_event (trigger_event)
- INDEX idx_is_active (is_active)
- INDEX idx_version (version)

Constraints:
- fk_headcount_workflow_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_workflow_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_workflow_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_version_positive CHECK (version > 0)
```

## 8.2.7 Security & Access Control Schema

```sql
Table: headcount_access_control
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- user_id: UUID (Foreign Key to user)
- role_id: UUID (Foreign Key to role)
- access_scope: ENUM('All Headcount', 'Department Headcount', 'Own Headcount', 'Specific Snapshots', 'Read Only Headcount')
- snapshot_ids: JSON (Array of specific snapshot IDs)
- permission_level: ENUM('Read Only', 'Create', 'Edit', 'Delete', 'Admin', 'Full Access')
- data_access_level: ENUM('Aggregated Only', 'Department Level', 'Team Level', 'Individual Level', 'Raw Data')
- can_export_data: BOOLEAN (Default: FALSE)
- can_share_reports: BOOLEAN (Default: FALSE)
- can_approve_snapshots: BOOLEAN (Default: FALSE)
- can_configure_budgets: BOOLEAN (Default: FALSE)
- ip_restriction: JSON (IP address restrictions)
- time_restriction: JSON (Time-based access restrictions)
- granted_by_user_id: UUID (Foreign Key to user)
- granted_at: TIMESTAMP (Auto)
- expires_at: DATE
- is_active: BOOLEAN (Default: TRUE)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_user_id (user_id)
- INDEX idx_role_id (role_id)
- INDEX idx_access_scope (access_scope)
- INDEX idx_permission_level (permission_level)
- INDEX idx_data_access_level (data_access_level)
- INDEX idx_granted_by_user_id (granted_by_user_id)
- INDEX idx_expires_at (expires_at)
- INDEX idx_is_active (is_active)

Constraints:
- fk_headcount_access_control_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_access_control_user FOREIGN KEY (user_id) REFERENCES user(id)
- fk_headcount_access_control_role FOREIGN KEY (role_id) REFERENCES role(id)
- fk_headcount_access_control_granted_by FOREIGN KEY (granted_by_user_id) REFERENCES user(id)
- chk_expires_future CHECK (expires_at IS NULL OR expires_at >= granted_at)
```

```sql
Table: headcount_data_masking
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- masking_rule_name: VARCHAR(200) (Required)
- data_entity: ENUM('Snapshot Data', 'Budget Information', 'Employee Data', 'Salary Information', 'Trend Analysis', 'Forecast Data')
- masking_method: ENUM('Full Mask', 'Partial Mask', 'Tokenization', 'Pseudonymization', 'Hash', 'Aggregation')
- masking_pattern: VARCHAR(100) (Required)
- replacement_value: VARCHAR(200)
- applies_to_roles: JSON (Roles this masking applies to)
- applies_to_data_types: JSON (Data types this masking applies to)
- masking_conditions: JSON (Conditions when masking is applied)
- is_active: BOOLEAN (Default: TRUE)
- effective_from: DATE (Required)
- effective_to: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_data_entity (data_entity)
- INDEX idx_masking_method (masking_method)
- INDEX idx_is_active (is_active)
- INDEX idx_effective_from (effective_from)

Constraints:
- fk_headcount_data_masking_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_data_masking_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_data_masking_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_effective_order CHECK (effective_to IS NULL OR effective_to >= effective_from)
```

## 8.2.8 Audit & Compliance Schema

```sql
Table: headcount_audit_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- action: ENUM('Create', 'Update', 'Delete', 'View', 'Export', 'Share', 'Access', 'Login', 'Logout', 'Approve', 'Reject')
- entity_type: ENUM('Snapshot', 'Detail', 'Trend', 'Forecast', 'Budget', 'Integration', 'Workflow')
- entity_id: UUID
- old_values: JSON (Previous values before change)
- new_values: JSON (New values after change)
- field_changes: JSON (Specific field changes)
- action_reason: TEXT
- business_justification: TEXT
- impact_assessment: TEXT
- affected_records: INTEGER (Default: 0)
- data_sensitivity: ENUM('Public', 'Internal', 'Confidential', 'Sensitive', 'Restricted')
- compliance_impact: ENUM('None', 'Low', 'Medium', 'High', 'Critical')
- performed_by_user_id: UUID (Foreign Key to user)
- ip_address: VARCHAR(45)
- user_agent: TEXT
- session_id: VARCHAR(100)
- timestamp: TIMESTAMP (Auto)
- additional_context: JSON (Extra context information)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_action (action)
- INDEX idx_entity_type (entity_type)
- INDEX idx_entity_id (entity_id)
- idx_performed_by_user_id (performed_by_user_id)
- idx_data_sensitivity (data_sensitivity)
- idx_compliance_impact (compliance_impact)
- idx_timestamp (timestamp)

Constraints:
- fk_headcount_audit_log_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_audit_log_performed_by FOREIGN KEY (performed_by_user_id) REFERENCES user(id)
- chk_affected_records_positive CHECK (affected_records >= 0)
```

```sql
Table: headcount_compliance_report
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- report_type: ENUM('Data Privacy', 'Access Control', 'Snapshot Compliance', 'Budget Compliance', 'Forecast Validation', 'Regulatory Compliance')
- report_period_start: DATE (Required)
- report_period_end: DATE (Required)
- compliance_framework: ENUM('GDPR', 'CCPA', 'HIPAA', 'SOX', 'ISO 27001', 'Internal Policy', 'Industry Standard')
- compliance_status: ENUM('Compliant', 'Non-Compliant', 'Partially Compliant', 'Under Review', 'Remediation Required')
- compliance_score: DECIMAL(5,2) (Default: 0.00)
- findings_count: INTEGER (Default: 0)
- critical_findings: INTEGER (Default: 0)
- high_findings: INTEGER (Default: 0)
- medium_findings: INTEGER (Default: 0)
- low_findings: INTEGER (Default: 0)
- remediation_actions: JSON (Required remediation actions)
- remediation_due_date: DATE
- evidence_documents: JSON (Links to evidence documents)
- reviewed_by_user_id: UUID (Foreign Key to user)
- approved_by_user_id: UUID (Foreign Key to user)
- generated_at: TIMESTAMP (Auto)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_report_type (report_type)
- idx_compliance_framework (compliance_framework)
- idx_compliance_status (compliance_status)
- idx_report_period_start (report_period_start)
- INDEX idx_report_period_end (report_period_end)
- INDEX idx_compliance_score (compliance_score)

Constraints:
- fk_headcount_compliance_report_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_compliance_report_reviewed_by FOREIGN KEY (reviewed_by_user_id) REFERENCES user(id)
- fk_headcount_compliance_report_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- chk_period_order CHECK (report_period_end >= report_period_start)
- chk_score_range CHECK (compliance_score BETWEEN 0 AND 100)
- chk_findings_positive CHECK (findings_count >= 0 AND critical_findings >= 0 AND high_findings >= 0 AND medium_findings >= 0 AND low_findings >= 0)
```

## 8.2.9 Performance & Optimization Schema

```sql
Table: headcount_performance_metric
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- metric_name: VARCHAR(100) (Required)
- metric_category: ENUM('System Performance', 'Data Processing', 'Query Performance', 'User Experience', 'Snapshot Generation', 'Forecast Calculation')
- measurement_unit: VARCHAR(50)
- target_value: DECIMAL(15,2)
- warning_threshold: DECIMAL(15,2)
- critical_threshold: DECIMAL(15,2)
- current_value: DECIMAL(15,2)
- performance_trend: ENUM('Improving', 'Stable', 'Declining', 'Volatile')
- trend_percentage: DECIMAL(5,2) (Default: 0.00)
- sla_met: BOOLEAN (Default: TRUE)
- collection_frequency: ENUM('Real-time', 'Every minute', 'Every 5 minutes', 'Every 15 minutes', 'Hourly')
- last_measured_at: TIMESTAMP (Auto)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_metric_category (metric_category)
- INDEX idx_target_value (target_value)
- idx_warning_threshold (warning_threshold)
- idx_critical_threshold (critical_threshold)
- idx_current_value (current_value)
- idx_performance_trend (performance_trend)
- idx_sla_met (sla_met)
- idx_last_measured_at (last_measured_at)

Constraints:
- fk_headcount_performance_metric_company FOREIGN KEY (company_id) REFERENCES company(id)
- chk_threshold_order CHECK (warning_threshold <= critical_threshold AND target_value <= warning_threshold)
```

```sql
Table: headcount_optimization
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- optimization_type: ENUM('Query Performance', 'Data Processing', 'Snapshot Generation', 'Forecast Calculation', 'Cache Management', 'Database Indexing')
- optimization_description: TEXT (Required)
- before_metrics: JSON (Performance metrics before optimization)
- after_metrics: JSON (Performance metrics after optimization)
- improvement_percentage: DECIMAL(5,2) (Default: 0.00)
- optimization_date: DATE (Required)
- implemented_by_user_id: UUID (Foreign Key to user)
- is_successful: BOOLEAN (Default: FALSE)
- rollback_available: BOOLEAN (Default: FALSE)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_optimization_type (optimization_type)
- idx_optimization_date (optimization_date)
- idx_is_successful (is_successful)
- INDEX idx_improvement_percentage (improvement_percentage)

Constraints:
- fk_headcount_optimization_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_optimization_implemented_by FOREIGN KEY (implemented_by_user_id) REFERENCES user(id)
- chk_improvement_range CHECK (improvement_percentage BETWEEN -100 AND 100)
```

## 8.2.10 Reporting & Analytics Schema

```sql
Table: headcount_report
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- report_name: VARCHAR(200) (Required)
- report_code: VARCHAR(50) (Required, Unique, Indexed)
- report_type: ENUM('Headcount Summary', 'Trend Analysis', 'Budget Variance', 'Forecast Accuracy', 'Attrition Report', 'Compliance Report')
- report_category: ENUM('Executive', 'Management', 'Operational', 'Strategic', 'Regulatory', 'Custom')
- report_description: TEXT (Required)
- data_sources: JSON (Data sources and filters)
- report_parameters: JSON (Configurable parameters)
- output_format: ENUM('PDF', 'Excel', 'CSV', 'HTML', 'Dashboard', 'API')
- schedule_frequency: ENUM('On Demand', 'Daily', 'Weekly', 'Monthly', 'Quarterly', 'Annually')
- schedule_settings: JSON (Scheduling configuration)
- distribution_list: JSON (Email distribution list)
- is_template: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_headcount_report_company_code (company_id, report_code)
- INDEX idx_company_id (company_id)
- INDEX idx_report_type (report_type)
- INDEX idx_report_category (report_category)
- INDEX idx_schedule_frequency (schedule_frequency)
- INDEX idx_is_template (is_template)
- INDEX idx_is_active (is_active)

Constraints:
- fk_headcount_report_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_report_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_report_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
```

```sql
Table: headcount_report_instance
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- report_id: UUID (Foreign Key to headcount_report)
- instance_name: VARCHAR(200) (Required)
- report_period_start: DATE (Required)
- report_period_end: DATE (Required)
- generation_status: ENUM('Pending', 'In Progress', 'Completed', 'Failed', 'Cancelled')
- generation_start_time: TIMESTAMP
- generation_end_time: TIMESTAMP
- file_path: VARCHAR(500)
- file_size: INTEGER
- record_count: INTEGER (Default: 0)
- parameters_used: JSON (Parameters used for this instance)
- data_filters: JSON (Applied data filters)
- generated_by_user_id: UUID (Foreign Key to user)
- error_message: TEXT
- retry_count: INTEGER (Default: 0)
- is_archived: BOOLEAN (Default: FALSE)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_report_id (report_id)
- INDEX idx_report_period_start (report_period_start)
- INDEX idx_report_period_end (report_period_end)
- INDEX idx_generation_status (generation_status)
- INDEX idx_generation_start_time (generation_start_time)
- INDEX idx_generated_by_user_id (generated_by_user_id)
- INDEX idx_is_archived (is_archived)

Constraints:
- fk_headcount_report_instance_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_report_instance_report FOREIGN KEY (report_id) REFERENCES headcount_report(id)
- fk_headcount_report_instance_generated_by FOREIGN KEY (generated_by_user_id) REFERENCES user(id)
- chk_period_order CHECK (report_period_end >= report_period_start)
- chk_retry_positive CHECK (retry_count >= 0)
```

```sql
Table: headcount_analytics
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- analytics_name: VARCHAR(200) (Required)
- analytics_type: ENUM('Trend Analysis', 'Predictive Analytics', 'Descriptive Analytics', 'Prescriptive Analytics', 'Diagnostic Analytics')
- analytics_category: ENUM('Headcount Trends', 'Attrition Analysis', 'Growth Forecasting', 'Cost Analysis', 'Productivity Analysis')
- data_source: JSON (Data sources and connections)
- analysis_methodology: TEXT (Required)
- algorithms_used: JSON (ML algorithms and models)
- accuracy_score: DECIMAL(3,2) (Check: 0.00 TO 1.00)
- confidence_level: DECIMAL(3,2) (Check: 0.00 TO 1.00)
- prediction_horizon: INTEGER (Default: 12)
- refresh_frequency: ENUM('Real-time', 'Hourly', 'Daily', 'Weekly', 'Monthly')
- last_run_at: TIMESTAMP
- next_run_at: TIMESTAMP
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_analytics_type (analytics_type)
- INDEX idx_analytics_category (analytics_category)
- INDEX idx_accuracy_score (accuracy_score)
- INDEX idx_confidence_level (confidence_level)
- INDEX idx_refresh_frequency (refresh_frequency)
- INDEX idx_last_run_at (last_run_at)
- INDEX idx_is_active (is_active)

Constraints:
- fk_headcount_analytics_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_analytics_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_analytics_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_score_range CHECK (accuracy_score BETWEEN 0 AND 1 AND confidence_level BETWEEN 0 AND 1)
- chk_horizon_positive CHECK (prediction_horizon > 0)
```

## 8.2.11 API & Integration Schema

```sql
Table: headcount_api_endpoint
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- endpoint_name: VARCHAR(200) (Required)
- endpoint_path: VARCHAR(500) (Required, Unique, Indexed)
- http_method: ENUM('GET', 'POST', 'PUT', 'DELETE', 'PATCH')
- endpoint_category: ENUM('Snapshot Management', 'Trend Analysis', 'Budget Tracking', 'Forecast Data', 'Reporting', 'Analytics')
- description: TEXT (Required)
- request_schema: JSON (Request body schema)
- response_schema: JSON (Response body schema)
- authentication_required: BOOLEAN (Default: TRUE)
- rate_limit_per_minute: INTEGER (Default: 60)
- timeout_seconds: INTEGER (Default: 30)
- is_active: BOOLEAN (Default: TRUE)
- is_public: BOOLEAN (Default: FALSE)
- version: VARCHAR(20) (Default: 'v1')
- deprecated: BOOLEAN (Default: FALSE)
- deprecation_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_headcount_api_endpoint_company_path (company_id, endpoint_path)
- INDEX idx_company_id (company_id)
- INDEX idx_http_method (http_method)
- INDEX idx_endpoint_category (endpoint_category)
- INDEX idx_is_active (is_active)
- INDEX idx_is_public (is_public)
- INDEX idx_version (version)
- INDEX idx_deprecated (deprecated)

Constraints:
- fk_headcount_api_endpoint_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_api_endpoint_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_api_endpoint_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_rate_limit_positive CHECK (rate_limit_per_minute > 0)
- chk_timeout_positive CHECK (timeout_seconds > 0)
- chk_deprecation_order CHECK (deprecation_date IS NULL OR deprecation_date >= created_at)
```

```sql
Table: headcount_api_key
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- key_name: VARCHAR(200) (Required)
- api_key: VARCHAR(500) (Required, Unique, Indexed)
- key_type: ENUM('Production', 'Development', 'Testing', 'Read Only', 'Full Access')
- permissions: JSON (Array of allowed endpoints and methods)
- rate_limit_per_minute: INTEGER (Default: 60)
- ip_whitelist: JSON (Allowed IP addresses)
- domain_whitelist: JSON (Allowed domains)
- expires_at: TIMESTAMP
- last_used_at: TIMESTAMP
- usage_count: INTEGER (Default: 0)
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_headcount_api_key_company_key (company_id, api_key)
- INDEX idx_company_id (company_id)
- INDEX idx_key_type (key_type)
- INDEX idx_expires_at (expires_at)
- INDEX idx_last_used_at (last_used_at)
- INDEX idx_usage_count (usage_count)
- INDEX idx_is_active (is_active)

Constraints:
- fk_headcount_api_key_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_api_key_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_api_key_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_rate_limit_positive CHECK (rate_limit_per_minute > 0)
- chk_usage_positive CHECK (usage_count >= 0)
```

```sql
Table: headcount_api_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- api_key_id: UUID (Foreign Key to headcount_api_key)
- endpoint_path: VARCHAR(500) (Required)
- http_method: ENUM('GET', 'POST', 'PUT', 'DELETE', 'PATCH')
- request_headers: JSON
- request_body: JSON
- response_status_code: INTEGER
- response_headers: JSON
- response_body: JSON
- processing_time_ms: INTEGER (Default: 0)
- request_size_bytes: INTEGER (Default: 0)
- response_size_bytes: INTEGER (Default: 0)
- client_ip_address: VARCHAR(45)
- user_agent: TEXT
- error_message: TEXT
- success: BOOLEAN (Default: TRUE)
- timestamp: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_api_key_id (api_key_id)
- INDEX idx_endpoint_path (endpoint_path)
- INDEX idx_http_method (http_method)
- INDEX idx_response_status_code (response_status_code)
- INDEX idx_processing_time_ms (processing_time_ms)
- INDEX idx_client_ip_address (client_ip_address)
- INDEX idx_success (success)
- INDEX idx_timestamp (timestamp)

Constraints:
- fk_headcount_api_log_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_api_log_api_key FOREIGN KEY (api_key_id) REFERENCES headcount_api_key(id)
- chk_processing_time_positive CHECK (processing_time_ms >= 0)
- chk_request_size_positive CHECK (request_size_bytes >= 0)
- chk_response_size_positive CHECK (response_size_bytes >= 0)
- chk_status_code_range CHECK (response_status_code BETWEEN 100 AND 599)
```

```sql
Table: headcount_webhook_subscription
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- subscription_name: VARCHAR(200) (Required)
- webhook_url: VARCHAR(1000) (Required)
- event_types: JSON (Array of subscribed events)
- secret_key: VARCHAR(500) (Required)
- authentication_method: ENUM('HMAC Signature', 'API Key', 'Bearer Token', 'Basic Auth')
- retry_policy: JSON (Retry configuration)
- timeout_seconds: INTEGER (Default: 30)
- is_active: BOOLEAN (Default: TRUE)
- last_triggered_at: TIMESTAMP
- success_count: INTEGER (Default: 0)
- failure_count: INTEGER (Default: 0)
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_webhook_url (webhook_url)
- INDEX idx_is_active (is_active)
- INDEX idx_last_triggered_at (last_triggered_at)
- INDEX idx_success_count (success_count)
- INDEX idx_failure_count (failure_count)

Constraints:
- fk_headcount_webhook_subscription_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_webhook_subscription_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_webhook_subscription_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_timeout_positive CHECK (timeout_seconds > 0)
- chk_counts_positive CHECK (success_count >= 0 AND failure_count >= 0)
```

```sql
Table: headcount_integration_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- integration_id: UUID (Foreign Key to headcount_integration)
- sync_type: ENUM('Full Sync', 'Incremental Sync', 'Real-time Sync', 'Scheduled Sync', 'Manual Sync')
- sync_direction: ENUM('Inbound', 'Outbound', 'Bidirectional')
- source_system: VARCHAR(200) (Required)
- target_system: VARCHAR(200) (Required)
- sync_status: ENUM('Started', 'In Progress', 'Completed', 'Failed', 'Cancelled', 'Partial')
- records_processed: INTEGER (Default: 0)
- records_success: INTEGER (Default: 0)
- records_failed: INTEGER (Default: 0)
- records_skipped: INTEGER (Default: 0)
- data_volume_mb: DECIMAL(10,2) (Default: 0.00)
- processing_time_seconds: INTEGER (Default: 0)
- error_details: JSON (Detailed error information)
- validation_errors: JSON (Data validation errors)
- sync_start_time: TIMESTAMP
- sync_end_time: TIMESTAMP
- triggered_by: ENUM('Schedule', 'Manual', 'API Call', 'System Event', 'Data Change')
- triggered_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_integration_id (integration_id)
- INDEX idx_sync_type (sync_type)
- INDEX idx_sync_direction (sync_direction)
- INDEX idx_sync_status (sync_status)
- INDEX idx_source_system (source_system)
- INDEX idx_target_system (target_system)
- INDEX idx_sync_start_time (sync_start_time)
- INDEX idx_triggered_by (triggered_by)

Constraints:
- fk_headcount_integration_log_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_integration_log_integration FOREIGN KEY (integration_id) REFERENCES headcount_integration(id)
- fk_headcount_integration_log_triggered_by FOREIGN KEY (triggered_by_user_id) REFERENCES user(id)
- chk_records_positive CHECK (records_processed >= 0 AND records_success >= 0 AND records_failed >= 0 AND records_skipped >= 0)
- chk_data_volume_positive CHECK (data_volume_mb >= 0)
- chk_processing_time_positive CHECK (processing_time_seconds >= 0)
- chk_sync_order CHECK (sync_end_time IS NULL OR sync_end_time >= sync_start_time)
```

## 8.2.12 Data Quality & Validation Schema

```sql
Table: headcount_data_quality_rule
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- rule_name: VARCHAR(200) (Required)
- rule_category: ENUM('Completeness', 'Accuracy', 'Consistency', 'Validity', 'Uniqueness', 'Timeliness')
- data_entity: ENUM('Snapshot Data', 'Budget Information', 'Employee Data', 'Trend Analysis', 'Forecast Data')
- rule_description: TEXT (Required)
- validation_logic: JSON (Validation rules and conditions)
- error_threshold: DECIMAL(5,2) (Default: 5.00)
- warning_threshold: DECIMAL(5,2) (Default: 2.00)
- severity_level: ENUM('Low', 'Medium', 'High', 'Critical')
- is_active: BOOLEAN (Default: TRUE)
- execution_frequency: ENUM('Real-time', 'Hourly', 'Daily', 'Weekly', 'On Demand')
- last_executed_at: TIMESTAMP
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_rule_category (rule_category)
- INDEX idx_data_entity (data_entity)
- INDEX idx_severity_level (severity_level)
- INDEX idx_is_active (is_active)
- INDEX idx_execution_frequency (execution_frequency)
- INDEX idx_last_executed_at (last_executed_at)

Constraints:
- fk_headcount_data_quality_rule_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_data_quality_rule_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_data_quality_rule_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_threshold_order CHECK (warning_threshold <= error_threshold)
```

```sql
Table: headcount_data_quality_result
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- rule_id: UUID (Foreign Key to headcount_data_quality_rule)
- execution_date: DATE (Required)
- total_records_checked: INTEGER (Required)
- records_passed: INTEGER (Required)
- records_failed: INTEGER (Required)
- records_warning: INTEGER (Default: 0)
- error_percentage: DECIMAL(5,2) (Default: 0.00)
- warning_percentage: DECIMAL(5,2) (Default: 0.00)
- quality_score: DECIMAL(5,2) (Default: 0.00)
- failed_records: JSON (Details of failed records)
- warning_records: JSON (Details of warning records)
- execution_time_seconds: INTEGER (Default: 0)
- status: ENUM('Passed', 'Failed', 'Warning', 'Critical')
- remediation_required: BOOLEAN (Default: FALSE)
- remediation_actions: JSON (Required remediation actions)
- executed_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_rule_id (rule_id)
- INDEX idx_execution_date (execution_date)
- INDEX idx_quality_score (quality_score)
- INDEX idx_status (status)
- INDEX idx_remediation_required (remediation_required)

Constraints:
- fk_headcount_data_quality_result_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_data_quality_result_rule FOREIGN KEY (rule_id) REFERENCES headcount_data_quality_rule(id)
- fk_headcount_data_quality_result_executed_by FOREIGN KEY (executed_by_user_id) REFERENCES user(id)
- chk_records_positive CHECK (total_records_checked >= 0 AND records_passed >= 0 AND records_failed >= 0 AND records_warning >= 0)
- chk_percentage_range CHECK (error_percentage BETWEEN 0 AND 100 AND warning_percentage BETWEEN 0 AND 100 AND quality_score BETWEEN 0 AND 100)
- chk_execution_time_positive CHECK (execution_time_seconds >= 0)
```

## 8.2.13 Configuration & Settings Schema

```sql
Table: headcount_configuration
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- config_category: ENUM('General Settings', 'Snapshot Configuration', 'Budget Settings', 'Forecast Settings', 'Integration Settings', 'Notification Settings')
- config_key: VARCHAR(200) (Required)
- config_value: JSON (Required)
- config_type: ENUM('String', 'Number', 'Boolean', 'Array', 'Object')
- description: TEXT (Required)
- is_encrypted: BOOLEAN (Default: FALSE)
- is_readonly: BOOLEAN (Default: FALSE)
- validation_rules: JSON (Validation rules for the config value)
- default_value: JSON
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_headcount_configuration_company_key (company_id, config_key)
- INDEX idx_company_id (company_id)
- INDEX idx_config_category (config_category)
- INDEX idx_is_encrypted (is_encrypted)
- INDEX idx_is_readonly (is_readonly)

Constraints:
- fk_headcount_configuration_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_configuration_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_configuration_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
```

```sql
Table: headcount_notification_template
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- template_name: VARCHAR(200) (Required)
- template_type: ENUM('Email', 'SMS', 'Push Notification', 'In-App', 'Webhook')
- notification_category: ENUM('Snapshot Alerts', 'Budget Alerts', 'Forecast Alerts', 'System Alerts', 'Compliance Alerts', 'Data Quality Alerts')
- subject_template: VARCHAR(500)
- body_template: TEXT (Required)
- template_variables: JSON (Available template variables)
- is_html: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- language_code: VARCHAR(10) (Default: 'en')
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_template_type (template_type)
- INDEX idx_notification_category (notification_category)
- INDEX idx_is_active (is_active)
- INDEX idx_language_code (language_code)

Constraints:
- fk_headcount_notification_template_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_notification_template_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_notification_template_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
```

## 8.2.14 Advanced Analytics & ML Schema

```sql
Table: headcount_ml_model
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- model_name: VARCHAR(200) (Required)
- model_type: ENUM('Attrition Prediction', 'Headcount Forecasting', 'Budget Optimization', 'Talent Demand', 'Skill Gap Analysis')
- model_category: ENUM('Classification', 'Regression', 'Time Series', 'Clustering', 'Anomaly Detection')
- algorithm: VARCHAR(100) (Required)
- model_version: VARCHAR(20) (Required)
- training_data_period_start: DATE (Required)
- training_data_period_end: DATE (Required)
- feature_variables: JSON (List of feature variables)
- target_variable: VARCHAR(100) (Required)
- hyperparameters: JSON (Model hyperparameters)
- accuracy_score: DECIMAL(5,4) (Check: 0.0000 TO 1.0000)
- precision_score: DECIMAL(5,4) (Check: 0.0000 TO 1.0000)
- recall_score: DECIMAL(5,4) (Check: 0.0000 TO 1.0000)
- f1_score: DECIMAL(5,4) (Check: 0.0000 TO 1.0000)
- model_file_path: VARCHAR(500)
- is_active: BOOLEAN (Default: TRUE)
- is_production_ready: BOOLEAN (Default: FALSE)
- last_trained_at: TIMESTAMP
- created_by_user_id: UUID (Foreign Key to user)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_model_type (model_type)
- INDEX idx_model_category (model_category)
- INDEX idx_algorithm (algorithm)
- INDEX idx_accuracy_score (accuracy_score)
- INDEX idx_is_active (is_active)
- INDEX idx_is_production_ready (is_production_ready)
- INDEX idx_last_trained_at (last_trained_at)

Constraints:
- fk_headcount_ml_model_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_ml_model_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- fk_headcount_ml_model_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_score_range CHECK (accuracy_score BETWEEN 0 AND 1 AND precision_score BETWEEN 0 AND 1 AND recall_score BETWEEN 0 AND 1 AND f1_score BETWEEN 0 AND 1)
- chk_training_period_order CHECK (training_data_period_end >= training_data_period_start)
```

```sql
Table: headcount_prediction_result
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- model_id: UUID (Foreign Key to headcount_ml_model)
- prediction_date: DATE (Required)
- prediction_horizon_months: INTEGER (Required)
- input_data: JSON (Input features for prediction)
- prediction_output: JSON (Model prediction results)
- confidence_score: DECIMAL(5,4) (Check: 0.0000 TO 1.0000)
- prediction_type: ENUM('Individual', 'Aggregate', 'Department', 'Role', 'Location')
- prediction_scope: JSON (Scope of prediction - departments, roles, etc.)
- business_impact: JSON (Assessed business impact)
- recommended_actions: JSON (Recommended actions based on prediction)
- validation_status: ENUM('Pending', 'Validated', 'Invalidated', 'Expired')
- actual_outcome: JSON (Actual outcome for validation)
- validation_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_model_id (model_id)
- INDEX idx_prediction_date (prediction_date)
- INDEX idx_prediction_type (prediction_type)
- INDEX idx_confidence_score (confidence_score)
- INDEX idx_validation_status (validation_status)
- INDEX idx_validation_date (validation_date)

Constraints:
- fk_headcount_prediction_result_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_headcount_prediction_result_model FOREIGN KEY (model_id) REFERENCES headcount_ml_model(id)
- fk_headcount_prediction_result_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_horizon_positive CHECK (prediction_horizon_months > 0)
- chk_confidence_range CHECK (confidence_score BETWEEN 0 AND 1)
```
