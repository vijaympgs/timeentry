# 2.2 Account Groups & Hierarchies - Business Blueprint

## 2.2.1 Business Purpose & Scope

### Business Purpose
The Account Groups & Hierarchies module provides a structured framework for organizing accounts into logical groups and hierarchical relationships, enabling efficient financial reporting, analysis, and management across multiple dimensions and organizational levels.

### Scope
- Account group creation and management with flexible categorization
- Multi-level hierarchy definition and maintenance
- Cross-dimensional account grouping and analysis
- Time-based hierarchy changes and versioning
- Automated roll-up calculations and consolidations

### Target Users
- CFO and Finance Directors
- Financial Controllers
- Accounting Managers
- Business Analysts
- External Auditors
- System Administrators

### Business Objectives
- Enable flexible financial reporting and analysis structures
- Support multi-dimensional business views and reporting
- Provide scalable account organization for business growth
- Maintain data integrity across hierarchical relationships
- Facilitate efficient account management and maintenance

## 2.2.2 Process Flow & Integration

### Account Group Creation Process
1. **Group Definition Request**
   - Business user submits account group creation request
   - Required information: Group name, purpose, parent group, account members
   - Initial validation for duplicate groups and hierarchy compliance

2. **Group Structure Design**
   - Finance Manager review of group structure and business justification
   - Controller approval for accounting compliance and reporting impact
   - System Administrator validation for technical requirements

3. **Group Configuration**
   - Account group setup with defined parameters and validation rules
   - Account member assignment and relationship establishment
   - Roll-up calculation configuration and testing

4. **Group Activation**
   - Group activation in production environment
   - Impact testing on existing reports and calculations
   - User training and documentation updates

### Hierarchy Management Process
1. **Hierarchy Design**
   - Multi-level hierarchy structure definition and planning
   - Parent-child relationship establishment with validation rules
   - Roll-up percentage and calculation method configuration

2. **Hierarchy Validation**
   - Circular reference detection and prevention
   - Hierarchy depth and complexity validation
   - Performance impact assessment for roll-up calculations

3. **Hierarchy Implementation**
   - Controlled hierarchy deployment with rollback capability
   - Real-time roll-up calculation testing and validation
   - Integration testing with reporting and analysis modules

4. **Hierarchy Maintenance**
   - Ongoing hierarchy monitoring and optimization
   - Periodic hierarchy review and adjustment
   - Performance tuning and optimization

### Integration Points
- **Chart of Accounts**: Real-time account group and hierarchy synchronization
- **General Ledger**: Automated roll-up calculations and balance updates
- **Financial Reporting**: Multi-dimensional reporting based on group hierarchies
- **Budgeting & Planning**: Group-based budget allocation and tracking
- **Analytics & BI**: Hierarchical data analysis and visualization
- **Compliance Reporting**: Regulatory reporting based on organizational structures

## 2.2.3 Data Model & Schema

### Account Groups Master Table

**GL_ACCOUNT_GROUPS**
- **group_id** (Primary Key, UUID)
- **group_code** (VARCHAR(20), Unique, Indexed)
- **group_name** (VARCHAR(200), Required)
- **group_description** (TEXT)
- **group_type** (ENUM: 'FINANCIAL', 'MANAGEMENT', 'REGULATORY', 'CUSTOM')
- **parent_group_id** (Foreign Key to GL_ACCOUNT_GROUPS)
- **group_level** (INTEGER)
- **rollup_method** (ENUM: 'SUM', 'WEIGHTED_AVERAGE', 'CUSTOM')
- **currency_code** (VARCHAR(3), Default 'USD')
- **status** (ENUM: 'ACTIVE', 'INACTIVE', 'PENDING')
- **creation_date** (DATETIME)
- **effective_date** (DATE)
- **created_by** (Foreign Key to USER_TABLE)
- **last_modified_date** (DATETIME)
- **modified_by** (Foreign Key to USER_TABLE)

### Account Group Members Table

**GL_GROUP_MEMBERS**
- **membership_id** (Primary Key, UUID)
- **group_id** (Foreign Key to GL_ACCOUNT_GROUPS)
- **account_id** (Foreign Key to GL_ACCOUNTS)
- **membership_percentage** (DECIMAL(5,2), Default 100.00)
- **effective_start_date** (DATE)
- **effective_end_date** (DATE)
- **created_date** (DATETIME)
- **created_by** (Foreign Key to USER_TABLE)

### Hierarchy Definition Table

**GL_HIERARCHY_DEFINITION**
- **hierarchy_id** (Primary Key, UUID)
- **hierarchy_name** (VARCHAR(200), Required)
- **hierarchy_type** (ENUM: 'ORGANIZATIONAL', 'GEOGRAPHIC', 'PRODUCT', 'CUSTOM')
- **hierarchy_purpose** (TEXT)
- **root_group_id** (Foreign Key to GL_ACCOUNT_GROUPS)
- **max_levels** (INTEGER)
- **status** (ENUM: 'ACTIVE', 'INACTIVE', 'DRAFT')
- **version** (INTEGER)
- **effective_date** (DATE)
- **expiry_date** (DATE)
- **created_by** (Foreign Key to USER_TABLE)
- **creation_date** (DATETIME)

### Hierarchy Relationships Table

**GL_HIERARCHY_RELATIONSHIPS**
- **relationship_id** (Primary Key, UUID)
- **hierarchy_id** (Foreign Key to GL_HIERARCHY_DEFINITION)
- **parent_group_id** (Foreign Key to GL_ACCOUNT_GROUPS)
- **child_group_id** (Foreign Key to GL_ACCOUNT_GROUPS)
- **relationship_level** (INTEGER)
- **rollup_percentage** (DECIMAL(5,2), Default 100.00)
- **effective_start_date** (DATE)
- **effective_end_date** (DATE)
- **created_date** (DATETIME)

### Group Properties Table

**GL_GROUP_PROPERTIES**
- **property_id** (Primary Key, UUID)
- **group_id** (Foreign Key to GL_ACCOUNT_GROUPS)
- **property_name** (VARCHAR(100))
- **property_value** (VARCHAR(500))
- **property_type** (ENUM: 'TEXT', 'NUMBER', 'DATE', 'BOOLEAN')
- **is_required** (BOOLEAN, Default FALSE)
- **validation_rule** (TEXT)
- **created_date** (DATETIME)
- **modified_date** (DATETIME)

### Group History Table

**GL_GROUP_HISTORY**
- **history_id** (Primary Key, UUID)
- **group_id** (Foreign Key to GL_ACCOUNT_GROUPS)
- **action_type** (ENUM: 'CREATE', 'MODIFY', 'ACTIVATE', 'DEACTIVATE', 'DELETE')
- **old_values** (JSON)
- **new_values** (JSON)
- **change_reason** (TEXT)
- **changed_by** (Foreign Key to USER_TABLE)
- **change_date** (DATETIME)

### Data Relationships and Constraints

**Primary Constraints:**
- Unique constraint on group_code within entity
- Foreign key relationships maintain referential integrity
- Check constraints for group_type and rollup_method consistency
- Circular reference prevention in hierarchy relationships

**Indexing Strategy:**
- Primary index on group_id
- Unique index on group_code
- Composite index on group_type and status
- Index on parent_group_id for hierarchy queries
- Index on hierarchy_id for relationship queries

**Data Validation:**
- Group code format validation (alphanumeric with specific patterns)
- Hierarchy level validation to prevent circular references
- Effective date validation for temporal integrity
- Roll-up percentage validation (0-100%)

## 2.2.4 Key Features & Functionality

### Account Group Management Features

**Group Creation and Configuration**
- Flexible group definition with custom properties and attributes
- Template-based group creation for common group types
- Bulk group creation from spreadsheets or external systems
- Group validation and duplicate prevention
- Multi-language group descriptions and labels

**Group Member Management**
- Dynamic account assignment to multiple groups
- Percentage-based membership allocation for roll-up calculations
- Time-based group membership with effective date management
- Bulk member assignment and modification capabilities
- Automatic group membership based on account attributes

### Hierarchy Management Features

**Multi-dimensional Hierarchies**
- Support for multiple parallel hierarchy structures
- Organizational, geographic, product, and custom hierarchies
- Time-based hierarchy changes with version control
- Hierarchy comparison and impact analysis
- Hierarchical roll-up calculations with customizable methods

**Hierarchy Visualization and Navigation**
- Interactive hierarchy tree visualization with drag-and-drop
- Multi-level drill-down and roll-up navigation
- Hierarchy health monitoring and validation
- Impact analysis for hierarchy changes
- Hierarchical reporting and analysis tools

### Advanced Functionality

**Roll-up Calculations**
- Configurable roll-up methods (sum, weighted average, custom formulas)
- Real-time roll-up calculations with caching optimization
- Multi-currency roll-up with automatic conversion
- Exception handling for roll-up calculation errors
- Roll-up audit trail and calculation transparency

**Group-based Reporting**
- Dynamic report generation based on group structures
- Multi-dimensional analysis across different hierarchies
- Comparative analysis between group structures
- Time-based group performance analysis
- Custom group-based KPI calculations and dashboards

### Configuration and Customization

**Flexible Group Types**
- Pre-defined group templates for common business needs
- Custom group type definition with validation rules
- Group inheritance and property propagation
- Group-level security and access controls
- Integration with external group management systems

**Hierarchy Configuration**
- Configurable hierarchy depth and complexity limits
- Custom roll-up percentage and calculation rules
- Hierarchy validation rules and constraints
- Time-based hierarchy activation and deactivation
- Hierarchy versioning and change management

### Integration and Automation

**System Integration**
- Real-time synchronization with Chart of Accounts
- Automatic balance roll-up to General Ledger
- Integration with financial reporting and analytics modules
- API-based group and hierarchy management for external systems
- Bulk import/export capabilities for data migration

**Automation Features**
- Automated group assignment based on account attributes
- Scheduled hierarchy validation and health checks
- Automatic roll-up calculation optimization
- Intelligent group recommendations for account organization
- Scheduled group maintenance and cleanup tasks

### Analysis and Monitoring

**Group Performance Analytics**
- Group-level balance trends and variance analysis
- Group profitability and cost analysis
- Group efficiency metrics and KPIs
- Group comparison across periods and dimensions
- Group growth analysis and predictive analytics

**Hierarchy Health Monitoring**
- Hierarchy integrity validation and monitoring
- Roll-up calculation performance monitoring
- Group membership consistency checks
- Hierarchy change impact analysis
- Automated hierarchy optimization recommendations

## 2.2.5 Configuration Requirements

### System Configuration Parameters

**Group Configuration**
- **Group Type Definition**: Pre-defined and custom group type configuration
- **Group Numbering**: Configurable group code formats and patterns
- **Default Properties**: Standard group properties and validation rules
- **Group Templates**: Pre-configured templates for common group types
- **Group Validation Rules**: Business rule engine for group validation

**Hierarchy Configuration**
- **Hierarchy Types**: Pre-defined hierarchy types (organizational, geographic, product)
- **Maximum Depth Limits**: Configurable hierarchy depth and complexity limits
- **Roll-up Methods**: Default roll-up calculation methods and formulas
- **Hierarchy Validation**: Circular reference prevention and validation rules
- **Version Control**: Hierarchy versioning and change management configuration

### Business Rule Configuration

**Group Assignment Rules**
- **Automatic Assignment**: Rules for automatic account assignment to groups
- **Membership Criteria**: Configurable criteria for group membership
- **Attribute-based Assignment**: Account attribute-based group assignment rules
- **Percentage Allocation**: Default percentage allocation for group membership
- **Time-based Assignment**: Effective date-based group assignment rules

**Hierarchy Management Rules**
- **Parent-child Validation**: Rules for parent-child relationship validation
- **Level Restrictions**: Configurable restrictions on hierarchy levels
- **Roll-up Validation**: Rules for roll-up calculation validation
- **Change Impact Analysis**: Automatic impact analysis for hierarchy changes
- **Approval Requirements**: Configuration-based approval requirements

### Integration Configuration

**Chart of Accounts Integration**
- **Real-time Sync**: Account group synchronization with Chart of Accounts
- **Change Propagation**: Automatic propagation of account changes to groups
- **Validation Integration**: Account validation integration with group rules
- **Balance Roll-up**: Automatic balance roll-up to General Ledger
- **Reporting Integration**: Group-based reporting integration

**External System Integration**
- **ERP Integration**: Group and hierarchy synchronization with ERP systems
- **BI Integration**: Business intelligence system integration for analytics
- **Budgeting Integration**: Group-based budget allocation and tracking
- **Compliance Integration**: Regulatory reporting based on group structures
- **API Configuration**: Web service endpoints and authentication setup

### Performance Configuration

**Roll-up Calculation Optimization**
- **Calculation Frequency**: Configurable roll-up calculation frequency
- **Caching Strategy**: Intelligent caching for roll-up calculations
- **Batch Processing**: Batch processing configuration for large hierarchies
- **Parallel Processing**: Parallel processing for complex calculations
- **Performance Monitoring**: Real-time performance monitoring and alerts

**Database Optimization**
- **Index Strategy**: Database index configuration for group queries
- **Partitioning Rules**: Table partitioning for large group datasets
- **Query Optimization**: SQL query performance tuning parameters
- **Connection Pooling**: Database connection pooling optimization
- **Archive Configuration**: Historical data archival and purging rules

## 2.2.6 Integration Points

### Core Financial System Integration

**Chart of Accounts Integration**
- **Real-time Group Synchronization**: Automatic synchronization of account groups with Chart of Accounts
- **Account Assignment**: Dynamic account assignment to groups based on attributes and rules
- **Change Propagation**: Automatic propagation of account changes to group structures
- **Validation Integration**: Account validation integration with group membership rules
- **Balance Roll-up**: Real-time balance roll-up from groups to General Ledger

**General Ledger Integration**
- **Automated Roll-up Calculations**: Real-time calculation of group-level balances
- **Transaction Posting**: Group-based transaction validation and posting
- **Balance Updates**: Automatic group balance updates from account transactions
- **Period-end Controls**: Group modification restrictions during closing periods
- **Consolidation**: Multi-level group consolidation for financial reporting

### Enterprise Resource Planning Integration

**ERP Master Data Synchronization**
- **Bi-directional Sync**: Group and hierarchy synchronization with ERP systems
- **Change Propagation**: Group changes automatically reflected in connected systems
- **Conflict Resolution**: Automated handling of group data conflicts between systems
- **Data Mapping**: Group field mapping between FMS and ERP systems
- **Validation Rules**: Cross-system group validation and consistency checks

**Business Process Integration**
- **Procure-to-Pay**: Group integration for expense categorization and analysis
- **Order-to-Cash**: Group-based revenue recognition and reporting
- **Record-to-Report**: Group integration for financial reporting processes
- **Hire-to-Retire**: Group integration for payroll and expense categorization
- **Plan-to-Produce**: Group integration for manufacturing cost analysis

### Business Intelligence and Analytics Integration

**Data Warehouse Integration**
- **Group Dimension**: Account groups as core dimension for BI analytics
- **Hierarchical Roll-ups**: Group hierarchy integration for multi-level analysis
- **Time-based Analysis**: Group balance trends and period-over-period comparisons
- **Cross-entity Analysis**: Consolidated group analysis across multiple entities
- **Custom Metrics**: Group-based KPI calculations and performance metrics

**Reporting Tools Integration**
- **Financial Reporting**: Group-based financial statement generation
- **Management Reporting**: Group-level management reporting and analysis
- **Regulatory Reporting**: Group classification for statutory reporting requirements
- **XBRL Reporting**: Group tagging for XBRL-formatted financial statements
- **Dashboard Integration**: Group balance visualization for executive dashboards

### Technical Integration Architecture

**API Integration Layer**
- **RESTful APIs**: Standard REST APIs for group and hierarchy data access
- **SOAP Integration**: Legacy system integration using SOAP web services
- **File-based Integration**: Batch file import/export for group data synchronization
- **Real-time Messaging**: Event-driven group change notifications
- **Authentication & Security**: OAuth 2.0 and API key management for secure access

**Data Integration Patterns**
- **Event-driven Architecture**: Group change events propagated to connected systems
- **Request-Response Pattern**: Synchronous group validation and lookup services
- **Publish-Subscribe Pattern**: Group data change notifications to subscribers
- **Batch Processing**: Scheduled batch synchronization of group master data
- **Streaming Integration**: Real-time group data streaming for analytics platforms

### External System Integration

**Budgeting and Planning Integration**
- **Group-based Budgeting**: Budget allocation and tracking at group level
- **Forecast Integration**: Group-level financial forecasting and planning
- **Variance Analysis**: Group-based budget vs actual variance analysis
- **Performance Management**: Group-level performance metrics and KPIs
- **Strategic Planning**: Group-based strategic planning and analysis

**Compliance and Audit Integration**
- **Regulatory Reporting**: Group-based regulatory reporting and compliance
- **Audit Systems**: Group data export for external audit requirements
- **Tax Systems**: Group-based tax reporting and compliance management
- **Risk Management**: Group-level risk assessment and monitoring
- **Internal Controls**: Group-based internal control implementation and testing

## 2.2.7 Compliance & Controls

### Regulatory Compliance Framework

**GAAP/IFRS Compliance**
- **Group Classification Standards**: Compliance with accounting standards for group reporting
- **Financial Statement Presentation**: Group mapping for proper financial statement presentation
- **Segment Reporting**: Group-based segment reporting requirements
- **Disclosure Requirements**: Group-level disclosure and transparency requirements
- **Consolidation Rules**: Group consolidation compliance with accounting standards

**SOX Compliance Requirements**
- **Segregation of Duties**: Enforced separation between group creation, modification, and approval
- **Management Assertions**: Group integrity validation for existence, completeness, accuracy
- **Control Activities**: Automated controls for group master data changes and validations
- **Monitoring Controls**: Continuous monitoring of group changes and access patterns
- **Documentation Requirements**: Complete audit trail documentation for all group modifications

**Regulatory Reporting Compliance**
- **Tax Reporting**: Group-based tax reporting and compliance management
- **Statutory Reporting**: Group classification for government-mandated reports
- **Industry-specific Compliance**: Group reporting for industry regulatory requirements
- **International Reporting**: Group consolidation for international operations
- **Environmental Reporting**: Group-based environmental and sustainability reporting

### Internal Control Framework

**Group Creation Controls**
- **Authorization Controls**: Multi-level approval workflow for new group creation
- **Validation Controls**: Automated validation of group structures and relationships
- **Duplicate Prevention**: System controls to prevent creation of duplicate groups
- **Business Justification**: Required business case documentation for new group requests
- **Impact Assessment**: Analysis of group creation impact on financial reporting

**Group Modification Controls**
- **Change Management**: Formal change control process for group modifications
- **Risk Assessment**: Evaluation of modification impact on existing hierarchies and reports
- **Approval Matrix**: Role-based approval requirements based on modification significance
- **Rollback Capability**: Ability to reverse group modifications if issues are identified
- **Documentation**: Complete documentation of modification rationale and approval

**Hierarchy Management Controls**
- **Hierarchy Validation**: Automated validation of hierarchy rules and constraints
- **Circular Reference Prevention**: System controls to prevent circular hierarchy references
- **Level Restrictions**: Enforced limits on hierarchy depth and complexity
- **Change Impact Analysis**: Automated impact analysis for hierarchy changes
- **Version Control**: Formal versioning for hierarchy changes and approvals

### Audit and Assurance

**Internal Audit Requirements**
- **Group Master Audit**: Regular internal audits of group master data integrity
- **Hierarchy Audit**: Audit of hierarchy structure and relationship compliance
- **Process Compliance**: Audit of group and hierarchy management process compliance
- **Access Audit**: Review of user access rights and privilege assignments
- **Change Audit**: Examination of group and hierarchy changes and approval documentation

**External Audit Support**
- **Audit Trail**: Complete, immutable audit trail for all group-related activities
- **Documentation**: Comprehensive documentation for external auditor review
- **Data Extraction**: Group data extraction capabilities for audit testing
- **Inquiry Response**: Efficient response to auditor group-related inquiries
- **Management Representation**: Support for management representation letter preparation

### Data Quality and Integrity

**Group Data Validation**
- **Input Validation**: Real-time validation of group data entry and imports
- **Business Rule Validation**: Enforcement of business rules for group relationships
- **Referential Integrity**: Database constraints to maintain group data relationships
- **Completeness Checks**: Validation of required group field completion and data accuracy
- **Consistency Validation**: Cross-system consistency checks for group data

**Hierarchy Data Quality**
- **Relationship Validation**: Validation of parent-child group relationships
- **Roll-up Validation**: Validation of roll-up calculations and results
- **Performance Monitoring**: Monitoring of hierarchy performance and optimization
- **Change Tracking**: Complete tracking of hierarchy changes and modifications
- **Quality Metrics**: Group data quality KPIs and monitoring dashboards

### Risk Management

**Group Risk Assessment**
- **Risk Identification**: Identification of group-related financial reporting risks
- **Risk Evaluation**: Assessment of group change impact on financial statements
- **Risk Mitigation**: Implementation of controls to mitigate identified risks
- **Risk Monitoring**: Ongoing monitoring of group-related risk indicators
- **Risk Reporting**: Regular risk reporting to management and audit committee

**Hierarchy Risk Management**
- **Hierarchy Complexity Risk**: Assessment of hierarchy complexity and maintenance challenges
- **Performance Risk**: Monitoring of roll-up calculation performance and optimization
- **Data Integrity Risk**: Controls to maintain hierarchy data integrity and consistency
- **Change Management Risk**: Risk assessment for hierarchy changes and modifications
- **Business Continuity Risk**: Group and hierarchy disaster recovery and business continuity

## 2.2.8 Reporting & Analytics

### Group-based Financial Reports

**Group Balance Sheet Reports**
- Hierarchical balance sheet generation based on group structures
- Multi-dimensional balance sheet analysis across different hierarchies
- Group-level asset, liability, and equity roll-up reporting
- Comparative balance sheet analysis between group structures
- Time-based group balance sheet trend analysis

**Group Income Statement Reports**
- Group-based revenue and expense aggregation and reporting
- Multi-level income statement roll-up calculations
- Group profitability analysis and variance reporting
- Departmental and divisional income statement generation
- Group-based cost center and profit center reporting

### Hierarchy Analysis Reports

**Hierarchy Performance Analytics**
```sql
-- Group Performance Summary Query
SELECT 
    g.group_id,
    g.group_name,
    g.group_level,
    g.rollup_method,
    SUM(CASE WHEN a.normal_balance = 'DEBIT' THEN a.current_balance ELSE -a.current_balance END) as net_balance,
    COUNT(a.account_id) as account_count,
    AVG(a.current_balance) as avg_account_balance,
    MAX(a.last_transaction_date) as last_activity
FROM gl_account_groups g
LEFT JOIN gl_group_members gm ON g.group_id = gm.group_id
LEFT JOIN gl_accounts a ON gm.account_id = a.account_id
WHERE g.status = 'ACTIVE' 
    AND a.status = 'ACTIVE'
    AND (gm.effective_end_date IS NULL OR gm.effective_end_date >= CURRENT_DATE)
GROUP BY g.group_id, g.group_name, g.group_level, g.rollup_method
ORDER BY g.group_level, g.group_name;
```

**Hierarchy Roll-up Validation Reports**
- Roll-up calculation accuracy and validation reporting
- Hierarchy integrity and consistency analysis
- Group balance reconciliation and variance analysis
- Missing or incomplete group membership identification
- Roll-up performance and optimization recommendations

### Management Reporting Dashboard

**Group Analytics Dashboard Schema**
```sql
-- Dashboard Metrics Table
CREATE TABLE group_analytics_dashboard (
    dashboard_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    dashboard_name VARCHAR(200) NOT NULL,
    dashboard_config JSONB NOT NULL,
    group_filters JSONB,
    time_period_config JSONB,
    visualization_config JSONB,
    is_public BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_accessed_at TIMESTAMP
);

-- Dashboard Widgets Table
CREATE TABLE dashboard_widgets (
    widget_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    dashboard_id UUID NOT NULL REFERENCES group_analytics_dashboard(dashboard_id) ON DELETE CASCADE,
    widget_type VARCHAR(50) NOT NULL,
    widget_title VARCHAR(200) NOT NULL,
    widget_config JSONB NOT NULL,
    data_source JSONB NOT NULL,
    position_x INTEGER DEFAULT 0,
    position_y INTEGER DEFAULT 0,
    width INTEGER DEFAULT 4,
    height INTEGER DEFAULT 3,
    is_visible BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**KPI Metrics Configuration**
```sql
-- Group KPI Definitions
CREATE TABLE group_kpi_definitions (
    kpi_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    kpi_code VARCHAR(50) UNIQUE NOT NULL,
    kpi_name VARCHAR(200) NOT NULL,
    kpi_description TEXT,
    kpi_type ENUM('FINANCIAL', 'OPERATIONAL', 'COMPLIANCE', 'PERFORMANCE') NOT NULL,
    calculation_formula TEXT NOT NULL,
    data_source_query TEXT NOT NULL,
    target_config JSONB,
    benchmark_config JSONB,
    is_active BOOLEAN DEFAULT TRUE,
    created_by_user_id UUID NOT NULL REFERENCES users(user_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Group KPI Values
CREATE TABLE group_kpi_values (
    kpi_value_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    kpi_id UUID NOT NULL REFERENCES group_kpi_definitions(kpi_id),
    group_id UUID NOT NULL REFERENCES gl_account_groups(group_id),
    period_start_date DATE NOT NULL,
    period_end_date DATE NOT NULL,
    kpi_value DECIMAL(20,4) NOT NULL,
    target_value DECIMAL(20,4),
    variance_amount DECIMAL(20,4),
    variance_percentage DECIMAL(10,2),
    benchmark_value DECIMAL(20,4),
    calculated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (kpi_id, group_id, period_start_date, period_end_date)
);
```

### Custom Report Builder

**Report Definition Schema**
```sql
-- Custom Report Definitions
CREATE TABLE custom_group_reports (
    report_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    report_name VARCHAR(200) NOT NULL,
    report_description TEXT,
    report_type ENUM('STANDARD', 'CUSTOM', 'SCHEDULED') NOT NULL,
    group_hierarchy_id UUID REFERENCES gl_hierarchy_definition(hierarchy_id),
    data_source_config JSONB NOT NULL,
    filter_config JSONB,
    sort_config JSONB,
    column_config JSONB NOT NULL,
    aggregation_config JSONB,
    format_config JSONB,
    is_template BOOLEAN DEFAULT FALSE,
    is_public BOOLEAN DEFAULT FALSE,
    created_by_user_id UUID NOT NULL REFERENCES users(user_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Report Parameters
CREATE TABLE report_parameters (
    parameter_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    report_id UUID NOT NULL REFERENCES custom_group_reports(report_id) ON DELETE CASCADE,
    parameter_name VARCHAR(100) NOT NULL,
    parameter_type ENUM('TEXT', 'NUMBER', 'DATE', 'BOOLEAN', 'SELECT', 'MULTI_SELECT') NOT NULL,
    parameter_label VARCHAR(200) NOT NULL,
    default_value TEXT,
    validation_rules JSONB,
    is_required BOOLEAN DEFAULT FALSE,
    display_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Scheduled Reporting

**Report Scheduling Schema**
```sql
-- Report Schedule Configuration
CREATE TABLE report_schedules (
    schedule_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    report_id UUID NOT NULL REFERENCES custom_group_reports(report_id),
    schedule_name VARCHAR(200) NOT NULL,
    schedule_type ENUM('DAILY', 'WEEKLY', 'MONTHLY', 'QUARTERLY', 'YEARLY', 'CUSTOM') NOT NULL,
    schedule_config JSONB NOT NULL,
    recipient_config JSONB NOT NULL,
    output_format ENUM('PDF', 'EXCEL', 'CSV', 'HTML') DEFAULT 'PDF',
    is_active BOOLEAN DEFAULT TRUE,
    last_run_at TIMESTAMP,
    next_run_at TIMESTAMP,
    created_by_user_id UUID NOT NULL REFERENCES users(user_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Report Execution History
CREATE TABLE report_execution_history (
    execution_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    schedule_id UUID REFERENCES report_schedules(schedule_id),
    report_id UUID NOT NULL REFERENCES custom_group_reports(report_id),
    execution_status ENUM('PENDING', 'RUNNING', 'COMPLETED', 'FAILED', 'CANCELLED') NOT NULL,
    execution_start_time TIMESTAMP,
    execution_end_time TIMESTAMP,
    parameters_used JSONB,
    output_file_path VARCHAR(500),
    record_count INTEGER,
    error_message TEXT,
    executed_by_user_id UUID REFERENCES users(user_id),
    executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Data Export and Integration

**Export Configuration Schema**
```sql
-- Export Job Configuration
CREATE TABLE group_data_exports (
    export_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    export_name VARCHAR(200) NOT NULL,
    export_type ENUM('FULL', 'INCREMENTAL', 'DELTA') NOT NULL,
    group_filter_config JSONB,
    date_range_config JSONB,
    format_config JSONB NOT NULL,
    destination_config JSONB,
    compression_enabled BOOLEAN DEFAULT FALSE,
    encryption_enabled BOOLEAN DEFAULT FALSE,
    status ENUM('PENDING', 'RUNNING', 'COMPLETED', 'FAILED', 'CANCELLED') NOT NULL,
    requested_by_user_id UUID NOT NULL REFERENCES users(user_id),
    requested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    file_size BIGINT,
    record_count INTEGER,
    error_message TEXT
);

-- Export Field Mapping
CREATE TABLE export_field_mappings (
    mapping_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    export_id UUID NOT NULL REFERENCES group_data_exports(export_id) ON DELETE CASCADE,
    source_field VARCHAR(200) NOT NULL,
    target_field VARCHAR(200) NOT NULL,
    field_type VARCHAR(50) NOT NULL,
    transformation_rules JSONB,
    is_required BOOLEAN DEFAULT FALSE,
    display_order INTEGER DEFAULT 0
);
```

## 2.2.9 User Interface Design

### Group Management Interface

**Group Master Dashboard Schema**
```sql
-- User Dashboard Configuration
CREATE TABLE user_group_dashboard (
    dashboard_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    dashboard_layout JSONB NOT NULL,
    widget_config JSONB NOT NULL,
    filter_preferences JSONB,
    view_preferences JSONB,
    last_accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Dashboard Widget Definitions
CREATE TABLE dashboard_widget_definitions (
    widget_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    widget_type VARCHAR(50) NOT NULL,
    widget_name VARCHAR(200) NOT NULL,
    widget_description TEXT,
    default_config JSONB NOT NULL,
    data_source_config JSONB NOT NULL,
    refresh_interval INTEGER DEFAULT 300,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Group Search and Navigation Interface**
- Advanced group search with multi-field filtering capabilities
- Smart search with auto-complete and fuzzy matching
- Saved search configurations for frequent queries
- Hierarchical navigation tree with expand/collapse functionality
- Real-time search results with sorting and pagination

**Group Creation Wizard Interface**
```sql
-- Group Creation Wizard State
CREATE TABLE group_creation_wizard (
    wizard_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    wizard_step INTEGER NOT NULL DEFAULT 1,
    wizard_data JSONB NOT NULL,
    validation_errors JSONB,
    is_completed BOOLEAN DEFAULT FALSE,
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP
);
```

### Hierarchy Management Interface

**Visual Hierarchy Builder Schema**
```sql
-- Hierarchy Builder State
CREATE TABLE hierarchy_builder_state (
    builder_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    hierarchy_id UUID REFERENCES gl_hierarchy_definition(hierarchy_id),
    builder_config JSONB NOT NULL,
    node_positions JSONB NOT NULL,
    connection_lines JSONB NOT NULL,
    zoom_level DECIMAL(5,2) DEFAULT 1.0,
    viewport_config JSONB,
    last_saved_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    auto_save_enabled BOOLEAN DEFAULT TRUE
);

-- Hierarchy Node Positions
CREATE TABLE hierarchy_node_positions (
    position_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    builder_id UUID NOT NULL REFERENCES hierarchy_builder_state(builder_id) ON DELETE CASCADE,
    group_id UUID NOT NULL REFERENCES gl_account_groups(group_id),
    x_position DECIMAL(10,2) NOT NULL,
    y_position DECIMAL(10,2) NOT NULL,
    node_width DECIMAL(5,2) DEFAULT 200,
    node_height DECIMAL(5,2) DEFAULT 80,
    is_collapsed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Hierarchy Validation Interface**
- Real-time hierarchy validation with visual feedback
- Circular reference detection and highlighting
- Hierarchy depth and complexity monitoring
- Validation error display with resolution guidance
- Impact analysis visualization for proposed changes

### Reporting and Analytics Interface

**Report Builder Interface Schema**
```sql
-- Report Builder State
CREATE TABLE report_builder_state (
    builder_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    report_id UUID REFERENCES custom_group_reports(report_id),
    builder_config JSONB NOT NULL,
    field_mappings JSONB NOT NULL,
    filter_config JSONB,
    sort_config JSONB,
    preview_data JSONB,
    last_saved_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    auto_save_interval INTEGER DEFAULT 60
);

-- Report Builder Field Palette
CREATE TABLE report_field_palette (
    palette_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    field_category VARCHAR(100) NOT NULL,
    available_fields JSONB NOT NULL,
    recently_used_fields JSONB,
    custom_fields JSONB,
    last_updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Analytics Dashboard Interface**
- Interactive dashboard with drag-and-drop widget arrangement
- Real-time data visualization with automatic refresh
- Customizable chart types and configurations
- Drill-down capabilities from summary to detailed data
- Export and sharing functionality for dashboard views

### Configuration and Administration Interface

**System Configuration Screens**
```sql
-- User Configuration Preferences
CREATE TABLE user_interface_preferences (
    preference_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    theme_config JSONB NOT NULL,
    language_config VARCHAR(10) DEFAULT 'en',
    timezone_config VARCHAR(50) DEFAULT 'UTC',
    date_format_config VARCHAR(20) DEFAULT 'YYYY-MM-DD',
    number_format_config JSONB,
    accessibility_config JSONB,
    notification_preferences JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Interface Customization
CREATE TABLE interface_customizations (
    customization_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(user_id),
    customization_type VARCHAR(50) NOT NULL,
    customization_data JSONB NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Workflow Configuration Interface**
- Visual workflow designer with drag-and-drop functionality
- Approval workflow configuration with step-by-step setup
- Rule engine configuration with business logic builder
- Notification template management and customization
- Workflow testing and simulation capabilities

### Mobile and Responsive Design

**Mobile Interface Schema**
```sql
-- Mobile Device Configuration
CREATE TABLE mobile_device_config (
    device_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    device_type VARCHAR(50) NOT NULL,
    device_identifier VARCHAR(200) NOT NULL,
    app_version VARCHAR(50),
    push_notification_token VARCHAR(500),
    is_active BOOLEAN DEFAULT TRUE,
    last_sync_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Mobile Offline Cache
CREATE TABLE mobile_offline_cache (
    cache_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    device_id UUID REFERENCES mobile_device_config(device_id),
    cache_type VARCHAR(50) NOT NULL,
    cache_key VARCHAR(500) NOT NULL,
    cache_data JSONB NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Responsive Design Configuration**
- Adaptive layout configuration for different screen sizes
- Touch-friendly controls and gesture support
- Progressive Web App capabilities with offline support
- Mobile-specific navigation and menu structures
- Performance optimization for mobile devices

### User Experience Enhancements

**Productivity Features Schema**
```sql
-- User Productivity Settings
CREATE TABLE user_productivity_settings (
    setting_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    keyboard_shortcuts JSONB NOT NULL,
    quick_actions JSONB NOT NULL,
    auto_save_config JSONB NOT NULL,
    recent_items JSONB,
    smart_suggestions JSONB,
    productivity_metrics JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- User Behavior Analytics
CREATE TABLE user_behavior_analytics (
    analytics_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(user_id),
    session_id VARCHAR(100) NOT NULL,
    action_type VARCHAR(100) NOT NULL,
    action_data JSONB,
    screen_info JSONB,
    performance_metrics JSONB,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Accessibility and Usability**
- Screen reader compatibility with ARIA labels and roles
- High contrast mode and visual accessibility options
- Complete keyboard navigation support without mouse dependency
- Multi-language support with RTL language compatibility
- Error prevention with real-time validation and guidance

### Interface Performance Optimization

**Performance Monitoring Schema**
```sql
-- Interface Performance Metrics
CREATE TABLE interface_performance_metrics (
    metric_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(user_id),
    page_name VARCHAR(200) NOT NULL,
    load_time_ms INTEGER NOT NULL,
    render_time_ms INTEGER NOT NULL,
    api_call_count INTEGER DEFAULT 0,
    error_count INTEGER DEFAULT 0,
    user_agent TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- A/B Testing Configuration
CREATE TABLE ab_testing_config (
    test_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    test_name VARCHAR(200) NOT NULL,
    test_description TEXT,
    variant_config JSONB NOT NULL,
    traffic_split JSONB NOT NULL,
    success_metrics JSONB NOT NULL,
    is_active BOOLEAN DEFAULT FALSE,
    start_date DATE,
    end_date DATE,
    created_by_user_id UUID NOT NULL REFERENCES users(user_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

--- END OF SECTION 2.2.9 ---
