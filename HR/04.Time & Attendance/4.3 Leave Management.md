# 4.3 Leave Management

## 4.3.1 Business Purpose

Leave Management provides comprehensive administration of employee leave requests, balance tracking, accrual calculations, and policy enforcement. This ensures fair and consistent leave processing, compliance with labor regulations, and accurate leave balance management while supporting various leave types, approval workflows, and integration with payroll and attendance systems.

## 4.3.2 Business Scope

Enable complete leave management including leave request workflow, balance tracking, accrual calculations, policy enforcement, and calendar integration. The system supports automated calculations, multi-level approvals, compliance monitoring, and audit trails while ensuring accuracy, timeliness, and regulatory compliance across all leave types and organizational levels.

## 4.3.3 Leave Policy Master Schema

```
Table: leave_policy
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- policy_code: VARCHAR(50) (Required, Indexed)
- policy_name: VARCHAR(200) (Required)
- leave_type: ENUM('Annual', 'Sick', 'Maternity', 'Paternity', 'Personal', 'Bereavement', 'Unpaid', 'Study', 'Sabbatical', 'Military', 'Jury Duty', 'Voting', 'Compensatory Off')
- policy_category: ENUM('Paid Leave', 'Unpaid Leave', 'Statutory Leave', 'Company Policy')
- accrual_frequency: ENUM('Monthly', 'Quarterly', 'Semi-Annual', 'Annual', 'Prorated', 'Custom')
- accrual_method: ENUM('Fixed Amount', 'Days of Service', 'Years of Service', 'Performance Based', 'Custom Formula')
- accrual_rate: DECIMAL(8,2) (Default: 0.00)
- maximum_accrual: DECIMAL(8,2) (Default: 0.00)
- carry_forward_allowed: BOOLEAN (Default: TRUE)
- carry_forward_limit: DECIMAL(8,2) (Default: 0.00)
- carry_forward_expiry_days: INTEGER (Default: 365)
- encashment_allowed: BOOLEAN (Default: FALSE)
- encashment_percentage: DECIMAL(5,2) (Default: 0.00)
- minimum_service_days: INTEGER (Default: 0)
- probation_applicable: BOOLEAN (Default: TRUE)
- notice_period_days: INTEGER (Default: 0)
- document_required: BOOLEAN (Default: FALSE)
- approval_workflow_id: UUID (Foreign Key to approval_workflow)
- auto_approval_enabled: BOOLEAN (Default: FALSE)
- auto_approval_criteria: JSON (Auto-approval rules and conditions)
- blackout_periods: JSON (Blackout period dates and restrictions)
- holiday_inclusion: ENUM('Exclude Holidays', 'Include Holidays', 'Count Only Working Days')
- weekend_inclusion: ENUM('Exclude Weekends', 'Include Weekends', 'Count Only Working Days')
- is_active: BOOLEAN (Default: TRUE)
- effective_from: DATE (Required)
- effective_to: DATE
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_leave_policy_company_code (company_id, policy_code)
- INDEX idx_company_id (company_id)
- INDEX idx_leave_type (leave_type)
- INDEX idx_policy_category (policy_category)
- INDEX idx_accrual_frequency (accrual_frequency)
- INDEX idx_is_active (is_active)
- INDEX idx_effective_from (effective_from)

Constraints:
- fk_leave_policy_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_policy_workflow FOREIGN KEY (approval_workflow_id) REFERENCES approval_workflow(id)
- fk_leave_policy_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_accrual_rate_positive CHECK (accrual_rate >= 0)
- chk_maximum_accrual_positive CHECK (maximum_accrual >= 0)
- chk_carry_forward_limit_valid CHECK (carry_forward_limit >= 0)
- chk_encashment_percentage_valid CHECK (encashment_percentage BETWEEN 0 AND 100)
```

## 4.3.4 Leave Balance Schema

```
Table: leave_balance
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- leave_policy_id: UUID (Foreign Key to leave_policy)
- balance_period: ENUM('Current', 'Previous', 'Carry Forward', 'Encashment')
- opening_balance: DECIMAL(8,2) (Default: 0.00)
- accrued_balance: DECIMAL(8,2) (Default: 0.00)
- used_balance: DECIMAL(8,2) (Default: 0.00)
- pending_balance: DECIMAL(8,2) (Default: 0.00)
- available_balance: DECIMAL(8,2) (Default: 0.00)
- carry_forward_balance: DECIMAL(8,2) (Default: 0.00)
- encashment_balance: DECIMAL(8,2) (Default: 0.00)
- forfeiture_balance: DECIMAL(8,2) (Default: 0.00)
- last_accrual_date: DATE
- next_accrual_date: DATE
- balance_date: DATE (Required)
- expiry_date: DATE
- adjustment_reason: TEXT
- last_updated: TIMESTAMP (Auto)
- updated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_leave_policy_id (leave_policy_id)
- INDEX idx_balance_period (balance_period)
- INDEX idx_balance_date (balance_date)
- INDEX idx_expiry_date (expiry_date)
- INDEX idx_available_balance (available_balance)

Constraints:
- fk_leave_balance_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_balance_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_leave_balance_policy FOREIGN KEY (leave_policy_id) REFERENCES leave_policy(id)
- fk_leave_balance_updated_by FOREIGN KEY (updated_by_user_id) REFERENCES user(id)
- chk_balance_calculations CHECK (available_balance = opening_balance + accrued_balance - used_balance - pending_balance)
- chk_non_negative_balances CHECK (opening_balance >= 0 AND accrued_balance >= 0 AND available_balance >= 0)
```

## 4.3.5 Leave Request Schema

```
Table: leave_request
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- leave_policy_id: UUID (Foreign Key to leave_policy)
- request_number: VARCHAR(50) (Required, Unique, Indexed)
- request_type: ENUM('Full Day', 'Half Day', 'Multiple Days', 'Hours', 'Custom')
- leave_start_date: DATE (Required)
- leave_end_date: DATE (Required)
- leave_start_time: TIME
- leave_end_time: TIME
- total_days: DECIMAL(4,2) (Required)
- total_hours: DECIMAL(4,2) (Default: 0.00)
- request_status: ENUM('Draft', 'Submitted', 'Pending Approval', 'Approved', 'Rejected', 'Cancelled', 'On Hold', 'Completed')
- priority: ENUM('Low', 'Medium', 'High', 'Urgent', 'Emergency')
- request_reason: TEXT (Required)
- emergency_contact: VARCHAR(200)
- emergency_phone: VARCHAR(50)
- backup_employee_id: UUID (Foreign Key to employee)
- work_handover_notes: TEXT
- attachment_required: BOOLEAN (Default: FALSE)
- attachment_ids: JSON (Array of document IDs)
- approval_workflow_id: UUID (Foreign Key to approval_workflow)
- current_approver_id: UUID (Foreign Key to employee)
- approval_level: INTEGER (Default: 1)
- submitted_at: TIMESTAMP
- approved_at: TIMESTAMP
- approved_by_user_id: UUID (Foreign Key to user)
- rejection_reason: TEXT
- auto_approved: BOOLEAN (Default: FALSE)
- system_notes: TEXT
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_leave_request_number (request_number)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_leave_policy_id (leave_policy_id)
- INDEX idx_request_type (request_type)
- INDEX idx_leave_start_date (leave_start_date)
- INDEX idx_leave_end_date (leave_end_date)
- INDEX idx_request_status (request_status)
- INDEX idx_priority (priority)
- INDEX idx_current_approver_id (current_approver_id)
- INDEX idx_submitted_at (submitted_at)

Constraints:
- fk_leave_request_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_request_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_leave_request_policy FOREIGN KEY (leave_policy_id) REFERENCES leave_policy(id)
- fk_leave_request_backup_employee FOREIGN KEY (backup_employee_id) REFERENCES employee(id)
- fk_leave_request_workflow FOREIGN KEY (approval_workflow_id) REFERENCES approval_workflow(id)
- fk_leave_request_current_approver FOREIGN KEY (current_approver_id) REFERENCES employee(id)
- fk_leave_request_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_leave_request_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_date_order CHECK (leave_end_date >= leave_start_date)
- chk_positive_duration CHECK (total_days > 0 AND total_hours >= 0)
```

## 4.3.6 Leave Approval Workflow Schema

```
Table: leave_approval_workflow
Fields:
- id: UUID (Primary Key)
- leave_request_id: UUID (Foreign Key to leave_request)
- workflow_template_id: UUID (Foreign Key to workflow_template)
- approval_level: INTEGER (Required)
- approver_type: ENUM('Manager', 'Department Head', 'HR Business Partner', 'HR Manager', 'Specific User', 'Auto Approve')
- approver_id: UUID (Foreign Key to employee)
- approval_status: ENUM('Pending', 'Approved', 'Rejected', 'Delegated', 'Escalated', 'Skipped')
- decision: ENUM('Approve', 'Reject', 'Request More Info', 'Delegate', 'Escalate')
- comments: TEXT
- attachments: JSON (Array of document IDs)
- delegated_to_user_id: UUID (Foreign Key to employee)
- escalated_to_user_id: UUID (Foreign Key to employee)
- due_date: TIMESTAMP
- action_date: TIMESTAMP
- approval_order: INTEGER
- is_parallel: BOOLEAN (Default: FALSE)
- auto_approve: BOOLEAN (Default: FALSE)
- auto_approve_conditions: JSON (Auto-approval conditions)
- skip_conditions: JSON (Skip approval conditions)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_leave_request_id (leave_request_id)
- INDEX idx_workflow_template_id (workflow_template_id)
- INDEX idx_approver_id (approver_id)
- INDEX idx_approval_level (approval_level)
- INDEX idx_approval_status (approval_status)
- INDEX idx_decision (decision)
- INDEX idx_due_date (due_date)
- INDEX idx_approval_order (approval_order)

Constraints:
- fk_leave_approval_request FOREIGN KEY (leave_request_id) REFERENCES leave_request(id)
- fk_leave_approval_template FOREIGN KEY (workflow_template_id) REFERENCES workflow_template(id)
- fk_leave_approval_approver FOREIGN KEY (approver_id) REFERENCES employee(id)
- fk_leave_approval_delegated_to FOREIGN KEY (delegated_to_user_id) REFERENCES employee(id)
- fk_leave_approval_escalated_to FOREIGN KEY (escalated_to_user_id) REFERENCES employee(id)
```

## 4.3.7 Leave Accrual Schema

```
Table: leave_accrual
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- leave_policy_id: UUID (Foreign Key to leave_policy)
- accrual_period: ENUM('Monthly', 'Quarterly', 'Semi-Annual', 'Annual', 'Custom', 'Adjustment')
- accrual_date: DATE (Required)
- accrual_amount: DECIMAL(8,2) (Required)
- accrual_type: ENUM('Regular', 'Adjustment', 'Carry Forward', 'Bonus', 'Correction', 'Forfeiture')
- accrual_basis: VARCHAR(200)
- service_years: DECIMAL(4,1) (Default: 0.0)
- service_days: INTEGER (Default: 0)
- working_days_in_period: INTEGER (Default: 0)
- proration_factor: DECIMAL(5,4) (Default: 1.0000)
- previous_balance: DECIMAL(8,2) (Default: 0.00)
- new_balance: DECIMAL(8,2) (Default: 0.00)
- accrual_formula: TEXT
- calculation_details: JSON (Detailed accrual calculation breakdown)
- auto_processed: BOOLEAN (Default: TRUE)
- processed_by_user_id: UUID (Foreign Key to user)
- processed_at: TIMESTAMP
- notes: TEXT
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_leave_policy_id (leave_policy_id)
- INDEX idx_accrual_period (accrual_period)
- INDEX idx_accrual_date (accrual_date)
- INDEX idx_accrual_type (accrual_type)
- INDEX idx_accrual_amount (accrual_amount)
- INDEX idx_new_balance (new_balance)

Constraints:
- fk_leave_accrual_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_accrual_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_leave_accrual_policy FOREIGN KEY (leave_policy_id) REFERENCES leave_policy(id)
- fk_leave_accrual_processed_by FOREIGN KEY (processed_by_user_id) REFERENCES user(id)
- chk_accrual_amount_valid CHECK (accrual_amount >= -9999.99 AND accrual_amount <= 9999.99)
- chk_proration_factor_valid CHECK (proration_factor BETWEEN 0 AND 2)
```

## 4.3.8 Leave Calendar Schema

```
Table: leave_calendar
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- calendar_type: ENUM('Company', 'Department', 'Team', 'Location', 'Personal')
- calendar_name: VARCHAR(200) (Required)
- calendar_year: INTEGER (Required)
- calendar_period: ENUM('Annual', 'Quarterly', 'Monthly', 'Custom')
- start_date: DATE (Required)
- end_date: DATE (Required)
- location_id: UUID (Foreign Key to location)
- department_id: UUID (Foreign Key to department)
- team_id: UUID (Foreign Key to team)
- holiday_list: JSON (Array of holiday dates and descriptions)
- working_days: JSON (Working days configuration)
- special_events: JSON (Special events and closures)
- blackout_periods: JSON (Blackout period dates and restrictions)
- leave_restrictions: JSON (Leave restriction rules and periods)
- is_public: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_calendar_type (calendar_type)
- INDEX idx_calendar_name (calendar_name)
- INDEX idx_calendar_year (calendar_year)
- INDEX idx_calendar_period (calendar_period)
- INDEX idx_start_date (start_date)
- INDEX idx_end_date (end_date)
- INDEX idx_location_id (location_id)
- INDEX idx_department_id (department_id)
- INDEX idx_is_active (is_active)

Constraints:
- fk_leave_calendar_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_calendar_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_leave_calendar_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_leave_calendar_team FOREIGN KEY (team_id) REFERENCES team(id)
- fk_leave_calendar_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_year_positive CHECK (calendar_year > 0)
- chk_date_order CHECK (end_date >= start_date)
```

## 4.3.9 Leave Analytics Schema

```
Table: leave_analytics
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- employee_id: UUID (Foreign Key to employee)
- leave_policy_id: UUID (Foreign Key to leave_policy)
- analysis_type: ENUM('Leave Utilization', 'Balance Analysis', 'Accrual Analysis', 'Compliance Analysis', 'Cost Analysis', 'Trend Analysis')
- analysis_period: ENUM('Daily', 'Weekly', 'Monthly', 'Quarterly', 'Semi-Annual', 'Annual')
- analysis_date: DATE (Required)
- metric_name: VARCHAR(100) (Required)
- metric_value: DECIMAL(15,2)
- metric_unit: VARCHAR(50)
- benchmark_value: DECIMAL(15,2)
- variance_percentage: DECIMAL(5,2)
- target_value: DECIMAL(15,2)
- achievement_percentage: DECIMAL(5,2)
- total_employees: INTEGER (Default: 0)
- employees_on_leave: INTEGER (Default: 0)
- leave_percentage: DECIMAL(5,2) (Default: 0.00)
- average_leave_days: DECIMAL(8,2) (Default: 0.00)
- total_leave_days: DECIMAL(8,2) (Default: 0.00)
- unpaid_leave_days: DECIMAL(8,2) (Default: 0.00)
- leave_cost: DECIMAL(15,2) (Default: 0.00)
- productivity_impact: DECIMAL(5,2) (Default: 0.00)
- compliance_score: DECIMAL(5,2) (Default: 0.00)
- additional_metrics: JSON (Additional KPIs and breakdowns)
- calculated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_leave_policy_id (leave_policy_id)
- INDEX idx_analysis_type (analysis_type)
- INDEX idx_analysis_period (analysis_period)
- INDEX idx_analysis_date (analysis_date)
- INDEX idx_metric_name (metric_name)

Constraints:
- fk_leave_analytics_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_analytics_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_leave_analytics_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_leave_analytics_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_leave_analytics_policy FOREIGN KEY (leave_policy_id) REFERENCES leave_policy(id)
- fk_leave_analytics_calculated_by FOREIGN KEY (calculated_by_user_id) REFERENCES user(id)
```

## 4.3.10 Leave Communication Schema

```
Table: leave_communication
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- communication_type: ENUM('Leave Request', 'Approval Notification', 'Rejection Notification', 'Balance Update', 'Policy Reminder', 'Expiry Warning', 'Accrual Notification')
- communication_title: VARCHAR(200) (Required)
- communication_purpose: TEXT
- delivery_method: ENUM('Email', 'SMS', 'Push Notification', 'Portal Alert', 'Manager Notification')
- communication_status: ENUM('Draft', 'Scheduled', 'Sent', 'Delivered', 'Failed', 'Read', 'Acknowledged')
- leave_request_id: UUID (Foreign Key to leave_request)
- leave_policy_id: UUID (Foreign Key to leave_policy)
- scheduled_time: TIMESTAMP
- sent_time: TIMESTAMP
- delivery_time: TIMESTAMP
- read_time: TIMESTAMP
- acknowledged_time: TIMESTAMP
- content_type: ENUM('Text', 'HTML', 'PDF', 'Link', 'Interactive')
- content_summary: TEXT
- content_details: JSON (Full communication content)
- priority: ENUM('Low', 'Medium', 'High', 'Urgent', 'Critical')
- requires_action: BOOLEAN (Default: FALSE)
- action_deadline: DATE
- action_completed: BOOLEAN (Default: FALSE)
- action_completion_date: DATE
- template_used: VARCHAR(200)
- personalization_data: JSON (Personalization variables and values)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_communication_type (communication_type)
- INDEX idx_delivery_method (delivery_method)
- INDEX idx_communication_status (communication_status)
- INDEX idx_leave_request_id (leave_request_id)
- INDEX idx_leave_policy_id (leave_policy_id)
- INDEX idx_scheduled_time (scheduled_time)
- INDEX idx_priority (priority)
- INDEX idx_requires_action (requires_action)
- INDEX idx_action_deadline (action_deadline)

Constraints:
- fk_leave_communication_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_communication_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_leave_communication_request FOREIGN KEY (leave_request_id) REFERENCES leave_request(id)
- fk_leave_communication_policy FOREIGN KEY (leave_policy_id) REFERENCES leave_policy(id)
- fk_leave_communication_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
```

## 4.3.11 Leave Audit Log Schema

```
Table: leave_audit_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- action: ENUM('Create', 'Update', 'Delete', 'Submit', 'Approve', 'Reject', 'Cancel', 'Accrue', 'Adjust', 'Expire', 'Encash')
- entity_type: ENUM('Leave Request', 'Leave Policy', 'Leave Balance', 'Leave Accrual', 'Leave Calendar', 'Leave Analytics', 'Leave Communication')
- entity_id: UUID
- old_values: JSON (Previous values)
- new_values: JSON (Updated values)
- field_changes: JSON (Specific field changes)
- action_reason: TEXT
- business_justification: TEXT
- impact_assessment: TEXT
- affected_employees: INTEGER (Default: 0)
- payroll_impact: BOOLEAN (Default: FALSE)
- compliance_impact: TEXT
- balance_impact: DECIMAL(8,2) (Default: 0.00)
- performed_by_user_id: UUID (Foreign Key to user)
- ip_address: VARCHAR(45)
- user_agent: TEXT
- session_id: VARCHAR(100)
- timestamp: TIMESTAMP (Auto)
- additional_context: JSON (Extra context information)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_action (action)
- INDEX idx_entity_type (entity_type)
- INDEX idx_performed_by (performed_by_user_id)
- INDEX idx_timestamp (timestamp)
- INDEX idx_payroll_impact (payroll_impact)
- INDEX idx_balance_impact (balance_impact)
- INDEX idx_affected_employees (affected_employees)

Constraints:
- fk_leave_audit_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_leave_audit_performed_by FOREIGN KEY (performed_by_user_id) REFERENCES user(id)
