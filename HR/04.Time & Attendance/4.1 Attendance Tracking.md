# 4.1 Attendance Tracking

## 4.1.1 Business Purpose

Attendance Tracking provides comprehensive management of employee work hours, attendance patterns, and time-in/time-out records. This ensures accurate payroll calculation, compliance with labor regulations, productivity monitoring, and data-driven workforce management while supporting multiple attendance capture methods and real-time synchronization across the organization.

## 4.1.2 Business Scope

Enable complete attendance tracking management including time clock integration, mobile check-in/out, GPS location validation, offline mode support, and real-time synchronization. The system supports automated attendance calculations, exception handling, compliance monitoring, and audit trails while ensuring accuracy, timeliness, and regulatory compliance across all attendance capture methods and work locations.

## 4.1.3 Attendance Record Master Schema

```
Table: attendance_record
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- attendance_date: DATE (Required)
- check_in_time: TIMESTAMP
- check_out_time: TIMESTAMP
- check_in_method: ENUM('Time Clock', 'Mobile App', 'Web Portal', 'Biometric', 'Manual', 'API', 'Import')
- check_out_method: ENUM('Time Clock', 'Mobile App', 'Web Portal', 'Biometric', 'Manual', 'API', 'Import')
- check_in_location_id: UUID (Foreign Key to location)
- check_out_location_id: UUID (Foreign Key to location)
- check_in_device_id: VARCHAR(100)
- check_out_device_id: VARCHAR(100)
- ip_address: VARCHAR(45)
- gps_coordinates: JSON (Latitude, longitude, accuracy)
- work_schedule_id: UUID (Foreign Key to work_schedule)
- shift_id: UUID (Foreign Key to shift)
- regular_hours: DECIMAL(8,2) (Default: 0.00)
- overtime_hours: DECIMAL(8,2) (Default: 0.00)
- double_time_hours: DECIMAL(8,2) (Default: 0.00)
- break_minutes: INTEGER (Default: 0)
- late_minutes: INTEGER (Default: 0)
- early_departure_minutes: INTEGER (Default: 0)
- attendance_status: ENUM('Present', 'Absent', 'Late', 'Early Departure', 'Half Day', 'On Leave', 'Holiday', 'Weekend')
- approval_status: ENUM('Approved', 'Pending', 'Rejected', 'Requires Action')
- approved_by_user_id: UUID (Foreign Key to user)
- approved_at: TIMESTAMP
- notes: TEXT
- exception_reason: TEXT
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_attendance_date (attendance_date)
- INDEX idx_check_in_time (check_in_time)
- INDEX idx_check_out_time (check_out_time)
- INDEX idx_check_in_method (check_in_method)
- INDEX idx_check_out_method (check_out_method)
- INDEX idx_attendance_status (attendance_status)
- INDEX idx_approval_status (approval_status)
- INDEX idx_work_schedule_id (work_schedule_id)
- INDEX idx_shift_id (shift_id)

Constraints:
- fk_attendance_record_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_attendance_record_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_attendance_record_check_in_location FOREIGN KEY (check_in_location_id) REFERENCES location(id)
- fk_attendance_record_check_out_location FOREIGN KEY (check_out_location_id) REFERENCES location(id)
- fk_attendance_record_schedule FOREIGN KEY (work_schedule_id) REFERENCES work_schedule(id)
- fk_attendance_record_shift FOREIGN KEY (shift_id) REFERENCES shift(id)
- fk_attendance_record_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- chk_time_order CHECK (check_out_time >= check_in_time OR check_out_time IS NULL)
- chk_hours_non_negative CHECK (regular_hours >= 0 AND overtime_hours >= 0 AND double_time_hours >= 0)
```

## 4.1.4 Time Clock Integration Schema

```
Table: time_clock_integration
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- device_id: VARCHAR(100) (Required, Unique, Indexed)
- device_name: VARCHAR(200) (Required)
- device_type: ENUM('Biometric', 'RFID Card', 'PIN Code', 'Face Recognition', 'Mobile App', 'Web Portal')
- device_location_id: UUID (Foreign Key to location)
- device_status: ENUM('Active', 'Inactive', 'Maintenance', 'Error', 'Offline')
- last_sync_time: TIMESTAMP
- sync_status: ENUM('Success', 'Failed', 'Pending', 'In Progress')
- api_endpoint: VARCHAR(500)
- authentication_method: ENUM('API Key', 'Certificate', 'Username/Password', 'Token')
- connection_parameters: JSON (Device-specific configuration)
- supported_features: JSON (Array of supported features)
- firmware_version: VARCHAR(50)
- manufacturer: VARCHAR(200)
- model_number: VARCHAR(100)
- serial_number: VARCHAR(100)
- installation_date: DATE
- last_maintenance_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_device_id_company (device_id, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_device_type (device_type)
- INDEX idx_device_location_id (device_location_id)
- INDEX idx_device_status (device_status)
- INDEX idx_last_sync_time (last_sync_time)
- INDEX idx_sync_status (sync_status)

Constraints:
- fk_time_clock_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_time_clock_location FOREIGN KEY (device_location_id) REFERENCES location(id)
- fk_time_clock_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
```

## 4.1.5 Mobile Attendance Schema

```
Table: mobile_attendance
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- attendance_date: DATE (Required)
- check_in_time: TIMESTAMP
- check_out_time: TIMESTAMP
- check_in_coordinates: JSON (Latitude, longitude, accuracy, timestamp)
- check_out_coordinates: JSON (Latitude, longitude, accuracy, timestamp)
- device_info: JSON (Device type, OS, app version, unique identifier)
- app_version: VARCHAR(50)
- network_type: ENUM('WiFi', 'Cellular', 'Offline')
- battery_level: INTEGER (Default: 100)
- location_validation: BOOLEAN (Default: TRUE)
- geofence_compliance: BOOLEAN (Default: TRUE)
- photo_verification: BOOLEAN (Default: FALSE)
- photo_url: VARCHAR(500)
- selfie_verification: BOOLEAN (Default: FALSE)
- selfie_url: VARCHAR(500)
- attendance_method: ENUM('GPS', 'WiFi', 'Bluetooth Beacon', 'NFC', 'Manual')
- sync_status: ENUM('Synced', 'Pending', 'Failed', 'Conflict')
- last_sync_attempt: TIMESTAMP
- conflict_resolution: JSON (Conflict details and resolution)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_attendance_date (attendance_date)
- INDEX idx_check_in_time (check_in_time)
- INDEX idx_check_out_time (check_out_time)
- INDEX idx_app_version (app_version)
- INDEX idx_network_type (network_type)
- INDEX idx_sync_status (sync_status)
- INDEX idx_last_sync_attempt (last_sync_attempt)

Constraints:
- fk_mobile_attendance_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_mobile_attendance_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- chk_time_order CHECK (check_out_time >= check_in_time OR check_out_time IS NULL)
```

## 4.1.6 Attendance Exception Schema

```
Table: attendance_exception
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- attendance_record_id: UUID (Foreign Key to attendance_record)
- exception_type: ENUM('Missed Check-In', 'Missed Check-Out', 'Late Arrival', 'Early Departure', 'Overtime', 'Unauthorized Location', 'Device Error', 'System Error')
- exception_date: DATE (Required)
- exception_time: TIMESTAMP (Required)
- severity: ENUM('Low', 'Medium', 'High', 'Critical')
- description: TEXT (Required)
- resolution_status: ENUM('Open', 'In Progress', 'Resolved', 'Closed', 'Ignored', 'Escalated')
- resolution_method: ENUM('Manual Correction', 'Automatic', 'Manager Approval', 'HR Approval', 'System Fix')
- resolved_by_user_id: UUID (Foreign Key to user)
- resolved_at: TIMESTAMP
- resolution_notes: TEXT
- impact_on_payroll: BOOLEAN (Default: FALSE)
- payroll_adjustment_required: BOOLEAN (Default: FALSE)
- notification_sent: BOOLEAN (Default: FALSE)
- auto_resolution: BOOLEAN (Default: FALSE)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_attendance_record_id (attendance_record_id)
- INDEX idx_exception_type (exception_type)
- INDEX idx_exception_date (exception_date)
- INDEX idx_severity (severity)
- INDEX idx_resolution_status (resolution_status)
- INDEX idx_resolved_by (resolved_by_user_id)
- INDEX idx_resolved_at (resolved_at)

Constraints:
- fk_attendance_exception_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_attendance_exception_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_attendance_exception_record FOREIGN KEY (attendance_record_id) REFERENCES attendance_record(id)
- fk_attendance_exception_resolved_by FOREIGN KEY (resolved_by_user_id) REFERENCES user(id)
```

## 4.1.7 Attendance Analytics Schema

```
Table: attendance_analytics
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- employee_id: UUID (Foreign Key to employee)
- analysis_type: ENUM('Attendance Rate', 'Punctuality', 'Overtime Analysis', 'Absenteeism', 'Productivity', 'Compliance', 'Trend Analysis')
- analysis_period: ENUM('Daily', 'Weekly', 'Monthly', 'Quarterly', 'Semi-Annual', 'Annual')
- analysis_date: DATE (Required)
- metric_name: VARCHAR(100) (Required)
- metric_value: DECIMAL(15,2)
- metric_unit: VARCHAR(50)
- benchmark_value: DECIMAL(15,2)
- variance_percentage: DECIMAL(5,2)
- target_value: DECIMAL(15,2)
- achievement_percentage: DECIMAL(5,2)
- total_work_days: INTEGER (Default: 0)
- present_days: INTEGER (Default: 0)
- absent_days: INTEGER (Default: 0)
- late_arrivals: INTEGER (Default: 0)
- early_departures: INTEGER (Default: 0)
- total_hours_worked: DECIMAL(8,2) (Default: 0.00)
- overtime_hours: DECIMAL(8,2) (Default: 0.00)
- productivity_score: DECIMAL(5,2) (Default: 0.00)
- compliance_score: DECIMAL(5,2) (Default: 0.00)
- additional_metrics: JSON (Additional KPIs and breakdowns)
- calculated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_analysis_type (analysis_type)
- INDEX idx_analysis_period (analysis_period)
- INDEX idx_analysis_date (analysis_date)
- INDEX idx_metric_name (metric_name)

Constraints:
- fk_attendance_analytics_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_attendance_analytics_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_attendance_analytics_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_attendance_analytics_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_attendance_analytics_calculated_by FOREIGN KEY (calculated_by_user_id) REFERENCES user(id)
```

## 4.1.8 Attendance Compliance Schema

```
Table: attendance_compliance
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- compliance_type: ENUM('Working Hours', 'Break Time', 'Overtime Rules', 'Minimum Wage', 'Child Labor', 'Record Keeping', 'Data Privacy')
- compliance_requirement: VARCHAR(200) (Required)
- jurisdiction: VARCHAR(100) (Required)
- compliance_standard: VARCHAR(200) (Required)
- check_status: ENUM('Compliant', 'Non-Compliant', 'Requires Action', 'Exemption', 'Pending Review')
- risk_level: ENUM('Low', 'Medium', 'High', 'Critical')
- affected_employees: INTEGER (Default: 0)
- compliance_score: DECIMAL(5,2)
- violation_details: TEXT
- corrective_action_required: TEXT
- corrective_action_deadline: DATE
- corrective_action_status: ENUM('Not Started', 'In Progress', 'Completed', 'Overdue')
- exemption_approved: BOOLEAN (Default: FALSE)
- exemption_reason: TEXT
- exemption_approved_by_user_id: UUID (Foreign Key to user)
- exemption_approved_at: TIMESTAMP
- audit_required: BOOLEAN (Default: FALSE)
- audit_date: DATE
- audit_results: TEXT
- supporting_documents: JSON (Array of document IDs)
- next_review_date: DATE
- checked_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_compliance_type (compliance_type)
- INDEX idx_jurisdiction (jurisdiction)
- INDEX idx_check_status (check_status)
- INDEX idx_risk_level (risk_level)
- INDEX idx_corrective_action_deadline (corrective_action_deadline)

Constraints:
- fk_attendance_compliance_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_attendance_compliance_exemption_approved_by FOREIGN KEY (exemption_approved_by_user_id) REFERENCES user(id)
- fk_attendance_compliance_checked_by FOREIGN KEY (checked_by_user_id) REFERENCES user(id)
- chk_compliance_score_range CHECK (compliance_score BETWEEN 0 AND 100)
```

## 4.1.9 Attendance Communication Schema

```
Table: attendance_communication
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- communication_type: ENUM('Attendance Alert', 'Exception Notification', 'Policy Reminder', 'Compliance Warning', 'System Update')
- communication_title: VARCHAR(200) (Required)
- communication_purpose: TEXT
- delivery_method: ENUM('Email', 'SMS', 'Push Notification', 'Portal Alert', 'Manager Notification')
- communication_status: ENUM('Draft', 'Scheduled', 'Sent', 'Delivered', 'Failed', 'Read', 'Acknowledged')
- scheduled_time: TIMESTAMP
- sent_time: TIMESTAMP
- delivery_time: TIMESTAMP
- read_time: TIMESTAMP
- acknowledged_time: TIMESTAMP
- content_type: ENUM('Text', 'HTML', 'PDF', 'Link', 'Interactive')
- content_summary: TEXT
- content_details: JSON (Full communication content)
- priority: ENUM('Low', 'Medium', 'High', 'Urgent', 'Critical')
- requires_action: BOOLEAN (Default: FALSE)
- action_deadline: DATE
- action_completed: BOOLEAN (Default: FALSE)
- action_completion_date: DATE
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_communication_type (communication_type)
- INDEX idx_delivery_method (delivery_method)
- INDEX idx_communication_status (communication_status)
- INDEX idx_scheduled_time (scheduled_time)
- INDEX idx_priority (priority)
- INDEX idx_requires_action (requires_action)
- INDEX idx_action_deadline (action_deadline)

Constraints:
- fk_attendance_communication_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_attendance_communication_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_attendance_communication_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
```

## 4.1.10 Attendance Audit Log Schema

```
Table: attendance_audit_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- action: ENUM('Create', 'Update', 'Delete', 'Check-In', 'Check-Out', 'Approve', 'Reject', 'Correct', 'Import', 'Export')
- entity_type: ENUM('Attendance Record', 'Time Clock', 'Mobile Attendance', 'Exception', 'Analytics', 'Compliance Check', 'Communication')
- entity_id: UUID
- old_values: JSON (Previous values)
- new_values: JSON (Updated values)
- field_changes: JSON (Specific field changes)
- action_reason: TEXT
- business_justification: TEXT
- impact_assessment: TEXT
- affected_employees: INTEGER (Default: 0)
- payroll_impact: BOOLEAN (Default: FALSE)
- compliance_impact: TEXT
- performed_by_user_id: UUID (Foreign Key to user)
- ip_address: VARCHAR(45)
- user_agent: TEXT
- session_id: VARCHAR(100)
- timestamp: TIMESTAMP (Auto)
- additional_context: JSON (Extra context information)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_action (action)
- INDEX idx_entity_type (entity_type)
- INDEX idx_performed_by (performed_by_user_id)
- INDEX idx_timestamp (timestamp)
- INDEX idx_payroll_impact (payroll_impact)

Constraints:
- fk_attendance_audit_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_attendance_audit_performed_by FOREIGN KEY (performed_by_user_id) REFERENCES user(id)
```

## 4.1.11 Attendance Sync Schema

```
Table: attendance_sync
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- sync_type: ENUM('Time Clock', 'Mobile App', 'Web Portal', 'Import', 'Export', 'Backup', 'Restore')
- sync_source: VARCHAR(200) (Required)
- sync_status: ENUM('Pending', 'In Progress', 'Success', 'Failed', 'Partial Success', 'Conflict', 'Cancelled')
- sync_start_time: TIMESTAMP (Auto)
- sync_end_time: TIMESTAMP
- total_records: INTEGER (Default: 0)
- processed_records: INTEGER (Default: 0)
- failed_records: INTEGER (Default: 0)
- conflict_records: INTEGER (Default: 0)
- sync_details: JSON (Detailed sync information and statistics)
- error_summary: TEXT
- last_successful_sync: TIMESTAMP
- sync_frequency: ENUM('Real-time', 'Every 5 Minutes', 'Every 15 Minutes', 'Every Hour', 'Daily', 'Manual')
- retry_count: INTEGER (Default: 0)
- max_retries: INTEGER (Default: 3)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_sync_type (sync_type)
- INDEX idx_sync_source (sync_source)
- INDEX idx_sync_status (sync_status)
- INDEX idx_sync_start_time (sync_start_time)
- INDEX idx_sync_end_time (sync_end_time)
- INDEX idx_last_successful_sync (last_successful_sync)
- INDEX idx_sync_frequency (sync_frequency)

Constraints:
- fk_attendance_sync_company FOREIGN KEY (company_id) REFERENCES company_id)
- fk_attendance_sync_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_record_counts_valid CHECK (total_records >= processed_records AND total_records >= failed_records)
- chk_retry_count_valid CHECK (retry_count >= 0 AND retry_count <= max_retries)
