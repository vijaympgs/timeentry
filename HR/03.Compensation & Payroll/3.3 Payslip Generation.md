# 3.3 Payslip Generation

## 3.3.1 Business Purpose

Payslip Generation provides automated creation, distribution, and management of employee pay statements with detailed compensation breakdowns, tax information, and deduction summaries. This ensures regulatory compliance, transparency in compensation, employee understanding of pay components, and efficient delivery while maintaining secure access, historical records, and customizable formats to meet diverse organizational and legal requirements.

## 3.3.2 Business Scope

Enable comprehensive payslip generation management including automated payslip creation, template management, secure delivery systems, historical access, detailed breakdown displays, tax document generation, multi-format support, and compliance reporting. The system supports customizable templates, electronic delivery, print management, employee self-service access, audit trails, and integration with payroll processing while ensuring accuracy, security, and regulatory compliance across all jurisdictions.

## 3.3.3 Payslip Master Schema

```
Table: payslip
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- payroll_run_id: UUID (Foreign Key to payroll_run)
- employee_id: UUID (Foreign Key to employee)
- payslip_number: VARCHAR(50) (Required, Unique, Indexed)
- payslip_type: ENUM('Regular', 'Bonus', 'Commission', 'Termination', 'Adjustment', 'Retroactive', 'Final')
- payslip_status: ENUM('Generated', 'Delivered', 'Viewed', 'Downloaded', 'Printed', 'Reissued', 'Cancelled')
- generation_date: TIMESTAMP (Auto)
- delivery_date: TIMESTAMP
- pay_period_start: DATE (Required)
- pay_period_end: DATE (Required)
- pay_date: DATE (Required)
- currency_code: VARCHAR(10) (Default: 'USD')
- exchange_rate: DECIMAL(10,6) (Default: 1.000000)
- gross_pay: DECIMAL(15,2) (Required)
- net_pay: DECIMAL(15,2) (Required)
- year_to_date_gross: DECIMAL(15,2) (Default: 0.00)
- year_to_date_net: DECIMAL(15,2) (Default: 0.00)
- template_id: UUID (Foreign Key to payslip_template)
- delivery_method: ENUM('Email', 'Portal', 'Print', 'SMS', 'API')
- delivery_status: ENUM('Pending', 'Sent', 'Delivered', 'Failed', 'Bounced')
- email_address: VARCHAR(200)
- portal_access_code: VARCHAR(50)
- sms_number: VARCHAR(50)
- print_count: INTEGER (Default: 0)
- download_count: INTEGER (Default: 0)
- view_count: INTEGER (Default: 0)
- last_viewed_at: TIMESTAMP
- password_protected: BOOLEAN (Default: TRUE)
- encryption_enabled: BOOLEAN (Default: TRUE)
- digital_signature: BOOLEAN (Default: FALSE)
- signature_data: JSON (Digital signature information)
- compliance_notes: TEXT
- special_instructions: TEXT
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_payslip_number_company (payslip_number, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_payroll_run_id (payroll_run_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_payslip_type (payslip_type)
- INDEX idx_payslip_status (payslip_status)
- INDEX idx_generation_date (generation_date)
- INDEX idx_pay_date (pay_date)
- INDEX idx_delivery_method (delivery_method)

Constraints:
- fk_payslip_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_run FOREIGN KEY (payroll_run_id) REFERENCES payroll_run(id)
- fk_payslip_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_payslip_template FOREIGN KEY (template_id) REFERENCES payslip_template(id)
- fk_payslip_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_counts_non_negative CHECK (print_count >= 0 AND download_count >= 0 AND view_count >= 0)
```

## 3.3.4 Payslip Template Schema

```
Table: payslip_template
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- template_name: VARCHAR(200) (Required)
- template_code: VARCHAR(50) (Required, Unique, Indexed)
- template_type: ENUM('Standard', 'Detailed', 'Summary', 'Custom', 'Regulatory', 'International')
- template_format: ENUM('HTML', 'PDF', 'Excel', 'CSV', 'XML')
- template_language: VARCHAR(10) (Default: 'en')
- template_content: TEXT (Required)
- template_styles: TEXT (CSS styles for HTML templates)
- template_layout: JSON (Layout configuration and sections)
- header_content: TEXT (Header section content)
- footer_content: TEXT (Footer section content)
- company_logo_url: VARCHAR(500)
- company_signature: TEXT
- digital_signature_required: BOOLEAN (Default: FALSE)
- password_protection_required: BOOLEAN (Default: TRUE)
- encryption_required: BOOLEAN (Default: TRUE)
- include_year_to_date: BOOLEAN (Default: TRUE)
- include_tax_details: BOOLEAN (Default: TRUE)
- include_benefit_details: BOOLEAN (Default: TRUE)
- include_leave_balances: BOOLEAN (Default: FALSE)
- regulatory_compliance: JSON (Compliance requirements by jurisdiction)
- custom_fields: JSON (Custom field definitions)
- conditional_display: JSON (Conditional display rules)
- is_default: BOOLEAN (Default: FALSE)
- is_active: BOOLEAN (Default: TRUE)
- effective_date: DATE (Required)
- expiry_date: DATE
- version: INTEGER (Default: 1)
- approval_status: ENUM('Draft', 'Pending', 'Approved', 'Rejected')
- approved_by_user_id: UUID (Foreign Key to user)
- approved_at: TIMESTAMP
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_template_code_company (template_code, company_id)
- INDEX idx_company_id (company_id)
- INDEX idx_template_type (template_type)
- INDEX idx_template_format (template_format)
- INDEX idx_is_default (is_default)
- INDEX idx_is_active (is_active)
- INDEX idx_effective_date (effective_date)
- INDEX idx_approval_status (approval_status)

Constraints:
- fk_payslip_template_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_template_approved_by FOREIGN KEY (approved_by_user_id) REFERENCES user(id)
- fk_payslip_template_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_version_positive CHECK (version > 0)
```

## 3.3.5 Payslip Delivery Schema

```
Table: payslip_delivery
Fields:
- id: UUID (Primary Key)
- payslip_id: UUID (Foreign Key to payslip)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- delivery_method: ENUM('Email', 'Portal', 'Print', 'SMS', 'API', 'FTP')
- delivery_status: ENUM('Pending', 'Processing', 'Sent', 'Delivered', 'Failed', 'Bounced', 'Rejected')
- delivery_attempts: INTEGER (Default: 0)
- max_delivery_attempts: INTEGER (Default: 3)
- scheduled_delivery_time: TIMESTAMP
- actual_delivery_time: TIMESTAMP
- delivery_address: VARCHAR(500)
- response_received: BOOLEAN (Default: FALSE)
- response_time: TIMESTAMP
- error_message: TEXT
- error_code: VARCHAR(50)
- delivery_provider: VARCHAR(100)
- tracking_number: VARCHAR(100)
- delivery_confirmation: TEXT
- bounce_reason: VARCHAR(200)
- retry_scheduled: BOOLEAN (Default: FALSE)
- retry_time: TIMESTAMP
- delivery_details: JSON (Detailed delivery information)
- notification_preferences: JSON (Employee notification preferences)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_payslip_id (payslip_id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_delivery_method (delivery_method)
- INDEX idx_delivery_status (delivery_status)
- INDEX idx_scheduled_delivery_time (scheduled_delivery_time)
- INDEX idx_actual_delivery_time (actual_delivery_time)

Constraints:
- fk_payslip_delivery_payslip FOREIGN KEY (payslip_id) REFERENCES payslip(id)
- fk_payslip_delivery_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_delivery_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_payslip_delivery_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_attempts_valid CHECK (delivery_attempts >= 0 AND max_delivery_attempts > 0)
```

## 3.3.6 Payslip Content Schema

```
Table: payslip_content
Fields:
- id: UUID (Primary Key)
- payslip_id: UUID (Foreign Key to payslip)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- content_type: ENUM('Header', 'Employee Info', 'Earnings', 'Deductions', 'Taxes', 'Benefits', 'Summary', 'Footer', 'Custom')
- section_order: INTEGER (Required)
- section_title: VARCHAR(200) (Required)
- content_data: JSON (Section content and formatting)
- display_rules: JSON (Conditional display rules)
- is_visible: BOOLEAN (Default: TRUE)
- is_required: BOOLEAN (Default: FALSE)
- calculation_method: VARCHAR(100)
- data_source: VARCHAR(100)
- formatting_options: JSON (Font, color, alignment options)
- validation_rules: JSON (Data validation requirements)
- localization: JSON (Multi-language support)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_payslip_id (payslip_id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_content_type (content_type)
- INDEX idx_section_order (section_order)
- INDEX idx_is_visible (is_visible)
- INDEX idx_is_required (is_required)

Constraints:
- fk_payslip_content_payslip FOREIGN KEY (payslip_id) REFERENCES payslip(id)
- fk_payslip_content_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_content_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_payslip_content_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_section_order_positive CHECK (section_order > 0)
```

## 3.3.7 Payslip Access Log Schema

```
Table: payslip_access_log
Fields:
- id: UUID (Primary Key)
- payslip_id: UUID (Foreign Key to payslip)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- access_type: ENUM('View', 'Download', 'Print', 'Email', 'Share', 'API Access')
- access_method: ENUM('Web Portal', 'Mobile App', 'Email', 'API', 'Print', 'SMS')
- access_time: TIMESTAMP (Auto)
- access_duration: INTEGER (Duration in seconds)
- ip_address: VARCHAR(45)
- user_agent: TEXT
- device_type: VARCHAR(100)
- browser_type: VARCHAR(100)
- location: VARCHAR(200)
- session_id: VARCHAR(100)
- access_status: ENUM('Success', 'Failed', 'Denied', 'Expired')
- failure_reason: TEXT
- file_downloaded: BOOLEAN (Default: FALSE)
- file_format: VARCHAR(20)
- file_size: INTEGER
- pages_printed: INTEGER (Default: 0)
- shared_with: VARCHAR(500)
- access_purpose: VARCHAR(200)
- additional_context: JSON (Additional access information)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_payslip_id (payslip_id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_access_type (access_type)
- INDEX idx_access_method (access_method)
- INDEX idx_access_time (access_time)
- INDEX idx_access_status (access_status)
- INDEX idx_ip_address (ip_address)

Constraints:
- fk_payslip_access_payslip FOREIGN KEY (payslip_id) REFERENCES payslip(id)
- fk_payslip_access_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_access_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- chk_access_duration_non_negative CHECK (access_duration >= 0)
```

## 3.3.8 Tax Document Generation Schema

```
Table: payslip_tax_document
Fields:
- id: UUID (Primary Key)
- payslip_id: UUID (Foreign Key to payslip)
- company_id: UUID (Foreign Key to company)
- employee_id: UUID (Foreign Key to employee)
- document_type: ENUM('W-2', 'W-2C', '1099', '1099-INT', '1099-DIV', '1099-MISC', 'State W-2', 'Local Tax', 'Custom')
- tax_year: INTEGER (Required)
- document_number: VARCHAR(50) (Required, Unique, Indexed)
- document_status: ENUM('Generated', 'Corrected', 'Cancelled', 'Filed', 'Amended')
- generation_date: TIMESTAMP (Auto)
- filing_deadline: DATE
- filed_date: DATE
- correction_type: ENUM('Original', 'Corrected', 'Amended')
- original_document_id: UUID (Foreign Key to payslip_tax_document)
- recipient_name: VARCHAR(200) (Required)
- recipient_ssn: VARCHAR(20) (Encrypted)
- recipient_address: JSON (Complete address information)
- employer_information: JSON (Employer details)
- federal_wages: DECIMAL(15,2) (Default: 0.00)
- federal_tax_withheld: DECIMAL(15,2) (Default: 0.00)
- social_security_wages: DECIMAL(15,2) (Default: 0.00)
- social_security_tax: DECIMAL(15,2) (Default: 0.00)
- medicare_wages: DECIMAL(15,2) (Default: 0.00)
- medicare_tax: DECIMAL(15,2) (Default: 0.00)
- state_wages: DECIMAL(15,2) (Default: 0.00)
- state_tax_withheld: DECIMAL(15,2) (Default: 0.00)
- local_wages: DECIMAL(15,2) (Default: 0.00)
- local_tax_withheld: DECIMAL(15,2) (Default: 0.00)
- other_income: JSON (Other income categories)
- tax_exemptions: JSON (Tax exemption details)
- retirement_contributions: JSON (Retirement plan contributions)
- dependent_care_benefits: JSON (Dependent care information)
- delivery_method: ENUM('Electronic', 'Paper', 'Both')
- delivery_status: ENUM('Pending', 'Sent', 'Delivered', 'Failed')
- electronic_consent: BOOLEAN (Default: FALSE)
- consent_date: DATE
- delivery_email: VARCHAR(200)
- delivery_address: JSON (Delivery address if different)
- filing_method: ENUM('Electronic', 'Paper', 'Third Party')
- service_provider: VARCHAR(200)
- confirmation_number: VARCHAR(100)
- created_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- UNIQUE KEY uk_document_number_company (document_number, company_id)
- INDEX idx_payslip_id (payslip_id)
- INDEX idx_company_id (company_id)
- INDEX idx_employee_id (employee_id)
- INDEX idx_document_type (document_type)
- INDEX idx_tax_year (tax_year)
- INDEX idx_document_status (document_status)
- INDEX idx_filing_deadline (filing_deadline)

Constraints:
- fk_tax_document_payslip FOREIGN KEY (payslip_id) REFERENCES payslip(id)
- fk_tax_document_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_tax_document_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
- fk_tax_document_original FOREIGN KEY (original_document_id) REFERENCES payslip_tax_document(id)
- fk_tax_document_created_by FOREIGN KEY (created_by_user_id) REFERENCES user(id)
- chk_tax_year_positive CHECK (tax_year > 0)
```

## 3.3.9 Payslip Analytics Schema

```
Table: payslip_analytics
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- department_id: UUID (Foreign Key to department)
- location_id: UUID (Foreign Key to location)
- analysis_type: ENUM('Generation Volume', 'Delivery Success', 'Access Patterns', 'Template Usage', 'Compliance Metrics', 'Employee Satisfaction')
- analysis_period: ENUM('Daily', 'Weekly', 'Monthly', 'Quarterly', 'Semi-Annual', 'Annual')
- analysis_date: DATE (Required)
- metric_name: VARCHAR(100) (Required)
- metric_value: DECIMAL(15,2)
- metric_unit: VARCHAR(50)
- benchmark_value: DECIMAL(15,2)
- variance_percentage: DECIMAL(5,2)
- target_value: DECIMAL(15,2)
- achievement_percentage: DECIMAL(5,2)
- total_payslips: INTEGER
- successful_deliveries: INTEGER
- failed_deliveries: INTEGER
- delivery_success_rate: DECIMAL(5,2)
- average_delivery_time: INTEGER (Time in minutes)
- total_downloads: INTEGER
- total_views: INTEGER
- employee_engagement_rate: DECIMAL(5,2)
- template_usage_distribution: JSON (Template usage statistics)
- delivery_method_distribution: JSON (Delivery method breakdown)
- access_pattern_data: JSON (Access timing and frequency analysis)
- compliance_score: DECIMAL(5,2)
- error_rate: DECIMAL(5,2)
- additional_metrics: JSON (Additional KPIs and breakdowns)
- data_quality_indicators: JSON (Data completeness and accuracy metrics)
- calculated_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_department_id (department_id)
- INDEX idx_location_id (location_id)
- INDEX idx_analysis_type (analysis_type)
- INDEX idx_analysis_period (analysis_period)
- INDEX idx_analysis_date (analysis_date)
- INDEX idx_metric_name (metric_name)

Constraints:
- fk_payslip_analytics_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_analytics_department FOREIGN KEY (department_id) REFERENCES department(id)
- fk_payslip_analytics_location FOREIGN KEY (location_id) REFERENCES location(id)
- fk_payslip_analytics_calculated_by FOREIGN KEY (calculated_by_user_id) REFERENCES user(id)
```

## 3.3.10 Payslip Compliance Schema

```
Table: payslip_compliance
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- payslip_id: UUID (Foreign Key to payslip)
- compliance_type: ENUM('Content Requirements', 'Delivery Standards', 'Data Privacy', 'Accessibility', 'Record Retention', 'Electronic Delivery', 'Tax Document Standards')
- compliance_requirement: VARCHAR(200) (Required)
- jurisdiction: VARCHAR(100) (Required)
- compliance_standard: VARCHAR(200) (Required)
- check_status: ENUM('Compliant', 'Non-Compliant', 'Requires Action', 'Exemption', 'Pending Review')
- risk_level: ENUM('Low', 'Medium', 'High', 'Critical')
- affected_payslips: INTEGER (Default: 0)
- compliance_score: DECIMAL(5,2)
- violation_details: TEXT
- corrective_action_required: TEXT
- corrective_action_deadline: DATE
- corrective_action_status: ENUM('Not Started', 'In Progress', 'Completed', 'Overdue')
- exemption_approved: BOOLEAN (Default: FALSE)
- exemption_reason: TEXT
- exemption_approved_by_user_id: UUID (Foreign Key to user)
- exemption_approved_at: TIMESTAMP
- audit_required: BOOLEAN (Default: FALSE)
- audit_date: DATE
- audit_results: TEXT
- supporting_documents: JSON (Array of document IDs)
- next_review_date: DATE
- checked_by_user_id: UUID (Foreign Key to user)
- created_at: TIMESTAMP (Auto)
- updated_at: TIMESTAMP (Auto)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_payslip_id (payslip_id)
- INDEX idx_compliance_type (compliance_type)
- INDEX idx_jurisdiction (jurisdiction)
- INDEX idx_check_status (check_status)
- INDEX idx_risk_level (risk_level)
- INDEX idx_corrective_action_deadline (corrective_action_deadline)

Constraints:
- fk_payslip_compliance_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_compliance_payslip FOREIGN KEY (payslip_id) REFERENCES payslip(id)
- fk_payslip_compliance_exemption_approved_by FOREIGN KEY (exemption_approved_by_user_id) REFERENCES user(id)
- fk_payslip_compliance_checked_by FOREIGN KEY (checked_by_user_id) REFERENCES user(id)
- chk_compliance_score_range CHECK (compliance_score BETWEEN 0 AND 100)
```

## 3.3.11 Payslip Audit Log Schema

```
Table: payslip_audit_log
Fields:
- id: UUID (Primary Key)
- company_id: UUID (Foreign Key to company)
- action: ENUM('Create', 'Update', 'Delete', 'Generate', 'Deliver', 'Revoke', 'Archive', 'Restore', 'Compliance Check')
- entity_type: ENUM('Payslip', 'Template', 'Delivery', 'Content', 'Tax Document', 'Access Log', 'Compliance Check')
- entity_id: UUID
- old_values: JSON (Previous values)
- new_values: JSON (Updated values)
- field_changes: JSON (Specific field changes)
- action_reason: TEXT
- business_justification: TEXT
- impact_assessment: TEXT
- affected_employees: INTEGER (Default: 0)
- compliance_impact: TEXT
- data_privacy_impact: TEXT
- performed_by_user_id: UUID (Foreign Key to user)
- ip_address: VARCHAR(45)
- user_agent: TEXT
- session_id: VARCHAR(100)
- timestamp: TIMESTAMP (Auto)
- additional_context: JSON (Extra context information)

Indexes:
- PRIMARY KEY (id)
- INDEX idx_company_id (company_id)
- INDEX idx_action (action)
- INDEX idx_entity_type (entity_type)
- INDEX idx_performed_by (performed_by_user_id)
- INDEX idx_timestamp (timestamp)

Constraints:
- fk_payslip_audit_company FOREIGN KEY (company_id) REFERENCES company(id)
- fk_payslip_audit_performed_by FOREIGN KEY (performed_by_user_id) REFERENCES user(id)
